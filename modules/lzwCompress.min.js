// ==UserScript==
// @name         lzwCompress
// @namespace    https://blog.csdn.net/txp1993/
// @version      0.1
// @description  LZW压缩算法实现字符串的压缩和解压
// @source code  https://blog.csdn.net/txp1993/article/details/85702478
// ==/UserScript==
class lzwBinary{constructor(t,r,n,i){var e=t&&t.constructor==Array?t.slice():[],o=(r=0|r,n=0|n,s(i=Math.max(0|(i||8),1))),u=4294967295;function s(t){return(1<<t)-1}function h(t,r){return new Array(r+1).join("0").substring(t.length)+t}function a(t){return String.fromCharCode(t+19968)}function c(t,r){return t.charCodeAt(r)-19968}this.data=function(t,r){return isNaN(r)||(e[t]=0|r||0),isNaN(t)?e.slice():e[t]},this.read=function(){var t;return r>=n?0:(t=32-r%32<i?((e[r>>5]&s(32-r%32))<<(r+i)%32|e[1+(r>>5)]>>>32-(r+i)%32)&o:e[r>>5]>>>32-(r+i)%32&o,r+=i,t)},this.write=function(t){t&=o,32-n%32<i?(e[n>>5]|=t>>>i-(32-n%32),e[1+(n>>5)]|=t<<32-(n+i)%32&u):e[n>>5]|=t<<32-(n+i)%32&u,n+=i},this.eof=function(){return r>=n},this.reset=function(){r=0,o=s(i)},this.resetAll=function(){e=[],r=0,n=0,o=s(i=8),u=4294967295},this.setBitLength=function(t){i=Math.max(0|t,1),o=s(i)},this.toHexString=function(){for(var t=[],r=0;r<e.length;r++)e[r]<0?t.push(h((e[r]>>>16).toString(16),4)+h((65535&e[r]).toString(16),4)):t.push(h(e[r].toString(16),8));return t.join("")},this.toBinaryString=function(){for(var t=[],r=0;r<e.length;r++)e[r]<0?t.push(h((e[r]>>>1).toString(2),31)+(1&e[r])):t.push(h(e[r].toString(2),32));return t.join("").substring(0,n)},this.toCString=function(){var t=r,e=i,o=[];for(this.setBitLength(13),this.reset();r<n;)o.push(a(this.read()));return this.setBitLength(e),r=t,a(n>>>13)+a(n&s(13))+o.join("")},this.fromCString=function(t){this.resetAll(),this.setBitLength(13);for(var r=2;r<t.length;r++)this.write(c(t,r));return n=c(t,0)<<13|c(t,1)&s(13),this},this.clone=function(){return new lzwBinary(e,r,n,i)}}lzw_compress(t){var r,n=new lzwBinary,i=-1,e=(t=t.replace(/[\u0100-\uFFFF]/g,(function(t){return"&#u"+function(t,r){return new Array(r+1).join("0").substring(t.length)+t}(t.charCodeAt(0).toString(16),4)+";"})),{}),o=[],u=8;n.setBitLength(u);for(var s=0;s<258;s++)e[s]=++i;o[0]=t.charCodeAt(0);for(s=1;s<t.length;s++)o[1]=t.charCodeAt(s),null==e[r=o[0]<<16|o[1]]?(e[r]=++i,o[0]>(1<<u)-1&&(n.write(128),n.setBitLength(++u)),n.write(o[0]),o[0]=o[1]):o[0]=e[r];return n.write(o[0]),n.toCString()}lzw_decompress(t){for(var r=new function(){var r=[],n=0,i=0,e=13,o=s(e),u=4294967295;function s(t){return(1<<t)-1}this.r=function(){var t;return t=32-n%32<e?((r[n>>5]&s(32-n%32))<<(n+e)%32|r[1+(n>>5)]>>>32-(n+e)%32)&o:r[n>>5]>>>32-(n+e)%32&o,n+=e,t},this.w=function(t){t&=o,32-i%32<e?(r[i>>5]|=t>>>e-(32-i%32),r[1+(i>>5)]|=t<<32-(i+e)%32&u):r[i>>5]|=t<<32-(i+e)%32&u,i+=e},this.e=function(){return n>=i},this.l=function(t){e=Math.max(0|t,1),o=s(e)};for(var h=2;h<t.length;h++)this.w(t.charCodeAt(h)-19968);i=t.charCodeAt(0)-19968<<13|t.charCodeAt(1)-19968&s(13),n=0},n=[],i=-1,e={},o=[],u=8,s=0;s<2+(1<<u);s++)e[s]=String.fromCharCode(++i);for(r.l(u),o[0]=r.r();!r.e();)o[1]=r.r(),128==o[1]&&(r.l(++u),o[1]=r.r()),null==e[o[1]]?e[++i]=e[o[0]]+e[o[0]].charAt(0):e[++i]=e[o[0]]+e[o[1]].charAt(0),n.push(e[o[0]]),o[0]=o[1];return n.push(e[o[0]]),n.join("").replace(/\&\#u[0-9a-fA-F]{4};/g,(function(t){return String.fromCharCode(parseInt(t.substring(3,7),16))}))}}