// ==UserScript==
// @name         BilibiliAPI_mod
// @namespace    https://github.com/andywang425
// @version      1.3
// @description  BilibiliAPI，PC端抓包研究所得，原作者是SeaLoong。我在此基础上进行补充。
// @author       SeaLoong,andywang425
// @require      https://cdn.jsdelivr.net/gh/jquery/jquery@3.2.1/dist/jquery.min.js
// @grant        none
// @include       * 
// @license      MIT
// ==/UserScript==
"use strict";function _classCallCheck(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?i:t}function _inherits(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}var _get=function i(t,e,n){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,e);if(void 0===r){var a=Object.getPrototypeOf(t);return null===a?void 0:i(a,e,n)}if("value"in r)return r.value;var o=r.get;if(void 0!==o)return o.call(n)},_createClass=function(){function i(i,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}(),csrf_token=void 0,visit_id=void 0,BilibiliAPI={setCommonArgs:function(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";csrf_token=i,visit_id=t},TreasureBox:{getAward:function(i,t,e){return BilibiliAPI.lottery.SilverBox.getAward(i,t,e)},getCaptcha:function(i){return BilibiliAPI.lottery.SilverBox.getCaptcha(i)},getCurrentTask:function(){return BilibiliAPI.lottery.SilverBox.getCurrentTask()}},Exchange:{coin2silver:function(i,t){return BilibiliAPI.pay.coin2silver(i,t)},silver2coin:function(i){return BilibiliAPI.pay.silver2coin(i)},old:{coin2silver:function(i){return BilibiliAPI.exchange.coin2silver(i)},silver2coin:function(){return BilibiliAPI.exchange.silver2coin()}}},Lottery:{Gift:{check:function(i){return BilibiliAPI.xlive.smalltv.check(i)},join:function(i,t,e){return BilibiliAPI.xlive.smalltv.join(i,t,e)},notice:function(i,t){return BilibiliAPI.xlive.smalltv.notice(i,t)}},Raffle:{check:function(i){return BilibiliAPI.activity.check(i)},join:function(i,t){return BilibiliAPI.activity.join(i,t)},notice:function(i,t){return BilibiliAPI.activity.notice(i,t)}},MaterialObject:{getRoomActivityByRoomid:function(i){return BilibiliAPI.lottery.box.getRoomActivityByRoomid(i)},getStatus:function(i,t){return BilibiliAPI.lottery.box.getStatus(i,t)},draw:function(i,t){return BilibiliAPI.lottery.box.draw(i,t)},getWinnerGroupInfo:function(i,t){return BilibiliAPI.lottery.box.getWinnerGroupInfo(i,t)}},Guard:{check:function(i){return BilibiliAPI.lottery.lottery.check_guard(i)},join:function(i,t,e){return BilibiliAPI.xlive.guard.join(i,t,e)}},Pk:{check:function(i){return BilibiliAPI.xlive.pk.check(i)},join:function(i,t){return BilibiliAPI.xlive.pk.join(i,t)}}},Group:{my_groups:function(){return BilibiliAPI.link_group.my_groups()},sign_in:function(i,t){return BilibiliAPI.link_group.sign_in(i,t)}},Storm:{check:function(i){return BilibiliAPI.lottery.Storm.check(i)},join:function(i,t,e,n,r){return BilibiliAPI.lottery.Storm.join(i,t,e,n,r)},join_ex:function(i,t,e,n,r){arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]&&arguments[7];return BilibiliAPI.lottery.Storm.join_ex(i,t,e,n,r,"","",16777215)}},HeartBeat:{web:function(){return BilibiliAPI.user.userOnlineHeart()},mobile:function(){return BilibiliAPI.mobile.userOnlineHeart()}},DailyReward:{task:function(){return BilibiliAPI.home.reward()},exp:function(){return BilibiliAPI.exp()},login:function(){return BilibiliAPI.x.now()},watch:function(i,t,e,n,r,a,o,l,u){return BilibiliAPI.x.heartbeat(i,t,e,n,r,a,o,l,u)},coin:function(i,t){return BilibiliAPI.x.coin_add(i,t)},share:function(i){return BilibiliAPI.x.share_add(i)}},runUntilSucceed:function(i){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:50;setTimeout(function(){i()||BilibiliAPI.runUntilSucceed(i,e,e)},t)},processing:0,ajax:function(i){void 0===i.xhrFields&&(i.xhrFields={}),i.xhrFields.withCredentials=!0,jQuery.extend(i,{url:("//"===i.url.substr(0,2)?"":"//api.live.bilibili.com/")+i.url,method:i.method||"GET",crossDomain:!0,dataType:i.dataType||"json"});var t=jQuery.Deferred();return BilibiliAPI.runUntilSucceed(function(){return!(BilibiliAPI.processing>8)&&(++BilibiliAPI.processing,jQuery.ajax(i).then(function(i,e,n){return--BilibiliAPI.processing,t.resolve(i,e,n),!0},function(i,e,n){return--BilibiliAPI.processing,t.reject(i,e,n),!0}))}),t},ajaxWithCommonArgs:function(i){return i.data||(i.data={}),i.data.csrf=csrf_token,i.data.csrf_token=csrf_token,i.data.visit_id=visit_id,BilibiliAPI.ajax(i)},ajaxGetCaptchaKey:function(){return BilibiliAPI.ajax({url:"//www.bilibili.com/plus/widget/ajaxGetCaptchaKey.php?js"})},exp:function(){return BilibiliAPI.ajax({url:"//www.bilibili.com/plus/account/exp.php"})},msg:function(i){return BilibiliAPI.ajaxWithCommonArgs({method:"POST",url:"ajax/msg",data:{roomid:i}})},ajaxCapsule:function(){return BilibiliAPI.ajax({url:"api/ajaxCapsule"})},player:function(i,t){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"pc",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"web";return BilibiliAPI.ajax({url:"api/player",data:{id:"string"==typeof i&&"cid:"===i.substr(0,4)?i:"cid:"+i,ts:"string"==typeof t?t:t.toString(16),platform:e,player_type:n},dataType:"text"})},create:function(i,t){return BilibiliAPI.ajax({url:"captcha/v1/Captcha/create",data:{width:i||"112",height:t||"32"},cache:!1})},topList:function(i,t,e){return BilibiliAPI.ajax({url:"guard/topList",data:{roomid:i,page:t,ruid:e}})},getSuser:function(){return BilibiliAPI.ajax({url:"msg/getSuser"})},refresh:function(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"all";return BilibiliAPI.ajax({url:"index/refresh?area="+i})},get_ip_addr:function(){return BilibiliAPI.ajax({url:"ip_service/v1/ip_service/get_ip_addr"})},getuserinfo:function(){return BilibiliAPI.ajax({url:"user/getuserinfo"})},activity:{mobileActivity:function(){return BilibiliAPI.ajax({url:"activity/v1/Common/mobileActivity"})},mobileRoomInfo:function(i){return BilibiliAPI.ajax({url:"activity/v1/Common/mobileRoomInfo",data:{roomid:i}})},roomInfo:function(i,t,e,n){return BilibiliAPI.ajax({url:"activity/v1/Common/roomInfo",data:{roomid:i,ruid:t,area_v2_id:e,area_v2_parent_id:n}})},welcomeInfo:function(i,t){return BilibiliAPI.ajax({url:"activity/v1/Common/welcomeInfo",data:{roomid:i,ruid:t}})},check:function(i){return BilibiliAPI.ajax({url:"activity/v1/Raffle/check?roomid="+i})},join:function(i,t){return BilibiliAPI.ajax({url:"activity/v1/Raffle/join",data:{roomid:i,raffleId:t}})},notice:function(i,t){return BilibiliAPI.ajax({url:"activity/v1/Raffle/notice",data:{roomid:i,raffleId:t}})},receive_award:function(i){return BilibiliAPI.ajaxWithCommonArgs({method:"POST",url:"activity/v1/task/receive_award",data:{task_id:i}})}},av:{getTimestamp:function(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"pc";return BilibiliAPI.ajaxWithCommonArgs({method:"POST",url:"av/v1/Time/getTimestamp",data:{platform:i}})}},dynamic_svr:{dynamic_new:function(i){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8;return BilibiliAPI.ajax({url:"dynamic_svr/v1/dynamic_svr/dynamic_new",data:{uid:i,type:t}})}},exchange:{coin2silver:function(i){return BilibiliAPI.ajax({method:"POST",url:"exchange/coin2silver",data:{coin:i}})},silver2coin:function(){return BilibiliAPI.ajax({type:"GET",url:"exchange/silver2coin"})}},fans_medal:{get_fans_medal_info:function(i,t){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return BilibiliAPI.ajaxWithCommonArgs({method:"POST",url:"fans_medal/v1/fans_medal/get_fans_medal_info",data:{source:e,uid:i,target_id:t}})}},feed_svr:{notice:function(){return BilibiliAPI.ajaxWithCommonArgs({method:"POST",url:"feed_svr/v1/feed_svr/notice",data:{}})},my:function(i){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return BilibiliAPI.ajaxWithCommonArgs({method:"POST",url:"feed_svr/v1/feed_svr/my",data:{live_status:t,type:e,page_size:i,offset:n}})}},gift:{bag_list:function(){return BilibiliAPI.ajax({url:"gift/v2/gift/bag_list"})},send:function(i,t,e,n,r,a){var o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"silver",l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"pc",u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"live",c=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,d=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0;return BilibiliAPI.ajaxWithCommonArgs({method:"POST",url:"gift/v2/gift/send",data:{uid:i,gift_id:t,ruid:e,gift_num:n,coin_type:o,bag_id:0,platform:l,biz_code:u,biz_id:r,rnd:a,storm_beat_id:c,metadata:"",price:d}})},bag_send:function(i,t,e,n,r,a,o){var l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"pc",u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"live",c=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,d=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0;return BilibiliAPI.ajaxWithCommonArgs({method:"POST",url:"gift/v2/live/bag_send",data:{uid:i,gift_id:t,ruid:e,gift_num:n,bag_id:r,platform:l,biz_code:u,biz_id:a,rnd:o,storm_beat_id:c,metadata:"",price:d}})},gift_config:function(){return BilibiliAPI.ajax({url:"gift/v3/live/gift_config"})},heart_gift_receive:function(i,t){return BilibiliAPI.ajax({url:"gift/v2/live/heart_gift_receive",data:{roomid:i,area_v2_id:t}})},heart_gift_status:function(i,t){return BilibiliAPI.ajax({url:"gift/v2/live/heart_gift_status",data:{roomid:i,area_v2_id:t}})},receive_daily_bag:function(){return BilibiliAPI.ajax({url:"gift/v2/live/receive_daily_bag"})},room_gift_list:function(i,t){return BilibiliAPI.ajax({url:"gift/v2/live/room_gift_list",data:{roomid:i,area_v2_id:t}})},smalltv:{check:function(i){return BilibiliAPI.ajax({url:"gift/v3/smalltv/check",data:{roomid:i}})},join:function(i,t){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Gift";return BilibiliAPI.ajaxWithCommonArgs({method:"POST",url:"gift/v3/smalltv/join",data:{roomid:i,raffleId:t,type:e}})},notice:function(i){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"small_tv";return BilibiliAPI.ajax({url:"gift/v3/smalltv/notice",data:{type:t,raffleId:i}})}}},giftBag:{getSendGift:function(){return BilibiliAPI.ajax({url:"giftBag/getSendGift"})},sendDaily:function(){return BilibiliAPI.ajax({url:"giftBag/sendDaily"})}},home:{reward:function(){return BilibiliAPI.ajax({url:"//account.bilibili.com/home/reward"})}},i:{ajaxCancelWear:function(){return BilibiliAPI.ajax({url:"i/ajaxCancelWear"})},ajaxGetAchieve:function(i,t){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:6,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"normal",r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"all";return BilibiliAPI.ajax({url:"i/api/ajaxGetAchieve",data:{type:n,status:r,category:a,keywords:i,page:t,pageSize:e}})},ajaxGetMyMedalList:function(){return BilibiliAPI.ajax({url:"i/ajaxGetMyMedalList"})},ajaxWearFansMedal:function(i){return BilibiliAPI.ajax({url:"i/ajaxWearFansMedal?medal_id="+i})},following:function(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:9;return BilibiliAPI.ajax({url:"i/api/following",data:{page:i,pageSize:t}})},guard:function(i){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;return BilibiliAPI.ajax({url:"i/api/guard",data:{page:i,pageSize:t}})},liveinfo:function(){return BilibiliAPI.ajax({url:"i/api/liveinfo"})},medal:function(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;return BilibiliAPI.ajax({url:"i/api/medal",data:{page:i,pageSize:t}})},operation:function(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return BilibiliAPI.ajax({url:"i/api/operation?page="+i})},taskInfo:function(){return BilibiliAPI.ajax({url:"i/api/taskInfo"})}},link_group:{my_groups:function(){return BilibiliAPI.ajax({url:"link_group/v1/member/my_groups"})},sign_in:function(i,t){return BilibiliAPI.ajax({url:"link_setting/v1/link_setting/sign_in",data:{group_id:i,owner_id:t}})}},live:{getRoomKanBanModel:function(i){return BilibiliAPI.ajax({url:"live/getRoomKanBanModel?roomid"+i})},rankTab:function(i){return BilibiliAPI.ajax({url:"live/rankTab?roomid="+i})},roomAdList:function(){return BilibiliAPI.ajax({url:"live/roomAdList"})}},live_user:{get_anchor_in_room:function(i){return BilibiliAPI.ajax({url:"live_user/v1/UserInfo/get_anchor_in_room?roomid="+i})},get_info_in_room:function(i){return BilibiliAPI.ajax({url:"live_user/v1/UserInfo/get_info_in_room?roomid="+i})},get_weared_medal:function(i,t){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return BilibiliAPI.ajaxWithCommonArgs({method:"POST",url:"live_user/v1/UserInfo/get_weared_medal",data:{source:e,uid:i,target_id:t}})},governorShow:function(i){return BilibiliAPI.ajax({url:"live_user/v1/Master/governorShow?target_id="+i})}},lottery:{box:{getRoomActivityByRoomid:function(i){return BilibiliAPI.ajax({url:"lottery/v1/box/getRoomActivityByRoomid?roomid="+i})},getStatus:function(i){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return BilibiliAPI.ajax({url:"lottery/v1/box/getStatus",data:{aid:i,times:t}})},draw:function(i){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return BilibiliAPI.ajax({url:"lottery/v1/box/draw",data:{aid:i,number:t}})},getWinnerGroupInfo:function(i){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return BilibiliAPI.ajax({url:"lottery/v1/box/getWinnerGroupInfo",data:{aid:i,number:t}})}},SilverBox:{getAward:function(i,t,e){return BilibiliAPI.ajax({url:"lottery/v1/SilverBox/getAward",data:{time_start:i,end_time:t,captcha:e}})},getCaptcha:function(i){return BilibiliAPI.ajax({url:"lottery/v1/SilverBox/getCaptcha?ts="+i})},getCurrentTask:function(){return BilibiliAPI.ajax({url:"lottery/v1/SilverBox/getCurrentTask"})}},Storm:{check:function(i){return BilibiliAPI.ajax({url:"lottery/v1/Storm/check?roomid="+i})},join:function(i,t,e,n){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:16777215;return BilibiliAPI.ajaxWithCommonArgs({method:"POST",url:"lottery/v1/Storm/join",data:{id:i,color:r,captcha_token:t,captcha_phrase:e,roomid:n}})},join_ex:function(i,t,e,n,r){var a=(arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]&&arguments[7],TokenUtil.signQuery(KeySign.sort({id:i,access_key:e,appkey:n,actionKey:"appkey",build:5561e3,channel:"bili",device:"android",mobi_app:"android",platform:"android"})));return BilibiliAPI.ajaxWithCommonArgs({method:"POST",url:"xlive/lottery-interface/v1/storm/Join?"+a,headers:r,roomid:t})}},lottery:{check_guard:function(i){return BilibiliAPI.ajax({url:"lottery/v1/Lottery/check_guard?roomid="+i})},join:function(i,t){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"guard";return BilibiliAPI.ajaxWithCommonArgs({method:"POST",url:"lottery/v2/Lottery/join",data:{roomid:i,id:t,type:e}})}}},mobile:{userOnlineHeart:function(){return BilibiliAPI.ajaxWithCommonArgs({method:"POST",url:"mobile/userOnlineHeart",data:{}})}},pay:{coin2silver:function(i){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"pc";return BilibiliAPI.ajaxWithCommonArgs({method:"POST",url:"pay/v1/Exchange/coin2silver",data:{num:i,platform:t}})},getRule:function(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"pc";return BilibiliAPI.ajax({url:"pay/v1/Exchange/getRule?platform="+i})},getStatus:function(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"pc";return BilibiliAPI.ajax({url:"pay/v1/Exchange/getStatus?platform="+i})},silver2coin:function(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"pc";return BilibiliAPI.ajaxWithCommonArgs({method:"POST",url:"pay/v1/Exchange/silver2coin",data:{platform:i}})}},rankdb:{roomInfo:function(i,t,e){return BilibiliAPI.ajax({url:"rankdb/v1/Common/roomInfo",data:{ruid:i,roomid:t,areaId:e}})},getTopRealTimeHour:function(){return BilibiliAPI.ajax({url:"rankdb/v1/Rank2018/getTop?type=master_realtime_hour&type_id=areaid_realtime_hour"})}},relation:{getList:function(i,t){return BilibiliAPI.ajax({url:"relation/v1/feed/getList",data:{page:i,page_size:t},cache:!1})},heartBeat:function(){return BilibiliAPI.ajax({url:"relation/v1/feed/heartBeat",cache:!1})},GetUserFc:function(i){return BilibiliAPI.ajax({url:"relation/v1/Feed/GetUserFc?follow="+i})},IsUserFollow:function(i){return BilibiliAPI.ajax({url:"relation/v1/Feed/IsUserFollow?follow="+i})}},room:{get_info:function(i){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"room";return BilibiliAPI.ajax({url:"room/v1/Room/get_info",data:{room_id:i,from:t}})},get_recommend_by_room:function(i,t,e){return BilibiliAPI.ajax({url:"room/v1/room/get_recommend_by_room",data:{room_id:i,count:t,rnd:e||Math.floor(Date.now()/1e3)}})},playUrl:function(i){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"0",e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"web";return BilibiliAPI.ajax({url:"room/v1/Room/playUrl",data:{cid:i,quality:t,platform:e}})},room_entry_action:function(i){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"pc";return BilibiliAPI.ajaxWithCommonArgs({method:"POST",url:"room/v1/Room/room_entry_action",data:{room_id:i,platform:t}})},room_init:function(i){return BilibiliAPI.ajax({url:"room/v1/Room/room_init?id="+i})},getConf:function(i){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"pc",e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"web";return BilibiliAPI.ajax({url:"room/v1/Danmu/getConf",data:{room_id:i,platform:t,player:e}})},getList:function(){return BilibiliAPI.ajax({url:"room/v1/Area/getList"})},getRoomList:function(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:30,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"online",o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"web";return BilibiliAPI.ajax({url:"room/v1/area/getRoomList",data:{platform:o,parent_area_id:i,cate_id:t,area_id:e,sort_type:a,page:n,page_size:r}})}},sign:{doSign:function(){return BilibiliAPI.ajax({url:"sign/doSign"})},GetSignInfo:function(){return BilibiliAPI.ajax({url:"sign/GetSignInfo"})},getLastMonthSignDays:function(){return BilibiliAPI.ajax({url:"sign/getLastMonthSignDays"})}},user:{getWear:function(i){return BilibiliAPI.ajax({url:"user/v1/user_title/getWear?uid="+i})},isBiliVip:function(i){return BilibiliAPI.ajax({url:"user/v1/user/isBiliVip?uid="+i})},userOnlineHeart:function(){return BilibiliAPI.ajaxWithCommonArgs({method:"POST",url:"User/userOnlineHeart",data:{}})},getUserInfo:function(i){return BilibiliAPI.ajax({url:"User/getUserInfo?ts="+i})}},x:{coin_add:function(i){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return BilibiliAPI.ajaxWithCommonArgs({method:"POST",url:"//api.bilibili.com/x/web-interface/coin/add",data:{aid:i,multiply:t,cross_domain:!0}})},share_add:function(i){return BilibiliAPI.ajaxWithCommonArgs({method:"POST",url:"//api.bilibili.com/x/web-interface/share/add",data:{aid:i,jsonp:"jsonp"}})},heartbeat:function(i,t,e,n){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:1,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:2;return BilibiliAPI.ajaxWithCommonArgs({method:"POST",url:"//api.bilibili.com/x/report/web/heartbeat",data:{aid:i,cid:t,mid:e,start_ts:n||Date.now()/1e3,played_time:r,realtime:a,type:o,play_type:l,dt:u}})},now:function(){return BilibiliAPI.ajax({url:"//api.bilibili.com/x/report/click/now",data:{jsonp:"jsonp"}})}},xlive:{guard:{join:function(i,t){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"guard";return BilibiliAPI.ajaxWithCommonArgs({method:"POST",url:"xlive/lottery-interface/v3/guard/join",data:{roomid:i,id:t,type:e}})}},lottery:{check:function(i){return BilibiliAPI.ajax({url:"xlive/lottery-interface/v1/lottery/Check",data:{roomid:i}})}},smalltv:{check:function(i){return BilibiliAPI.ajax({url:"xlive/lottery-interface/v3/smalltv/Check",data:{roomid:i}})},join:function(i,t){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"small_tv";return BilibiliAPI.ajaxWithCommonArgs({method:"POST",url:"xlive/lottery-interface/v5/smalltv/join",data:{roomid:i,id:t,type:e}})},notice:function(i){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"small_tv";return BilibiliAPI.ajax({url:"xlive/lottery-interface/v3/smalltv/Notice",data:{type:t,raffleId:i}})}},pk:{check:function(i){return BilibiliAPI.ajax({url:"xlive/lottery-interface/v1/pk/check",data:{roomid:i}})},join:function(i,t){return BilibiliAPI.ajaxWithCommonArgs({method:"POST",url:"xlive/lottery-interface/v1/pk/join",data:{roomid:i,id:t}})}},dosign:function(){return BilibiliAPI.ajax({url:"xlive/web-ucenter/v1/sign/DoSign"})}},YearWelfare:{checkFirstCharge:function(){return BilibiliAPI.ajax({url:"YearWelfare/checkFirstCharge"})},inviteUserList:function(){return BilibiliAPI.ajax({url:"YearWelfare/inviteUserList/1"})}},DanmuWebSocket:function(i){function t(i,e,n,r){_classCallCheck(this,t);var a="wss://broadcastlv.chat.bilibili.com/sub";if(Array.isArray(n)&&n.length>0){var o=!1;do{var l=n.shift();l.wss_port?a="wss://"+l.host+":"+l.wss_port+"/sub":o=!0}while(o&&n.length>0)}else"string"==typeof n&&n.length>0&&(a=n);var u=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,a));return u.binaryType="arraybuffer",u.handlers={reconnect:[],login:[],heartbeat:[],cmd:[],receive:[]},u.host_server_list=n,u.token=r,u.closed=!1,u.addEventListener("open",function(){u.sendLoginPacket(i,e).sendHeartBeatPacket(),u.heartBeatHandler=setInterval(function(){u.sendHeartBeatPacket()},3e4)}),u.addEventListener("close",function(){u.heartBeatHandler&&clearInterval(u.heartBeatHandler),u.closed||setTimeout(function(){var t=new BilibiliAPI.DanmuWebSocket(i,e,u.host_server_list,u.token);t.handlers=u.handlers,t.unzip=u.unzip;for(var n in u.handlers)!function(i){u.handlers.hasOwnProperty(i)&&u.handlers[i].forEach(function(e){switch(i){case"reconnect":t.addEventListener("reconnect",function(i){e.call(t,i.detail.ws)});break;case"login":t.addEventListener("login",function(){e.call(t)});break;case"heartbeat":t.addEventListener("heartbeat",function(i){e.call(t,i.detail.num)});break;case"cmd":t.addEventListener("cmd",function(i){e.call(t,i.detail.obj,i.detail.str)});break;case"receive":t.addEventListener("receive",function(i){e.call(t,i.detail.len,i.detail.headerLen,i.detail.protover,i.detail.operation,i.detail.sequence,i.detail.data)})}})}(n);u.dispatchEvent(new CustomEvent("reconnect",{detail:{ws:t}}))},1e4)}),u.addEventListener("message",function(i){for(var t=new DataView(i.data),e=0,n=0;n<i.data.byteLength;n+=e){e=t.getUint32(n);var r=t.getUint16(n+4),a=t.getUint16(n+6),o=t.getUint32(n+8),l=t.getUint32(n+12),c=i.data.slice(n+r,n+e);if(2===a&&u.unzip&&(c=u.unzip(c)),u.dispatchEvent(new CustomEvent("receive",{detail:{len:e,headerLen:r,protover:a,operation:o,sequence:l,data:c}})),2!==a||u.unzip){var d=new DataView(c);switch(o){case 3:var s=d.getUint32(0);u.dispatchEvent(new CustomEvent("heartbeat",{detail:{num:s}}));break;case 5:var v=BilibiliAPI.DanmuWebSocket.uintToString(new Uint8Array(c)),f=JSON.parse(v);u.dispatchEvent(new CustomEvent("cmd",{detail:{obj:f,str:v}}));break;case 8:u.dispatchEvent(new CustomEvent("login"))}}}}),u}return _inherits(t,i),_createClass(t,null,[{key:"stringToUint",value:function(i){for(var t=i.split(""),e=[],n=0;n<t.length;++n)e.push(t[n].charCodeAt(0));return new Uint8Array(e)}},{key:"uintToString",value:function(i){return decodeURIComponent(escape(String.fromCharCode.apply(null,i)))}}]),_createClass(t,[{key:"close",value:function(i,e){this.closed=!0,_get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"close",this).call(this,i,e)}},{key:"setUnzip",value:function(i){this.unzip=i}},{key:"bind",value:function(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,n=this,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0;"function"==typeof i&&(this.addEventListener("reconnect",function(t){i.call(n,t.detail.ws)}),this.handlers.reconnect.push(i)),"function"==typeof t&&(this.addEventListener("login",function(){t.call(n)}),this.handlers.login.push(t)),"function"==typeof e&&(this.addEventListener("heartbeat",function(i){e.call(n,i.detail.num)}),this.handlers.heartbeat.push(e)),"function"==typeof r&&(this.addEventListener("cmd",function(i){r.call(n,i.detail.obj,i.detail.str)}),this.handlers.cmd.push(r)),"function"==typeof a&&(this.addEventListener("receive",function(i){a.call(n,i.detail.len,i.detail.headerLen,i.detail.protover,i.detail.operation,i.detail.sequence,i.detail.data)}),this.handlers.receive.push(a))}},{key:"sendData",value:function(i,t,e,n){if(this.readyState!==WebSocket.OPEN)throw new Error("DanmuWebSocket未连接");switch(Object.prototype.toString.call(i)){case"[object Object]":return this.sendData(JSON.stringify(i),t,e,n);case"[object String]":var r=BilibiliAPI.DanmuWebSocket.stringToUint(i),a=new ArrayBuffer(BilibiliAPI.DanmuWebSocket.headerLength+r.byteLength),o=new DataView(a);o.setUint32(0,BilibiliAPI.DanmuWebSocket.headerLength+r.byteLength),o.setUint16(4,BilibiliAPI.DanmuWebSocket.headerLength),o.setUint16(6,parseInt(t,10)),o.setUint32(8,parseInt(e,10)),o.setUint32(12,parseInt(n,10));for(var l=0;l<r.byteLength;++l)o.setUint8(BilibiliAPI.DanmuWebSocket.headerLength+l,r[l]);return this.send(a),this;default:this.send(i)}return this}},{key:"sendLoginPacket",value:function(i,t){var e={uid:parseInt(i,10),roomid:parseInt(t,10),protover:2,platform:"web",clientver:"1.8.5",type:2,key:this.token};return this.sendData(e,1,7,1)}},{key:"sendHeartBeatPacket",value:function(){return this.sendData("[object Object]",1,2,1)}}]),t}(WebSocket),sendLiveDanmu:function(i,t){var e=new Date;return BilibiliAPI.ajaxWithCommonArgs({method:"POST",url:"msg/send",data:{color:"16777215",fontsize:"25",mode:"1",msg:i,rnd:e.getTime(),roomid:t,bubble:"0"}})},getCookie:function(i){for(var t=document.cookie.split(";"),e=void 0,n=0;n<t.length;n++)if(e=t[n].split("="),e[0].replace(" ","")==i)return decodeURIComponent(e[1])},KeySign:{sort:function(i){var t=Object.keys(i).sort(),e=[],n=!0,r=!1,a=void 0;try{for(var o,l=t[Symbol.iterator]();!(n=(o=l.next()).done);n=!0){var u=o.value;e.push(u+"="+i[u])}}catch(i){r=!0,a=i}finally{try{!n&&l.return&&l.return()}finally{if(r)throw a}}return e.join("&")}}};BilibiliAPI.DanmuWebSocket.headerLength=16;