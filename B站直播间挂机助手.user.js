// ==UserScript==
// @namespace      https://github.com/andywang425
// @name           B站直播间挂机助手
// @name:en        B站直播间挂机助手
// @author         andywang425
// @description    自动参与Bilibili直播区抽奖(现在极少)，直播区签到，完成主站每日任务，领银瓜子宝箱，自动送礼，自动获取小心心，批量点亮勋章，快捷购买粉丝勋章
// @description:en 自动参与Bilibili直播区抽奖(现在极少)，直播区签到，完成主站每日任务，领银瓜子宝箱，自动送礼，自动获取小心心，批量点亮勋章，快捷购买粉丝勋章
// @updateURL      https://raw.githubusercontent.com/andywang425/Bilibili-SGTH/master/B%E7%AB%99%E7%9B%B4%E6%92%AD%E9%97%B4%E6%8C%82%E6%9C%BA%E5%8A%A9%E6%89%8B.user.js
// @downloadURL    https://raw.githubusercontent.com/andywang425/Bilibili-SGTH/master/B%E7%AB%99%E7%9B%B4%E6%92%AD%E9%97%B4%E6%8C%82%E6%9C%BA%E5%8A%A9%E6%89%8B.user.js
// @homepageURL    https://github.com/andywang425/BLTH/
// @supportURL     https://github.com/andywang425/BLTH/issues
// @icon           https://s1.hdslb.com/bfs/live/d57afb7c5596359970eb430655c6aef501a268ab.png
// @copyright      2020, andywang425 (https://github.com/andywang425)
// @license        MIT
// @compatible     chrome 80 or later
// @compatible     firefox 77 or later
// @compatible     opera 69 or later
// @version        4.3
// @include       /https?:\/\/live\.bilibili\.com\/[blanc\/]?[^?]*?\d+\??.*/
// @run-at        document-start
// @connect       passport.bilibili.com
// @connect       api.live.bilibili.com
// @connect       live-trace.bilibili.com
// @require       https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js
// @require       https://cdn.jsdelivr.net/gh/andywang425/BLTH@ae50298c8b1ce34108d737606ae254f448b0a22e/library_files/BilibiliAPI_Mod.min.js
// @require       https://cdn.jsdelivr.net/gh/andywang425/BLTH@ae50298c8b1ce34108d737606ae254f448b0a22e/library_files/OCRAD.min.js
// @require       https://cdn.jsdelivr.net/gh/andywang425/BLTH@ae50298c8b1ce34108d737606ae254f448b0a22e/library_files/layer.js
// @require       https://cdn.jsdelivr.net/gh/andywang425/BLTH@ae50298c8b1ce34108d737606ae254f448b0a22e/library_files/libBilibiliToken.js
// @require       https://cdn.jsdelivr.net/gh/andywang425/BLTH@ae50298c8b1ce34108d737606ae254f448b0a22e/library_files/libWasmHash.js
// @grant        unsafeWindow
// @grant        GM_xmlhttpRequest
// ==/UserScript==
'use strict';var _Mathceil=Math.ceil,_Mathmax=Math.max,_Mathmin=Math.min,_Mathfloor=Math.floor,_Mathround=Math.round,_typeof='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&'function'==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?'symbol':typeof o};function _defineProperty(o,l,_){return l in o?Object.defineProperty(o,l,{value:_,enumerable:!0,configurable:!0,writable:!0}):o[l]=_,o}function _asyncToGenerator(o){return function(){var l=o.apply(this,arguments);return new Promise(function(_,u){function I(T,f){try{var E=l[T](f),O=E.value}catch(C){return void u(C)}return E.done?void _(O):Promise.resolve(O).then(function(C){I('next',C)},function(C){I('throw',C)})}return I('next')})}}(function(){var G=this,N='IGIFTMSG',A=localStorage.getItem(N+'_msgHide')||'hide',D=BilibiliAPI,M=0,S=0,L=0,F=!1,w=!1,k=!0,U=[],H={room_id:void 0,uid:void 0,ruid:void 0,tid:void 0,mobile_verify:void 0,gift_list:void 0,rnd:void 0,visit_id:void 0,identification:void 0,bili_jct:void 0},B=navigator.userAgent,P=new Date().getTimezoneOffset()+480,Y=function ts_ms(){return Date.now()},X=function ts_s(){return _Mathround(Y()/1e3)},V=function runUntilSucceed(_e){var ge=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,ue=2<arguments.length&&arguments[2]!==void 0?arguments[2]:100;setTimeout(function(){_e()||V(_e,ue,ue)},ge)},K=function delayCall(_e){var ge=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1e4,ue=$.Deferred();return setTimeout(function(){var ce=_e();ce&&ce.then?ce.then(function(pe,Ie,Te,fe,me,Ee){return ue.resolve(pe,Ie,Te,fe,me,Ee)}):ue.resolve()},ge),ue},Q=function MYDEBUG(_e){for(var ge=arguments.length,ue=Array(1<ge?ge-1:0),ce=1;ce<ge;ce++)ue[ce-1]=arguments[ce];var pe=new Date;return pe='['+N+']['+pe.getHours()+':'+pe.getMinutes()+':'+pe.getSeconds()+':'+pe.getMilliseconds()+']',1===ue.length?void console.log(pe,_e+':',ue[0]):void console.log(pe,_e+':',ue)},z=function runMidnight(_e,ge){var ue=new Date;ue.setMinutes(ue.getMinutes()+P),ue.setDate(ue.getDate()+1),ue.setHours(0,1,0,0),ue.setMinutes(ue.getMinutes()-P),setTimeout(_e,ue-Y()),Q('runMidnight',(ge||' ')+' '+ue.toString())},Z=function runExactMidnight(_e,ge){var ue=new Date;ue.setMinutes(ue.getMinutes()+P),ue.setDate(ue.getDate()+1),ue.setHours(0,0,0,0),ue.setMinutes(ue.getMinutes()-P),setTimeout(_e,ue-Y()),Q('runExactMidnight',(ge||' ')+' '+ue.toString())},J=function runTomorrow(_e,ge,ue,ce){var pe=new Date;pe.setMinutes(pe.getMinutes()+P),pe.setDate(pe.getDate()+1),pe.setHours(ge,ue,0,0),pe.setMinutes(pe.getMinutes()-P),setTimeout(_e,pe-Y()),Q('runTomorrow',(ce||' ')+' '+pe.toString())},ee=new BilibiliToken,te='actionKey=appkey&appkey='+BilibiliToken.appKey+'&build=5561000&channel=bili&device=android&mobi_app=android&platform=android&statistics=%7B%22appId%22%3A1%2C%22platform%22%3A3%2C%22version%22%3A%225.57.0%22%2C%22abtest%22%3A%22%22%7D',ie=void 0,ae=JSON.parse(localStorage.getItem(N+'_Token'))||{},oe=function(){var _e=_asyncToGenerator(regeneratorRuntime.mark(function ge(){return regeneratorRuntime.wrap(function(ce){for(;;)switch(ce.prev=ce.next){case 0:if(!(ae.time>X())){ce.next=4;break}ie=ae,ce.next=10;break;case 4:return ce.next=6,ee.getToken();case 6:ae=ce.sent,ae.time=X()+ae.expires_in,localStorage.setItem(N+'_Token',JSON.stringify(ae)),ie=ae;case 10:;return Q(N+'_Token',ae),ce.abrupt('return','OK');case 13:case'end':return ce.stop();}},ge,G)}));return function setToken(){return _e.apply(this,arguments)}}(),ne={init:function init(){return ne.Toast.init().then(function(){})},Toast:{init:function init(){try{var _e=[];return window.toast=function(ge){var ue=1<arguments.length&&void 0!==arguments[1]?arguments[1]:'info',ce=2<arguments.length&&void 0!==arguments[2]?arguments[2]:5e3;switch(ue){case'success':case'info':break;case'caution':break;case'error':break;default:ue='info';}var pe=$('<div class="link-toast '+ue+' fixed"><span class="toast-text">'+ge+'</span></div>')[0];document.body.appendChild(pe),pe.style.top=document.body.scrollTop+40*_e.length+10+'px',pe.style.left=document.body.offsetWidth+document.body.scrollLeft-pe.offsetWidth-5+'px','hide'==A&&$('.link-toast').hide(),_e.push(pe),setTimeout(function(){pe.className+=' out',setTimeout(function(){_e.shift(),_e.forEach(function(Ie){Ie.style.top=parseInt(Ie.style.top,10)-40+'px'}),$(pe).remove()},200)},ce)},$.Deferred().resolve()}catch(_e){return console.error('\u521D\u59CB\u5316\u6D6E\u52A8\u63D0\u793A\u65F6\u51FA\u73B0\u5F02\u5E38',_e),$.Deferred().reject()}}}};function o(){var ge,_e=this,ue={CONFIG_DEFAULT:{AUTO_GIFT:!1,AUTO_GIFT_ROOMID:'0',AUTO_GROUP_SIGN:!0,AUTO_TREASUREBOX:!0,CHECK_HOUR_ROOM:!0,CHECK_HOUR_ROOM_INTERVAL:600,COIN:!1,COIN_NUMBER:0,COIN_TYPE:'COIN_DYN',COIN_UID:0,EXCLUDE_ROOMID:'0',FORCE_LOTTERY:!1,FORCE_LIGHT:!1,GIFT_LIMIT:1,GIFT_SEND_HOUR:23,GIFT_SEND_MINUTE:59,GIFT_INTERVAL:5,GIFT_METHOD:'GIFT_SEND_TIME',GIFT_SORT:'high',IN_TIME_RELOAD_DISABLE:!1,LOTTERY:!0,LIVE_SIGN:!0,LOGIN:!0,LITTLE_HEART:!1,LIGHT_MEDALS:'0',LIGHT_METHOD:'LIGHT_WHITE',MAX_GIFT:99999,NOSLEEP:!0,RANDOM_DELAY:!0,RANDOM_SEND_DANMU:0,RANDOM_SKIP:0,REMOVE_ELEMENT_2233:!1,REMOVE_ELEMENT_activity:!1,RND_DELAY_END:5,RND_DELAY_START:2,SEND_ALL_GIFT:!1,SHARE:!0,SILVER2COIN:!1,SPARE_GIFT_ROOM:'0',STORM:!1,STORM_MAX_COUNT:100,STORM_ONE_LIMIT:200,STORM_QUEUE_SIZE:3,TIME_AREA_DISABLE:!0,TIME_AREA_END_H0UR:8,TIME_AREA_END_MINUTE:0,TIME_AREA_START_H0UR:2,TIME_AREA_START_MINUTE:0,TIME_RELOAD:120,WATCH:!0},CACHE_DEFAULT:{UNIQUE_CHECK:0,AUTO_GROUP_SIGH_TS:0,DailyReward_TS:0,LiveReward_TS:0,TreasureBox_TS:0,Silver2Coin_TS:0,Gift_TS:0,GiftInterval_TS:0,MobileHeartBeat_TS:0,LittleHeart_TS:0},CONFIG:{},CACHE:{},GIFT_COUNT:{COUNT:0,SILVER_COUNT:0,CLEAR_TS:0},init:function init(){try{D.setCommonArgs(H.bili_jct)}catch(pe){return void console.error('['+N+']',pe)}var ce=$.Deferred();try{ue.loadConfig().then(function(){ue.chatLog('\u811A\u672C\u8F7D\u5165\u914D\u7F6E\u6210\u529F','success'),ce.resolve()})}catch(pe){console.error('API\u521D\u59CB\u5316\u51FA\u9519',pe),ue.chatLog('API\u521D\u59CB\u5316\u51FA\u9519','error'),ce.reject()}try{ue.loadCache().then(function(){window.toast('CACHE\u8F7D\u5165\u6210\u529F','success'),ce.resolve()})}catch(pe){console.error('CACHE\u521D\u59CB\u5316\u51FA\u9519',pe),window.toast('CACHE\u521D\u59CB\u5316\u51FA\u9519','error'),ce.reject()}return setTimeout(ue.TreasureBox.init,5750),ce},loadConfig:function loadConfig(){var ce=$.Deferred();try{var pe=JSON.parse(localStorage.getItem(N+'_CONFIG'));for(var Ie in $.extend(!0,ue.CONFIG,ue.CONFIG_DEFAULT),ue.CONFIG)ue.CONFIG.hasOwnProperty(Ie)&&void 0!==pe[Ie]&&null!==pe[Ie]&&(ue.CONFIG[Ie]=pe[Ie]);ue.loadGiftCount(),ce.resolve()}catch(pe){Q('API\u8F7D\u5165\u914D\u7F6E\u5931\u8D25\uFF0C\u52A0\u8F7D\u9ED8\u8BA4\u914D\u7F6E',pe),ue.setDefaults(),ce.reject()}return ce},loadCache:function loadCache(){var ce=$.Deferred();try{var pe=JSON.parse(localStorage.getItem(N+'_CACHE'));for(var Ie in $.extend(!0,ue.CACHE,ue.CACHE_DEFAULT),ue.CACHE)ue.CACHE.hasOwnProperty(Ie)&&void 0!==pe[Ie]&&null!==pe[Ie]&&(ue.CACHE[Ie]=pe[Ie]);ce.resolve()}catch(pe){Q('CACHE\u8F7D\u5165\u914D\u7F6E\u5931\u8D25\uFF0C\u52A0\u8F7D\u9ED8\u8BA4\u914D\u7F6E',pe),ue.setDefaults(),ce.reject()}return ce},newMessage:function newMessage(ce){try{var pe=localStorage.getItem(N+'_NEWMSG_CACHE');if((pe==void 0||null==pe||'4.3'!=pe)&&'4.3'==ce){var Ie=function linkMsg(Te,fe){return'<a href="'+fe+'"target="_blank">'+Te+'</a>'};layer.open({title:ce+'\u66F4\u65B0\u63D0\u793A',content:'<strong>1.\u901A\u8FC7\u53D1\u9001\u5FC3\u8DF3\u5305\u7684\u65B9\u5F0F\u83B7\u53D6\u5C0F\u5FC3\u5FC3\uFF0C\u4E14\u65E0\u8BBA\u76EE\u6807\u623F\u95F4\u662F\u5426\u5F00\u64AD\u90FD\u80FD\u83B7\u53D6\u5C0F\u5FC3\u5FC3<br>2.\u65B0\u589E\u9632\u6302\u673A\u68C0\u6D4B\u529F\u80FD<br></strong>3.\u5220\u9664\u4E86\u4E4B\u524D\u7684\u79FB\u52A8\u7AEF\u5FC3\u8DF3\u529F\u80FD<br>\n                            <em style="color:grey;">\n                            \u5982\u679C\u4F7F\u7528\u8FC7\u7A0B\u4E2D\u9047\u5230\u95EE\u9898\uFF0C\u6B22\u8FCE\u53BB'+Ie('github','https://github.com/andywang425/BLTH/issues')+'\n                            \uFF08\u6216\u8005\u8FDBqq\u7FA4'+Ie('1106094437','https://jq.qq.com/?_wv=1027&amp;k=fCSfWf1O')+'\uFF09\u53CD\u9988\u3002\n                            </em>'}),localStorage.setItem(N+'_NEWMSG_CACHE',ce)}}catch(pe){Q('\u63D0\u793A\u4FE1\u606FCACHE\u8F7D\u5165\u5931\u8D25',pe)}},saveConfig:function saveConfig(){try{return localStorage.setItem(N+'_CONFIG',JSON.stringify(ue.CONFIG)),ue.chatLog('\u914D\u7F6E\u5DF2\u4FDD\u5B58'),Q('MY_API.CONFIG',ue.CONFIG),!0}catch(ce){return Q('API\u4FDD\u5B58\u51FA\u9519',ce),!1}},saveCache:function saveCache(ce){try{return localStorage.setItem(N+'_CACHE',JSON.stringify(ue.CACHE)),!1!=ce&&Q('CACHE\u5DF2\u4FDD\u5B58',ue.CACHE),!0}catch(pe){return Q('CACHE\u4FDD\u5B58\u51FA\u9519',pe),!1}},setDefaults:function setDefaults(){ue.CONFIG=ue.CONFIG_DEFAULT,ue.CACHE=ue.CACHE_DEFAULT,ue.saveConfig(),ue.saveCache(),ue.chatLog('\u914D\u7F6E\u548CCACHE\u5DF2\u91CD\u7F6E\u4E3A\u9ED8\u8BA4\u30023\u79D2\u540E\u5237\u65B0\u9875\u9762'),setTimeout(function(){window.location.reload()},3e3)},ReDoDailyTasks:function ReDoDailyTasks(){window.toast('3\u79D2\u540E\u518D\u6B21\u6267\u884C\u6240\u6709\u4EFB\u52A1','info'),setTimeout(function(){ue.CACHE=ue.CACHE_DEFAULT,ue.GroupSign.run(),ue.DailyReward.run(),ue.LiveReward.run(),ue.Exchange.runS2C(),ue.TreasureBox.run(),ue.Gift.run(),ue.LITTLE_HEART.run(),ue.MobileHeartBeat.run()},3e3)},loadGiftCount:function loadGiftCount(){try{var ce=JSON.parse(localStorage.getItem(N+'_GIFT_COUNT'));for(var pe in ue.GIFT_COUNT)ue.GIFT_COUNT.hasOwnProperty(pe)&&void 0!==ce[pe]&&null!==ce[pe]&&(ue.GIFT_COUNT[pe]=ce[pe]);Q('MY_API.GIFT_COUNT',ue.GIFT_COUNT)}catch(ce){Q('\u8BFB\u53D6\u7EDF\u8BA1\u5931\u8D25',ce)}},saveGiftCount:function saveGiftCount(){try{return localStorage.setItem(N+'_GIFT_COUNT',JSON.stringify(ue.GIFT_COUNT)),Q('\u7EDF\u8BA1\u4FDD\u5B58\u6210\u529F',ue.GIFT_COUNT),!0}catch(ce){return Q('\u7EDF\u8BA1\u4FDD\u5B58\u51FA\u9519',ce),!1}},addGift:function addGift(ce){ue.GIFT_COUNT.COUNT+=ce,$('#giftCount span:eq(0)').text(ue.GIFT_COUNT.COUNT),ue.saveGiftCount()},addSilver:function addSilver(ce){ue.GIFT_COUNT.SILVER_COUNT+=ce,$('#giftCount span:eq(1)').text(ue.GIFT_COUNT.SILVER_COUNT),ue.saveGiftCount()},removeUnnecessary:function removeUnnecessary(){for(var ce=['#my-dear-haruna-vm','.activity-entry','.bilibili-live-player'],pe=['REMOVE_ELEMENT_2233','REMOVE_ELEMENT_activity','REMOVE_ELEMENT_player'],Ie=function removeUntiSucceed(Te){ue.CONFIG[pe[Te]]&&setInterval(function(){0<$(ce[Te]).length&&$(ce[Te]).remove()},200)},Te=0;Te<ce.length-1;Te++)Ie(Te);ue.CONFIG.NOSLEEP&&setInterval(function(){return document.dispatchEvent(new Event('visibilitychange'))},600000)},creatSetBox:function creatSetBox(){var ce=['.chat-history-list','.attention-btn-ctnr','.live-player-mounter'],pe=!0,Ie=!1,Te=void 0;try{for(var me,De,fe=ce[Symbol.iterator]();!(pe=(me=fe.next()).done);pe=!0)if(De=me.value,0===$(De).length)return K(function(){return ue.creatSetBox()},200)}catch(De){Ie=!0,Te=De}finally{try{!pe&&fe.return&&fe.return()}finally{if(Ie)throw Te}}var Ee='hide'==A?'\u663E\u793A\u7A97\u53E3\u548C\u63D0\u793A\u4FE1\u606F':'\u9690\u85CF\u7A97\u53E3\u548C\u63D0\u793A\u4FE1\u606F',Oe=$('<button style="display: inline-block; float: left; margin-right: 7px;background-color: #23ade5;color: #fff;border-radius: 4px;border: none; padding:4px; cursor: pointer;box-shadow: 1px 1px 2px #00000075;" id="hiderbtn">'+Ee+'<br></button>'),ve='#allsettings',xe=$('.chat-history-list'),he,Ce=$('.live-player-mounter').height(),ye=$('.live-player-mounter').offset(),Ge='"float:left"';-1<B.toLowerCase().indexOf('firefox')&&(Ge='""');var Ne='\n                <div id=\'allsettings\' class = "igiftMsg_main">\n    <fieldset class="igiftMsg_fs">\n        <legend style="color: black">\u4ECA\u65E5\u7EDF\u8BA1</legend>\n        <div id="giftCount" style="font-size: large; text-shadow: 1px 1px #00000066; color: blueviolet;">\n            \u8FA3\u6761&nbsp;<span>'+ue.GIFT_COUNT.COUNT+'</span>\n            \u94F6\u74DC\u5B50&nbsp;<span>'+ue.GIFT_COUNT.SILVER_COUNT+'\u4E07</span>\n            <button style="font-size: small" class="igiftMsg_btn" data-action="save">\u4FDD\u5B58\u6240\u6709\u8BBE\u7F6E</button>\n        </div>\n    </fieldset>\n    <div id="left_fieldset" style='+Ge+'>\n        <fieldset class="igiftMsg_fs">\n            <legend style="color: black">\u62BD\u5956\u8BBE\u7F6E</legend>\n        <div data-toggle="LOTTERY">\n            <label style="margin: 5px auto; color: purple;line-height:30px";>\n                <input style="vertical-align: text-top;" type="checkbox">\n                \u53C2\u4E0E\u62BD\u5956\n            </label>\n        </div>\n            <div data-toggle="RANDOM_DELAY">\n                <label style="margin: 5px auto; color: darkgreen">\n                    <input style="vertical-align: text-top;" type="checkbox">\n                    \u62BD\u5956\u9644\u52A0\u968F\u673A\u5EF6\u8FDF\n                    <input class="RND_DELAY_START igiftMsg_input" style="width: 30px;vertical-align: top;" type="text">~\n                    <input class="RND_DELAY_END igiftMsg_input" style="width: 30px;vertical-align: top;" type="text">s\n                </label>\n            </div>\n            <div data-toggle="TIME_AREA_DISABLE">\n                <label style="margin: 5px auto; color: darkgreen">\n                    <input style="vertical-align: text-top;" type="checkbox">\n                    \u542F\u7528\n                    <input class="startHour igiftMsg_input" style="width: 20px;" type="text">\u70B9\n                    <input class="startMinute igiftMsg_input" style="width: 20px;" type="text">\u5206\u81F3\n                    <input class="endHour igiftMsg_input" style="width: 20px;" type="text">\u70B9\n                    <input class="endMinute igiftMsg_input" style="width: 20px;" type="text">\u5206\u4E0D\u62BD\u5956(24\u5C0F\u65F6\u5236)\n                </label>\n            </div>\n            <div data-toggle="RANDOM_SKIP">\n                <label style="margin: 5px auto; color: darkgreen">\n                    \u968F\u673A\u8DF3\u8FC7\u793C\u7269(0\u5230100,\u4E3A0\u5219\u4E0D\u8DF3\u8FC7)<input class="per igiftMsg_input" style="width: 30px;" type="text">%\n                </label>\n            </div>\n            <div data-toggle="MAX_GIFT">\n                <label style="margin: 5px auto; color: darkgreen">\n                    \u5F53\u5929\u6700\u591A\u62A2\u8FA3\u6761\u6570\u91CF<input class="num igiftMsg_input" style="width: 100px;" type="text">\n                </label>\n            </div>\n            <div data-toggle="RANDOM_SEND_DANMU">\n                <label style="margin: 5px auto; color: darkgreen">\n                    \u62BD\u5956\u65F6\u6D3B\u8DC3\u5F39\u5E55\u53D1\u9001\u6982\u7387(0\u52305,\u4E3A0\u5219\u4E0D\u53D1\u9001)<input class="per igiftMsg_input" style="width: 30px;" type="text">%\n                </label>\n            </div>\n            <div data-toggle="CHECK_HOUR_ROOM">\n                <label style="margin: 5px auto; color: darkgreen">\n                    <input style="vertical-align: text-top;" type="checkbox">\n                    \u68C0\u67E5\u5C0F\u65F6\u699C\uFF08\u95F4\u9694\u65F6\u95F4<input class="num igiftMsg_input" style="width: 25px;" type="text">\u79D2\uFF09\n                </label>\n            </div>\n            <div data-toggle="FORCE_LOTTERY" style="line-height: 20px">\n            <label style="margin: 5px auto; color: red;">\n                <input style="vertical-align: text-top;" type="checkbox">\n                \u8BBF\u95EE\u88AB\u62D2\u7EDD\u540E\u5F3A\u5236\u91CD\u590D\u62BD\u5956(\u6700\u591A5\u6B21)\n            </label>\n        </div>\n        </fieldset>\n\n        <fieldset class="igiftMsg_fs" style ="line-height:16px;">\n            <legend style="color: black">\u6BCF\u65E5\u4EFB\u52A1\u8BBE\u7F6E</legend>\n            <div data-toggle="LOGIN" style=" color: black">\n                <input style="vertical-align: text-top;" type="checkbox">\n                \u767B\u9646\n            </div>\n            <div data-toggle="WATCH" style=" color: black">\n                <input style="vertical-align: text-top;" type="checkbox">\n                \u89C2\u770B\u89C6\u9891\n            </div>\n            <div data-toggle="COIN" style=" color: black">\n                <label style="cursor: pointer">\n                    <input style="vertical-align: text-top;" type="checkbox">\n                    \u81EA\u52A8\u6295\u5E01<input class="coin_number igiftMsg_input" style="width: 40px;" type="text">\u4E2A(0-5)\n                </label>\n            </div>\n            <div data-toggle="COIN_TYPE" style=" color: black">\n                <div data-toggle="COIN_UID">\n                <input style="vertical-align: text-top;" type="radio" name="COIN_TYPE">\n                \u7ED9\u7528\u6237(UID:<input class="num igiftMsg_input" style="width: 80px;" type="text">)\n                \u7684\u89C6\u9891\u6295\u5E01\n                </div>\n                <div data-toggle="COIN_DYN">\n                    <input style="vertical-align: text-top;" type="radio" name="COIN_TYPE">\n                    \u7ED9\u52A8\u6001\u4E2D\u7684\u7684\u89C6\u9891\u6295\u5E01\n                </div>\n            </div>\n            <div data-toggle="SHARE" style=" color: black">\n                <input style="vertical-align: text-top;" type="checkbox">\n                \u5206\u4EAB\u89C6\u9891\n            </div>\n            <div data-toggle="SILVER2COIN" style=" color: black">\n                <input style="vertical-align: text-top;" type="checkbox">\n                \u94F6\u74DC\u5B50\u6362\u786C\u5E01\n            </div>\n            <div data-toggle="LIVE_SIGN" style=" color: black">\n                <input style="vertical-align: text-top;" type="checkbox">\n                \u76F4\u64AD\u533A\u7B7E\u5230\n            </div>\n            <div data-toggle="AUTO_GROUP_SIGN" style=" color: darkgreen">\n                <input style="vertical-align: text-top;" type="checkbox">\n                \u5E94\u63F4\u56E2\u7B7E\u5230\n            </div>\n            <div data-toggle="AUTO_TREASUREBOX" style=" color: purple">\n                <input style="vertical-align: text-top;" type="checkbox">\n                \u81EA\u52A8\u9886\u94F6\u74DC\u5B50\u5B9D\u7BB1\n            </div>\n        </fieldset>\n        <fieldset class="igiftMsg_fs">\n            <legend style="color: black">\u81EA\u52A8\u9001\u793C\u8BBE\u7F6E</legend>\n            <div data-toggle="AUTO_GIFT" style=" color: purple">\n                <input style="vertical-align: text-top;" type="checkbox">\n                \u81EA\u52A8\u9001\u793C\n            </div>\n\n            <div data-toggle="AUTO_GIFT_ROOMID" style=" color: purple">\n                \u4F18\u5148\u9001\u793C\u623F\u95F4\n                <input class="num igiftMsg_input" style="width: 150px;" type="text">\n            </div>\n\n            <div data-toggle="EXCLUDE_ROOMID" style=" color: purple">\n                \u4E0D\u9001\u793C\u623F\u95F4\n                <input class="num igiftMsg_input" style="width: 150px;" type="text">\n            </div>\n            <div data-toggle="GIFT_INTERVAL" style=" color: black">\n                <input style="vertical-align: text-top;" type="radio" name="GIFT_TYPE">\n                \u95F4\u9694\n                <input class="num igiftMsg_input" style="width: 30px;" type="text">\n                \u5206\u949F\u9001\u793C\n            </div>\n            <div data-toggle="GIFT_SEND_TIME" style=" color: purple">\n                <input style="vertical-align: text-top;" type="radio" name="GIFT_TYPE">\n                \u5B9A\u65F6\u9001\u793C<br>&nbsp;&nbsp;&nbsp;&nbsp;\n                \u9001\u793C\u65F6\u95F4\n                <input class="Hour igiftMsg_input" style="width: 20px;" type="text">\u70B9\n                <input class="Minute igiftMsg_input" style="width: 20px;" type="text">\u5206\n                <button style="font-size: small" class="igiftMsg_btn" data-action="sendGiftNow">\u7ACB\u523B\u5F00\u59CB\u9001\u793C</button>\n            </div>\n            \n            <div data-toggle="GIFT_LIMIT" style=" color: purple">\n                \u793C\u7269\u5230\u671F\u65F6\u95F4\n                <input class="num igiftMsg_input" style="width: 20px;" type="text">\n                \u5929\n            </div>\n            <div data-toggle="GIFT_SORT_HIGH" style=" color: black;line-height: 20px;">\n            \u7C89\u4E1D\u724C\u9001\u793C\u4F18\u5148\u7EA7<br>\n            &nbsp;&nbsp;&nbsp;&nbsp;<input style="vertical-align: text-top;" type="radio" name = "GIFT_SORT">\n                \u4F18\u5148<strong style="color: purple">\u9AD8</strong>\u7B49\u7EA7\u7C89\u4E1D\u724C\n            </div>\n            <div data-toggle="GIFT_SORT_LOW" style=" color: black">\n            &nbsp;&nbsp;&nbsp;&nbsp;<input style="vertical-align: text-top;" type="radio" name = "GIFT_SORT">\n            \u4F18\u5148<strong style="color: purple">\u4F4E</strong>\u7B49\u7EA7\u7C89\u4E1D\u724C\n            </div>\n            <div data-toggle="SEND_ALL_GIFT" style="color: #ff5200;line-height:15px;">\n                <input style="vertical-align: text-top;" type="checkbox">\n                \u65E0\u89C6\u793C\u7269\u7C7B\u578B\u548C\u5230\u671F\u65F6\u95F4\u9650\u5236\n            </div>\n            <div data-toggle="SPARE_GIFT_ROOM" style="color: black;line-height:20px;">\n                \u5269\u4F59\u793C\u7269\u9001\u793C\u76F4\u64AD\u95F4\uFF1A\n                <input class="num igiftMsg_input" type="text" style="width: 100px;">\n            </div>\n        </fieldset>\n        <fieldset class="igiftMsg_fs">\n            <legend style="color: black">\u8282\u594F\u98CE\u66B4\u8BBE\u7F6E</legend>\n            <div data-toggle="STORM" style="line-height: 15px">\n                <label style="margin: 5px auto; color: #ff5200">\n                    <input style="vertical-align: text-top;" type="checkbox">\n                    \u53C2\u4E0E\u8282\u594F\u98CE\u66B4\n                </label>\n            </div>\n            <div data-toggle="STORM_QUEUE_SIZE" style="color: black">\n                \u5141\u8BB8\u540C\u65F6\u53C2\u4E0E\u7684\u8282\u594F\u98CE\u66B4\u6B21\u6570\uFF1A\n                <input class="num igiftMsg_input" type="text" style="width: 30px;">\n            </div>\n            <div data-toggle="STORM_MAX_COUNT" style="color: black">\n                \u5355\u4E2A\u98CE\u66B4\u6700\u5927\u5C1D\u8BD5\u6B21\u6570\uFF1A\n                <input class="num igiftMsg_input" type="text" style="width: 30px;">\n            </div>\n            <div data-toggle="STORM_ONE_LIMIT" style="color: black">\n                \u5355\u4E2A\u98CE\u66B4\u53C2\u4E0E\u6B21\u6570\u95F4\u9694\uFF1A\n                <input class="num igiftMsg_input" type="text" style="width: 30px;">\n                \u6BEB\u79D2\n            </div>\n        </fieldset>\n    </div>\n\n\n\n    <div id="right_fieldset" style='+Ge+'>\n        <fieldset class="igiftMsg_fs">\n            <legend style="color: black">\u8D2D\u4E70\u7C89\u4E1D\u52CB\u7AE0</legend>\n            <div data-toggle="BUY_MEDAL" style="color: black; line-height: 15px">\n            \u8F93\u5165\u7C89\u4E1D\u52CB\u7AE0\u5BF9\u5E94\u623F\u95F4\u53F7\uFF1A<input class="num igiftMsg_input" type="text" value = '+H.room_id+' onclick="select();" style="width: 70px">\n            <button  class="igiftMsg_btn" data-action="buy_medal">\u70B9\u51FB\u8D2D\u4E70\u52CB\u7AE0</button>\n            \uFF08\u82B1\u8D3920\u786C\u5E01\uFF09\n        </div>\n        </fieldset>\n        <fieldset class="igiftMsg_fs">\n            <legend style="color: black">\u5C0F\u5FC3\u5FC3</legend>\n            <div data-toggle="LITTLE_HEART" style="line-height: 15px">\n                <label style="margin: 5px auto; color: black">\n                    <input style="vertical-align: text-top;" type="checkbox"> \u81EA\u52A8\u83B7\u53D6\u5C0F\u5FC3\u5FC3\n                </label>\n            </div>\n            <div data-toggle="LIGHT_MEDALS" style=" color: purple">\n                \u81EA\u52A8\u70B9\u4EAE\u52CB\u7AE0\u623F\u95F4\u53F7\n            <input class="num igiftMsg_input" style="width: 300px;" type="text">\n        </div>\n        <div data-toggle="LIGHT_METHOD" style="line-height: 15px; color: black; display:inline">\n            \u52CB\u7AE0\u70B9\u4EAE\u6A21\u5F0F\uFF1A&nbsp;&nbsp;\n            <div data-toggle="LIGHT_WHITE" style="color: black; display:inline">\n                <input style="vertical-align: text-top;" type="radio" name="LIGHT_TYPE">\n                \u767D\u540D\u5355\n            </div>\n            <div data-toggle="LIGHT_BLACK" style="color: black; display:inline">\n                &nbsp;\n                <input style="vertical-align: text-top;" type="radio" name="LIGHT_TYPE">\n                \u9ED1\u540D\u5355\n            </div>\n            <button style="font-size: small" class="igiftMsg_btn" data-action="lightMedalNow">\u7ACB\u523B\u70B9\u4EAE\u52CB\u7AE0</button>\n        </div>\n        <div data-toggle="FORCE_LIGHT" style="line-height: 15px">\n        <label style="margin: 5px auto; color: black">\n            <input style="vertical-align: text-top;" type="checkbox"> \u70B9\u4EAE\u52CB\u7AE0\u65F6\u5FFD\u7565\u4EB2\u5BC6\u5EA6\u4E0A\u9650\n        </label>\n        </div>\n        </fieldset>\n        <fieldset class="igiftMsg_fs">\n            <legend style="color: black">\u5185\u5BB9\u5C4F\u853D</legend>\n            <div data-toggle="REMOVE_ELEMENT_2233" style="line-height: 15px">\n                <label style="margin: 5px auto; color: black">\n                    <input style="vertical-align: text-top;" type="checkbox">\n                    \u79FB\u96642233\u6A21\u578B\n                </label>\n            </div>\n            <div data-toggle="REMOVE_ELEMENT_activity" style="line-height: 15px">\n                <label style="margin: 5px auto; color: black">\n                    <input style="vertical-align: text-top;" type="checkbox">\n                    \u79FB\u9664\u6D3B\u52A8\u5165\u53E3\n                </label>\n            </div>\n            <div data-toggle="NOSLEEP" style="line-height: 20px">\n            <label style="margin: 5px auto; color: black">\n                <input style="vertical-align: text-top;" type="checkbox">\n                \u5C4F\u853D\u6302\u673A\u68C0\u6D4B\n            </label>\n        </div>\n        </fieldset>\n        <fieldset class="igiftMsg_fs" style="line-height: 15px">\n            <legend style="color: black">\u5176\u4ED6\u8BBE\u7F6E</legend>\n            <div data-toggle="TIME_RELOAD" style="color: black">\n                \u672C\u76F4\u64AD\u95F4\u5237\u65B0\u65F6\u95F4\uFF1A\n                <input class="delay-seconds igiftMsg_input" type="text" style="width: 30px;">\u5206\n            </div>\n            <div data-toggle="IN_TIME_RELOAD_DISABLE" style="line-height: 20px">\n                <label style="margin: 5px auto; color: darkgreen">\n                    <input style="vertical-align: text-top;" type="checkbox">\n                    \u4E0D\u62BD\u5956\u65F6\u6BB5\u4E0D\u5237\u65B0\u76F4\u64AD\u95F4\n                </label>\n            </div>\n\n            <div id="resetArea">\n                <button data-action="reset" style="color: red;" class="igiftMsg_btn">\u91CD\u7F6E\u6240\u6709\u4E3A\u9ED8\u8BA4</button>\n                <button data-action="redo_dailyTasks" style="color: red;" class="igiftMsg_btn">\u518D\u6B21\u6267\u884C\u6240\u6709\u4EFB\u52A1</button>\n                <button style="font-size: small" class="igiftMsg_btn" data-action="countReset">\u91CD\u7F6E\u7EDF\u8BA1</button>\n            </div>\n\n        </fieldset>\n        <label style="color: darkblue; font-size:large;">\n             <a href="https://github.com/andywang425/BLTH"\n                target="_blank">v'+GM_info.script.version+'&nbsp;\u66F4\u591A\u4FE1\u606F\u89C1github\u4E0A\u7684\u9879\u76EE\u8BF4\u660E(\u70B9\u6211)</a>\n        </label>\n    </div>\n</div>\n    ',Re=function getScrollPosition(){var De=0<arguments.length&&arguments[0]!==void 0?arguments[0]:window;return{x:De.pageXOffset===void 0?De.scrollLeft:De.pageXOffset,y:De.pageYOffset===void 0?De.scrollTop:De.pageYOffset}},Ae=function openMainWindow(){he=layer.open({type:1,title:!1,offset:[ye.top-Re().y+''+'px',ye.left+''+'px'],closeBtn:0,shade:0,zIndex:9999,fixed:!1,area:[,Ce+''+'px'],content:Ne,success:function success(){function De(){var He,Be,Pe=parseInt($(ve).find('div[data-toggle="TIME_AREA_DISABLE"] .startHour').val()),je=parseInt($(ve).find('div[data-toggle="TIME_AREA_DISABLE"] .endHour').val()),Ye=parseInt($(ve).find('div[data-toggle="TIME_AREA_DISABLE"] .startMinute').val()),Xe=parseInt($(ve).find('div[data-toggle="TIME_AREA_DISABLE"] .endMinute').val());if(24<=Pe||24<=je||60<=Ye||60<=Xe||0>Pe||0>je||0>Ye||0>Xe)return void ue.chatLog('[\u5B9A\u65F6\u4F11\u7720]\u65F6\u95F4\u9519\u8BEF','warning');if(ue.CONFIG.TIME_AREA_START_H0UR=Pe,ue.CONFIG.TIME_AREA_END_H0UR=je,ue.CONFIG.TIME_AREA_START_MINUTE=Ye,ue.CONFIG.TIME_AREA_END_MINUTE=Xe,He=parseFloat($(ve).find('div[data-toggle="RANDOM_SKIP"] .per').val()),0>He||100<He)return void ue.chatLog('[\u968F\u673A\u8DF3\u8FC7\u793C\u7269]\u6570\u636E\u5C0F\u4E8E0\u6216\u5927\u4E8E100','warning');if(ue.CONFIG.RANDOM_SKIP=He,He=parseFloat($(ve).find('div[data-toggle="RANDOM_SEND_DANMU"] .per').val()),5<He)return void ue.chatLog('[\u6D3B\u8DC3\u5F39\u5E55]\u4E3A\u7EF4\u62A4\u76F4\u64AD\u95F4\u5F39\u5E55\u6C1B\u56F4,\u5F39\u5E55\u53D1\u9001\u6982\u7387\u4E0D\u5F97\u5927\u4E8E5%','warning');if(0>He)return void ue.chatLog('[\u6D3B\u8DC3\u5F39\u5E55]\u6570\u636E\u5C0F\u4E8E0','warning');if(ue.CONFIG.RANDOM_SEND_DANMU=He,He=parseInt($(ve).find('div[data-toggle="MAX_GIFT"] .num').val()),ue.CONFIG.MAX_GIFT=He,He=parseInt($(ve).find('div[data-toggle="TIME_RELOAD"] .delay-seconds').val()),0>=He||1e4<He)return void ue.chatLog('[\u76F4\u64AD\u95F4\u91CD\u8F7D\u65F6\u95F4]\u6570\u636E\u5C0F\u4E8E\u7B49\u4E8E0\u6216\u5927\u4E8E10000','warning');if(ue.CONFIG.TIME_RELOAD=He,He=parseFloat($(ve).find('div[data-toggle="RANDOM_DELAY"] .RND_DELAY_START').val()),je=parseFloat($(ve).find('div[data-toggle="RANDOM_DELAY"] .RND_DELAY_END').val()),0>He||100<je)return void ue.chatLog('[\u62BD\u5956\u5EF6\u65F6]\u6570\u636E\u5C0F\u4E8E0\u6216\u5927\u4E8E100','warning');if(je<=He)return void ue.chatLog('[\u62BD\u5956\u5EF6\u65F6]\u6570\u636E\u5927\u5C0F\u5173\u7CFB\u4E0D\u6B63\u786E','warning');if(ue.CONFIG.RND_DELAY_START=He,ue.CONFIG.RND_DELAY_END=je,He=parseInt($(ve).find('div[data-toggle="COIN"] .coin_number').val()),0>He||5<He)return void ue.chatLog('[\u81EA\u52A8\u6295\u5E01]\u6570\u636E\u5C0F\u4E8E0\u6216\u5927\u4E8E5','warning');if(ue.CONFIG.COIN_NUMBER=He,He=parseInt($(ve).find('div[data-toggle="CHECK_HOUR_ROOM_INTERVAL"] .num').val()),0>=He)return void ue.chatLog('[\u68C0\u67E5\u5C0F\u65F6\u699C\u95F4\u9694]\u6570\u636E\u5C0F\u4E8E\u7B49\u4E8E0','warning');ue.CONFIG.CHECK_HOUR_ROOM_INTERVAL=He,He=$(ve).find('div[data-toggle="AUTO_GIFT_ROOMID"] .num').val(),Be=He.split(',');for(var Ve=0;Ve<Be.length;Ve++)''===Be[Ve]&&(Be[Ve]=0);He=Be.join(','),ue.CONFIG.AUTO_GIFT_ROOMID=He,He=$(ve).find('div[data-toggle="EXCLUDE_ROOMID"] .num').val(),Be=He.split(',');for(var Ve=0;Ve<Be.length;Ve++)''===Be[Ve]&&(Be[Ve]=0);return(He=Be.join(','),ue.CONFIG.EXCLUDE_ROOMID=He,He=parseInt($(ve).find('div[data-toggle="GIFT_LIMIT"] .num').val()),ue.CONFIG.GIFT_LIMIT=He,Pe=parseInt($(ve).find('div[data-toggle="GIFT_SEND_TIME"] .Hour').val()),je=parseInt($(ve).find('div[data-toggle="GIFT_SEND_TIME"] .Minute').val()),0>Pe||0>je)?void ue.chatLog('[\u9001\u793C\u65F6\u95F4]\u6570\u636E\u5C0F\u4E8E0','warning'):24<=Pe||60<=je?void ue.chatLog('[\u9001\u793C\u65F6\u95F4]\u65F6\u95F4\u9519\u8BEF','warning'):void(ue.CONFIG.GIFT_SEND_HOUR=Pe,ue.CONFIG.GIFT_SEND_MINUTE=je,He=$(ve).find('div[data-toggle="SPARE_GIFT_ROOM"] .num').val(),ue.CONFIG.SPARE_GIFT_ROOM=He,He=parseInt($(ve).find('div[data-toggle="STORM_QUEUE_SIZE"] .num').val()),ue.CONFIG.STORM_QUEUE_SIZE=He,He=parseInt($(ve).find('div[data-toggle="STORM_MAX_COUNT"] .num').val()),ue.CONFIG.STORM_MAX_COUNT=He,He=parseInt($(ve).find('div[data-toggle="STORM_ONE_LIMIT"] .num').val()),ue.CONFIG.STORM_ONE_LIMIT=He,He=parseInt($(ve).find('div[data-toggle="COIN_UID"] .num').val()),ue.CONFIG.COIN_UID=He,He=$(ve).find('div[data-toggle="LIGHT_MEDALS"] .num').val(),ue.CONFIG.LIGHT_MEDALS=He,He=parseInt($(ve).find('div[data-toggle="MAX_TAB"] .num').val()),ue.CONFIG.MAX_TAB=He,ue.saveConfig())}function Me(He){return D.live_user.get_anchor_in_room(He).then(function(Be){Q('API.live_user.get_anchor_in_room response',Be),0!==Be.code||!Be.data.info?0===Be.code&&Be.data.info===void 0?layer.msg('\u623F\u95F4\u4E0D\u5B58\u5728',{time:2500}):layer.msg('\u68C0\u67E5\u623F\u95F4\u51FA\u9519 '+Be.message,{time:2500}):layer.confirm('\u662F\u5426\u6D88\u801720\u786C\u5E01\u8D2D\u4E70UP\u4E3B\u3010'+Be.data.info.uname+'\u3011\u7684\u7C89\u4E1D\u52CB\u7AE0\uFF1F',{title:'\u8D2D\u4E70\u52CB\u7AE0',btn:['\u662F','\u5426']},function(){return D.link_group.buy_medal(Be.data.info.uid).then(function(Pe){Q('API.link_group.buy_medal re',Pe),0===Pe.code?layer.msg('\u8D2D\u4E70\u6210\u529F',{time:2e3,icon:1}):layer.msg('\u8D2D\u4E70\u5931\u8D25 '+Pe.message,{time:2500,icon:2})})},function(){layer.msg('\u5DF2\u53D6\u6D88\u8D2D\u4E70',{time:2e3})})})}$(ve).find('div[data-toggle="MAX_TAB"] .num').val(parseInt(ue.CONFIG.MAX_TAB).toString()),$(ve).find('div[data-toggle="GIFT_INTERVAL"] .num').val(parseInt(ue.CONFIG.GIFT_INTERVAL).toString()),$(ve).find('div[data-toggle="LIGHT_MEDALS"] .num').val(ue.CONFIG.LIGHT_MEDALS.toString()),$(ve).find('div[data-toggle="STORM_MAX_COUNT"] .num').val(parseInt(ue.CONFIG.STORM_MAX_COUNT).toString()),$(ve).find('div[data-toggle="STORM_ONE_LIMIT"] .num').val(parseInt(ue.CONFIG.STORM_ONE_LIMIT).toString()),$(ve).find('div[data-toggle="STORM_QUEUE_SIZE"] .num').val(parseInt(ue.CONFIG.STORM_QUEUE_SIZE).toString()),$(ve).find('div[data-toggle="SPARE_GIFT_ROOM"] .num').val(ue.CONFIG.SPARE_GIFT_ROOM.toString()),$(ve).find('div[data-toggle="TIME_RELOAD"] .delay-seconds').val(parseInt(ue.CONFIG.TIME_RELOAD).toString()),$(ve).find('div[data-toggle="RANDOM_SKIP"] .per').val(parseFloat(ue.CONFIG.RANDOM_SKIP).toString()),$(ve).find('div[data-toggle="RANDOM_SEND_DANMU"] .per').val(parseFloat(ue.CONFIG.RANDOM_SEND_DANMU).toString()),$(ve).find('div[data-toggle="MAX_GIFT"] .num').val(parseInt(ue.CONFIG.MAX_GIFT).toString()),$(ve).find('div[data-toggle="COIN"] .coin_number').val(parseInt(ue.CONFIG.COIN_NUMBER).toString()),$(ve).find('div[data-toggle="COIN_UID"] .num').val(parseInt(ue.CONFIG.COIN_UID).toString()),$(ve).find('div[data-toggle="RANDOM_DELAY"] .RND_DELAY_START').val(parseFloat(ue.CONFIG.RND_DELAY_START).toString()),$(ve).find('div[data-toggle="RANDOM_DELAY"] .RND_DELAY_END').val(parseFloat(ue.CONFIG.RND_DELAY_END).toString()),$(ve).find('div[data-toggle="TIME_AREA_DISABLE"] .startHour').val(parseInt(ue.CONFIG.TIME_AREA_START_H0UR).toString()),$(ve).find('div[data-toggle="TIME_AREA_DISABLE"] .endHour').val(parseInt(ue.CONFIG.TIME_AREA_END_H0UR).toString()),$(ve).find('div[data-toggle="TIME_AREA_DISABLE"] .startMinute').val(parseInt(ue.CONFIG.TIME_AREA_START_MINUTE).toString()),$(ve).find('div[data-toggle="TIME_AREA_DISABLE"] .endMinute').val(parseInt(ue.CONFIG.TIME_AREA_END_MINUTE).toString()),$(ve).find('div[data-toggle="CHECK_HOUR_ROOM"] .num').val(parseInt(ue.CONFIG.CHECK_HOUR_ROOM_INTERVAL).toString()),$(ve).find('div[data-toggle="AUTO_GIFT_ROOMID"] .num').val(ue.CONFIG.AUTO_GIFT_ROOMID.toString()),$(ve).find('div[data-toggle="EXCLUDE_ROOMID"] .num').val(ue.CONFIG.EXCLUDE_ROOMID.toString()),$(ve).find('div[data-toggle="GIFT_SEND_TIME"] .Hour').val(ue.CONFIG.GIFT_SEND_HOUR.toString()),$(ve).find('div[data-toggle="GIFT_SEND_TIME"] .Minute').val(ue.CONFIG.GIFT_SEND_MINUTE.toString()),$(ve).find('div[data-toggle="GIFT_LIMIT"] .num').val(parseInt(ue.CONFIG.GIFT_LIMIT).toString());$(ve).find('div[id="giftCount"] [data-action="save"]').click(function(){De()}),$(ve).find('div[data-toggle="BUY_MEDAL"] [data-action="buy_medal"]').click(function(){var He=parseInt($(ve).find('div[data-toggle="BUY_MEDAL"] .num').val());Me(He)}),$(ve).find('button[data-action="reset"]').click(function(){ue.setDefaults()}),$(ve).find('button[data-action="checkUpdate"]').click(function(){ue.checkUpdate()}),$(ve).find('button[data-action="redo_dailyTasks"]').click(function(){ue.ReDoDailyTasks()}),$(ve).find('#resetArea [data-action="countReset"]').click(function(){ue.GIFT_COUNT={COUNT:0,SILVER_COUNT:0,CLEAR_TS:0},ue.saveGiftCount(),$('#giftCount span:eq(0)').text(ue.GIFT_COUNT.COUNT),$('#giftCount span:eq(1)').text(ue.GIFT_COUNT.SILVER_COUNT),ue.chatLog('\u5DF2\u91CD\u7F6E\u7EDF\u8BA1\u6570\u636E')}),$(ve).find('button[data-action="sendGiftNow"]').click(function(){F=!0,ue.Gift.run()}),$(ve).find('button[data-action="lightMedalNow"]').click(function(){w=!0,ue.Gift.run()});var be=['RANDOM_DELAY','TIME_AREA_DISABLE','AUTO_GROUP_SIGN','FORCE_LOTTERY','LOGIN','WATCH','COIN','SHARE','SILVER2COIN','LIVE_SIGN','IN_TIME_RELOAD_DISABLE','AUTO_TREASUREBOX','IN_TIME_RELOAD_DISABLE','AUTO_GIFT','SEND_ALL_GIFT','STORM','LITTLE_HEART','REMOVE_ELEMENT_2233','REMOVE_ELEMENT_activity','FORCE_LIGHT','LOTTERY','CHECK_HOUR_ROOM','NOSLEEP'],Se=!0,Le=!1,Fe=void 0;try{for(var Ue,we=function _loop(){var He=Ue.value,Be=$(ve).find('div[data-toggle="'+He+'"] input:checkbox');ue.CONFIG[He]&&Be.attr('checked',''),Be.change(function(){ue.CONFIG[He]=$(this).prop('checked'),ue.saveConfig()})},ke=be[Symbol.iterator]();!(Se=(Ue=ke.next()).done);Se=!0)we()}catch(He){Le=!0,Fe=He}finally{try{!Se&&ke.return&&ke.return()}finally{if(Le)throw Fe}}$('input:text').bind('keydown',function(He){'13'==He.keyCode&&De()}),'COIN_DYN'==ue.CONFIG.COIN_TYPE?$('div[data-toggle=\'COIN_DYN\'] input:radio').attr('checked',''):$('div[data-toggle=\'COIN_UID\'] input:radio').attr('checked','');'LIGHT_WHITE'==ue.CONFIG.LIGHT_METHOD?$('div[data-toggle=\'LIGHT_WHITE\'] input:radio').attr('checked',''):$('div[data-toggle=\'LIGHT_BLACK\'] input:radio').attr('checked','');'GIFT_INTERVAL'==ue.CONFIG.GIFT_METHOD?$('div[data-toggle=\'GIFT_INTERVAL\'] input:radio').attr('checked',''):$('div[data-toggle=\'GIFT_SEND_TIME\'] input:radio').attr('checked','');'high'==ue.CONFIG.GIFT_SORT?$('div[data-toggle=\'GIFT_SORT_HIGH\'] input:radio').attr('checked',''):$('div[data-toggle=\'GIFT_SORT_LOW\'] input:radio').attr('checked',''),$('input:radio[name=\'COIN_TYPE\']').change(function(){var He=$('div[data-toggle=\'COIN_DYN\'] input:radio').is(':checked');ue.CONFIG.COIN_TYPE=!0==He?'COIN_DYN':'COIN_UID',ue.saveConfig()}),$('input:radio[name=\'LIGHT_TYPE\']').change(function(){var He=$('div[data-toggle=\'LIGHT_WHITE\'] input:radio').is(':checked');ue.CONFIG.LIGHT_METHOD=!0==He?'LIGHT_WHITE':'LIGHT_BLACK',ue.saveConfig()}),$('input:radio[name=\'GIFT_TYPE\']').change(function(){var He=$('div[data-toggle=\'GIFT_INTERVAL\'] input:radio').is(':checked');ue.CONFIG.GIFT_METHOD=!0==He?'GIFT_INTERVAL':'GIFT_SEND_TIME',ue.saveConfig()}),$('input:radio[name=\'GIFT_SORT\']').change(function(){var He=$('div[data-toggle=\'GIFT_SORT_HIGH\'] input:radio').is(':checked');ue.CONFIG.GIFT_SORT=!0==He?'high':'low',ue.saveConfig()})},end:function end(){A='hide',localStorage.setItem(N+'_msgHide',A),$('.igiftMsg').hide(),$('.link-toast').hide(),xe.animate({scrollTop:0},0),setTimeout(function(){xe.animate({scrollTop:xe.prop('scrollHeight')},10)},100),document.getElementById('hiderbtn').innerHTML='\u663E\u793A\u7A97\u53E3\u548C\u63D0\u793A\u4FE1\u606F'}})};Oe.click(function(){k&&(k=!1,setTimeout(function(){k=!0},200),'show'==A?(A='hide',localStorage.setItem(N+'_msgHide',A),$('.igiftMsg').hide(),$('.link-toast').hide(),layer.close(he),xe.animate({scrollTop:0},0),setTimeout(function(){xe.animate({scrollTop:xe.prop('scrollHeight')},10)},100),document.getElementById('hiderbtn').innerHTML='\u663E\u793A\u7A97\u53E3\u548C\u63D0\u793A\u4FE1\u606F'):(A='show',localStorage.setItem(N+'_msgHide',A),$('.igiftMsg').show(),$('.link-toast').show(),Ae(),xe.animate({scrollTop:xe.prop('scrollHeight')},0),document.getElementById('hiderbtn').innerHTML='\u9690\u85CF\u7A97\u53E3\u548C\u63D0\u793A\u4FE1\u606F'))}),$('.attention-btn-ctnr').append(Oe),ue.CACHE.DailyReward_TS||layer.tips('\u70B9\u6211\u9690\u85CF/\u663E\u793A\u63A7\u5236\u9762\u677F','#hiderbtn',{tips:1}),'show'==A&&Ae()},chatLog:function chatLog(ce){var pe=1<arguments.length&&arguments[1]!==void 0?arguments[1]:'info',Ie=$('<div class=\'igiftMsg\'>'),Te=$('<div>'),fe=$('#chat-history-list'),me=new Date;Te.text(ce),Ie.text(me.toLocaleString()),Ie.append(Te),Ie.css({"text-align":'center',"border-radius":'4px',"min-height":'30px',width:'256px',color:'#9585FF',"line-height":'30px',padding:'0 10px',margin:'10px auto'}),Te.css({"word-wrap":'break-word',width:'100%',"line-height":'1em',"margin-bottom":'10px'});'warning'===pe?Ie.css({border:'1px solid rgb(236, 221, 192)',color:'rgb(218, 142, 36)',background:'rgb(245, 235, 221) none repeat scroll 0% 0%'}):'success'===pe?Ie.css({border:'1px solid rgba(22, 140, 0, 0.28)',color:'rgb(69, 171, 69)',background:'none 0% 0% repeat scroll rgba(16, 255, 0, 0.18)'}):'error'===pe?Ie.css({border:'1px solid rgb(255, 46, 0)',color:'white',background:'none 0% 0% repeat scroll #ff4c4c'}):Ie.css({border:'1px solid rgb(203, 195, 255)',background:'rgb(233, 230, 255) none repeat scroll 0% 0%'});'show'==A?fe.find('#chat-items').append(Ie):fe.find('#chat-items').append(Ie.hide()),fe.scrollTop(fe.prop('scrollHeight'))},blocked:!1,max_blocked:!1,listen:function listen(ce,pe){var Ie=2<arguments.length&&arguments[2]!==void 0?arguments[2]:'\u672C\u76F4\u64AD\u95F4';D.room.getConf(ce).then(function(Te){Q('\u83B7\u53D6\u5F39\u5E55\u670D\u52A1\u5668\u4FE1\u606F '+Ie,Te);var fe=new D.DanmuWebSocket(pe,ce,Te.data.host_server_list,Te.data.token);fe.bind(function(me){fe=me,ue.chatLog(Ie+'\u5F39\u5E55\u670D\u52A1\u5668\u8FDE\u63A5\u65AD\u5F00\uFF0C\u5C1D\u8BD5\u91CD\u8FDE','warning')},function(){ue.chatLog('\u2014\u2014\u2014\u2014\u2014\u2014\u8FDE\u63A5\u5F39\u5E55\u670D\u52A1\u5668\u6210\u529F\u2014\u2014\u2014\u2014\u2014\u2014\n\u623F\u95F4\u53F7: '+ce+' \u5206\u533A: '+Ie,'success')},function(){(ue.blocked||ue.stormBlack)&&(fe.close(),ue.chatLog('\u8FDB\u4E86\u5C0F\u9ED1\u5C4B\u4E3B\u52A8\u4E0E\u5F39\u5E55\u670D\u52A1\u5668\u65AD\u5F00\u8FDE\u63A5-'+Ie,'warning')),ue.max_blocked&&!ue.CONFIG.STORM&&(fe.close(),ue.chatLog('\u8FA3\u6761\u6700\u5927\u503C\u4E3B\u52A8\u4E0E\u5F39\u5E55\u670D\u52A1\u5668\u65AD\u5F00\u8FDE\u63A5-'+Ie,'warning'))},function(me){if(!(f(ue.CONFIG.TIME_AREA_START_H0UR,ue.CONFIG.TIME_AREA_END_H0UR,ue.CONFIG.TIME_AREA_START_MINUTE,ue.CONFIG.TIME_AREA_END_MINUTE)&&ue.CONFIG.TIME_AREA_DISABLE))switch(Q('\u5F39\u5E55\u516C\u544A'+Ie,me),me.cmd){case'GUARD_MSG':me.roomid===me.real_roomid?ue.checkRoom(me.roomid,Ie):(ue.checkRoom(me.roomid,Ie),ue.checkRoom(me.real_roomid,Ie));break;case'PK_BATTLE_SETTLE_USER':me.data.winner?ue.checkRoom(me.data.winner.room_id,Ie):ue.checkRoom(me.data.my_info.room_id,Ie),ue.checkRoom(me.data.winner.room_id,Ie);break;case'NOTICE_MSG':switch(me.msg_type){case 1:break;case 2:case 3:case 4:case 8:me.roomid===me.real_roomid?ue.checkRoom(me.roomid,Ie):(ue.checkRoom(me.roomid,Ie),ue.checkRoom(me.real_roomid,Ie));break;case 5:break;case 6:window.toast('\u76D1\u63A7\u5230\u623F\u95F4 '+me.roomid+' \u7684\u8282\u594F\u98CE\u66B4','info'),ue.Storm.run(me.roomid);}break;case'SPECIAL_GIFT':if(me.data[39])switch(me.data[39].action){case'start':window.toast('\u76D1\u63A7\u5230\u623F\u95F4 '+me.roomid+' \u7684\u8282\u594F\u98CE\u66B4','info'),ue.Storm.run(me.roomid);case'end':};break;default:}})},function(){ue.chatLog('\u83B7\u53D6\u5F39\u5E55\u670D\u52A1\u5668\u5730\u5740\u9519\u8BEF','error')})},EntryRoom_list_history:{add:function add(ce){var pe=[];try{var Ie=JSON.parse(localStorage.getItem(N+'_EntryRoom_list'));pe=[].concat(Ie.list),pe.push(ce),100<pe.length&&pe.splice(0,50),localStorage.setItem(N+'_EntryRoom_list',JSON.stringify({list:pe})),Q(N+'_EntryRoom_list_add',pe)}catch(Ie){pe.push(ce),localStorage.setItem(N+'_EntryRoom_list',JSON.stringify({list:pe}))}},isIn:function isIn(ce){var pe=[];try{var Ie=JSON.parse(localStorage.getItem(N+'_EntryRoom_list'));return pe=null===Ie?[]:[].concat(Ie.list),Q(N+'_EntryRoom_list_read',Ie),-1<pe.indexOf(ce)}catch(Ie){return localStorage.setItem(N+'_EntryRoom_list',JSON.stringify({list:pe})),Q('\u8BFB\u53D6'+(N+'_EntryRoom_list\u7F13\u5B58\u9519\u8BEF\u5DF2\u91CD\u7F6E')),-1<pe.indexOf(ce)}}},RoomId_list:[],err_roomId:[],auto_danmu_list:['(=\u30FB\u03C9\u30FB=)','\uFF08\uFFE3\u25BD\uFFE3\uFF09','nice','666','kksk','(\u2312\u25BD\u2312)','(\uFF40\u30FB\u03C9\u30FB\xB4)','\u256E(\uFFE3\u25BD\uFFE3)\u256D','(\uFFE33\uFFE3)','\u03A3( \uFFE3\u25A1\uFFE3||)','(^\u30FB\u03C9\u30FB^ )','_(:3\u300D\u2220)_'],checkRoom:function checkRoom(ce){var pe=1<arguments.length&&arguments[1]!==void 0?arguments[1]:'\u672C\u76F4\u64AD\u95F4';ue.blocked||ue.max_blocked||0<=ue.RoomId_list.indexOf(ce)||(ue.RoomId_list.push(ce),ue.EntryRoom_list_history.isIn(ce)||(D.room.room_entry_action(ce),ue.EntryRoom_list_history.add(ce)),O(ue.CONFIG.RANDOM_SEND_DANMU)&&D.sendLiveDanmu(ue.auto_danmu_list[_Mathfloor(12*Math.random())],ce).then(function(Ie){Q('\u5F39\u5E55\u53D1\u9001\u8FD4\u56DE\u4FE1\u606F',Ie)}),D.xlive.lottery.check(ce).then(function(Ie){ue.RoomId_list.remove(ce),Q('\u68C0\u67E5\u623F\u95F4\u8FD4\u56DE\u4FE1\u606F',Ie);var Te=Ie.data;if(0===Ie.code){var fe;if(Te.gift)for(var me in fe=Te.gift,fe)fe.hasOwnProperty(me)&&ue.creat_join(ce,fe[me],'gift',pe);if(Te.guard)for(var me in fe=Te.guard,fe)fe.hasOwnProperty(me)&&ue.creat_join(ce,fe[me],'guard',pe);if(Te.pk)for(var me in fe=Te.pk,fe)fe.hasOwnProperty(me)&&ue.creat_join(ce,fe[me],'pk',pe)}else ue.chatLog('[\u68C0\u67E5\u623F\u95F4\u51FA\u9519]'+response.msg,'error'),-1<ue.err_roomId.indexOf(ce)?Q('[\u68C0\u67E5\u6B64\u623F\u95F4\u51FA\u9519\u591A\u6B21]'+ce+Ie.message):(ue.err_roomId.push(ce),ue.checkRoom(ce,pe),Q('[\u68C0\u67E5\u623F\u95F4\u51FA\u9519_\u91CD\u8BD5\u4E00\u6B21]'+ce+Ie.message))}))},Id_list_history:{add:function add(ce,pe){var Ie=[];try{var Te=JSON.parse(localStorage.getItem(N+'_'+pe+'Id_list'));Ie=[].concat(Te.list),Ie.push(ce),200<Ie.length&&Ie.splice(0,50),localStorage.setItem(N+'_'+pe+'Id_list',JSON.stringify({list:Ie})),Q(N+'_'+pe+'Id_list_add',Ie)}catch(Te){Ie.push(ce),localStorage.setItem(N+'_'+pe+'Id_list',JSON.stringify({list:Ie}))}},isIn:function isIn(ce,pe){var Ie=[];try{var Te=JSON.parse(localStorage.getItem(N+'_'+pe+'Id_list'));return Ie=null===Te?[]:[].concat(Te.list),Q(N+'_'+pe+'Id_list_read',Te),-1<Ie.indexOf(ce)}catch(Te){return localStorage.setItem(N+'_'+pe+'Id_list',JSON.stringify({list:Ie})),Q('\u8BFB\u53D6'+(N+'_'+pe+'Id_list\u7F13\u5B58\u9519\u8BEF\u5DF2\u91CD\u7F6E')),-1<Ie.indexOf(ce)}}},raffleId_list:[],guardId_list:[],pkId_list:[],creat_join:function creat_join(ce,pe,Ie){var Te=3<arguments.length&&void 0!==arguments[3]?arguments[3]:'\u672C\u76F4\u64AD\u95F4';if(Q('\u793C\u7269\u4FE1\u606F',pe),ue.GIFT_COUNT.COUNT>=ue.CONFIG.MAX_GIFT)return Q('\u8D85\u8FC7\u4ECA\u65E5\u8FA3\u6761\u9650\u5236\uFF0C\u4E0D\u53C2\u4E0E\u62BD\u5956'),void(ue.max_blocked=!0);switch(Ie){case'gift':if(ue.Id_list_history.isIn(pe.raffleId,'raffle'))return void Q('\u793C\u7269\u91CD\u590D','raffleId '+pe.raffleId);ue.raffleId_list.push(pe.raffleId),ue.Id_list_history.add(pe.raffleId,'raffle');break;case'guard':if(ue.Id_list_history.isIn(pe.id,'guard'))return void Q('\u8230\u957F\u91CD\u590D','id '+pe.id);ue.guardId_list.push(pe.id),ue.Id_list_history.add(pe.id,'guard');break;case'pk':if(ue.Id_list_history.isIn(pe.id,'pk'))return void Q('pk\u91CD\u590D','id '+pe.id);ue.pkId_list.push(pe.id),ue.Id_list_history.add(pe.id,'pk');}var fe=pe.time_wait||0;ue.CONFIG.RANDOM_DELAY&&(fe+=_Mathfloor(Math.random()*(ue.CONFIG.RND_DELAY_END-ue.CONFIG.RND_DELAY_START+1))+ue.CONFIG.RND_DELAY_START);var me=$('<div class=\'igiftMsg\'>'),Ee=$('<div>'),Oe=$('<div>'),ve=$('#chat-history-list'),xe=new Date;Ee.text('['+Te+']'+pe.thank_text.split('<%')[1].split('%>')[0]+pe.thank_text.split('%>')[1]),me.text(xe.toLocaleString()),me.append(Ee),Oe.css('color','red'),Oe.text('\u7B49\u5F85\u62BD\u5956'),Ee.append(Oe),me.css({"text-align":'center',"border-radius":'4px',"min-height":'30px',width:'256px',color:'#9585FF',"line-height":'30px',padding:'0 10px',margin:'10px auto'}),Ee.css({"word-wrap":'break-word',width:'100%',"line-height":'1em',"margin-bottom":'10px'}),me.css({border:'1px solid rgb(203, 195, 255)',background:'rgb(233, 230, 255) none repeat scroll 0% 0%'}),'show'==A?ve.find('#chat-items').append(me):ve.find('#chat-items').append(me.hide()),ve.scrollTop(ve.prop('scrollHeight'));var he=setInterval(function(){Oe.text('\u7B49\u5F85\u62BD\u5956\u5012\u8BA1\u65F6'+fe+'\u79D2'),0>=fe&&(O(ue.CONFIG.RANDOM_SKIP)?Oe.text('\u8DF3\u8FC7\u6B64\u793C\u7269\u62BD\u5956'):(Oe.text('\u8FDB\u884C\u62BD\u5956...'),'gift'===Ie?ue.gift_join(ce,pe.raffleId,pe.type).then(function(Ce,ye){Oe.text(Ce),ye&&(-1<Ce.indexOf('\u8FA3\u6761')?ue.addGift(ye):-1<Ce.indexOf('\u94F6\u74DC\u5B50')&&ue.addSilver(ye)),ue.raffleId_list.remove(pe.raffleId)}):'guard'===Ie?ue.guard_join(ce,pe.id).then(function(Ce,ye){Oe.text(Ce),ye&&(-1<Ce.indexOf('\u8FA3\u6761')?ue.addGift(ye):-1<Ce.indexOf('\u94F6\u74DC\u5B50')&&ue.addSilver(ye)),ue.guardId_list.remove(pe.id)}):'pk'===Ie?ue.pk_join(ce,pe.id).then(function(Ce,ye){Oe.text(Ce),ye&&(-1<Ce.indexOf('\u8FA3\u6761')?ue.addGift(ye):-1<Ce.indexOf('\u94F6\u74DC\u5B50')&&ue.addSilver(ye)),ue.pkId_list.remove(pe.id)}):void 0),Oe.css('color','green'),clearInterval(he)),fe--},1e3)},gift_join:function gift_join(ce,pe,Ie){var Te=$.Deferred();return D.Lottery.Gift.join(ce,pe,Ie).then(function(fe){switch(Q('\u62BD\u5956\u8FD4\u56DE\u4FE1\u606F',fe),fe.code){case 0:fe.data.award_text?Te.resolve(fe.data.award_text,fe.data.award_num):Te.resolve(fe.data.award_name+'X'+fe.data.award_num.toString(),fe.data.award_num);break;default:-1<fe.msg.indexOf('\u62D2\u7EDD')?!1==ue.CONFIG.FORCE_LOTTERY?(ue.blocked=!0,Te.resolve('\u8BBF\u95EE\u88AB\u62D2\u7EDD\uFF0C\u60A8\u7684\u5E10\u53F7\u53EF\u80FD\u5DF2\u7ECF\u88AB\u5173\u5C0F\u9ED1\u5C4B\uFF0C\u5DF2\u505C\u6B62')):5>=++M?ue.gift_join(ce,pe,Ie):(M=0,Te.resolve('[\u793C\u7269\u62BD\u5956](roomid='+ce+',id='+pe+',type='+Ie+')'+fe.msg)):Te.resolve('[\u793C\u7269\u62BD\u5956](roomid='+ce+',id='+pe+',type='+Ie+')'+fe.msg);}}),Te},guard_join:function guard_join(ce,pe){var Ie=$.Deferred();return D.Lottery.Guard.join(ce,pe).then(function(Te){switch(Q('\u4E0A\u8239\u62BD\u5956\u8FD4\u56DE\u4FE1\u606F',Te),Te.code){case 0:Te.data.award_text?Ie.resolve(Te.data.award_text,Te.data.award_num):Ie.resolve(Te.data.award_name+'X'+Te.data.award_num.toString(),Te.data.award_num);break;default:-1<Te.msg.indexOf('\u62D2\u7EDD')?!1==ue.CONFIG.FORCE_LOTTERY?(ue.blocked=!0,Ie.resolve('\u8BBF\u95EE\u88AB\u62D2\u7EDD\uFF0C\u60A8\u7684\u5E10\u53F7\u53EF\u80FD\u5DF2\u7ECF\u88AB\u5173\u5C0F\u9ED1\u5C4B\uFF0C\u5DF2\u505C\u6B62')):5>=++S?ue.guard_join(ce,id):(S=0,Ie.resolve('[\u793C\u7269\u62BD\u5956](roomid='+ce+',id='+raffleId+',type='+type+')'+Te.msg)):Ie.resolve('[\u4E0A\u8239](roomid='+ce+',id='+pe+')'+Te.msg);}}),Ie},pk_join:function pk_join(ce,pe){var Ie=$.Deferred();return D.Lottery.Pk.join(ce,pe).then(function(Te){switch(Q('PK\u62BD\u5956\u8FD4\u56DE\u4FE1\u606F',Te),Te.code){case 0:Te.data.award_text?Ie.resolve(Te.data.award_text,Te.data.award_num):Ie.resolve(Te.data.award_name+'X'+Te.data.award_num.toString(),Te.data.award_num);break;default:-1<Te.msg.indexOf('\u62D2\u7EDD')?!1==ue.CONFIG.FORCE_LOTTERY?(ue.blocked=!0,Ie.resolve('\u8BBF\u95EE\u88AB\u62D2\u7EDD\uFF0C\u60A8\u7684\u5E10\u53F7\u53EF\u80FD\u5DF2\u7ECF\u88AB\u5173\u5C0F\u9ED1\u5C4B\uFF0C\u5DF2\u505C\u6B62')):5>=++L?ue.pk_join(ce,id):(L=0,Ie.resolve('[\u793C\u7269\u62BD\u5956](roomid='+ce+',id='+raffleId+',type='+type+')'+Te.msg)):Ie.resolve('[PK](roomid='+ce+',id='+pe+')'+Te.msg);}}),Ie},GroupSign:{getGroups:function getGroups(){return D.Group.my_groups().then(function(ce){return(Q('GroupSign.getGroups: API.Group.my_groups',ce),0===ce.code)?$.Deferred().resolve(ce.data.list):(window.toast('[\u81EA\u52A8\u5E94\u63F4\u56E2\u7B7E\u5230]\''+ce.msg,'caution'),$.Deferred().reject())},function(){return window.toast('[\u81EA\u52A8\u5E94\u63F4\u56E2\u7B7E\u5230]\u83B7\u53D6\u5E94\u63F4\u56E2\u5217\u8868\u5931\u8D25\uFF0C\u8BF7\u68C0\u67E5\u7F51\u7EDC','error'),K(function(){return ue.GroupSign.getGroups()})})},signInList:function signInList(ce){var pe=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0;if(pe>=ce.length)return $.Deferred().resolve();var Ie=ce[pe];return Ie.owner_uid==H.uid?GroupSign.signInList(ce,pe+1):D.Group.sign_in(Ie.group_id,Ie.owner_uid).then(function(Te){Q('GroupSign.signInList: API.Group.sign_in',Te);var fe=$.Deferred();if(0===Te.code)0<Te.data.add_num?(window.toast('[\u81EA\u52A8\u5E94\u63F4\u56E2\u7B7E\u5230]\u5E94\u63F4\u56E2(group_id='+Ie.group_id+',owner_uid='+Ie.owner_uid+')\u7B7E\u5230\u6210\u529F\uFF0C\u5F53\u524D\u52CB\u7AE0\u4EB2\u5BC6\u5EA6+'+Te.data.add_num,'success'),fe.resolve()):0==Te.data.add_num?(window.toast('[\u81EA\u52A8\u5E94\u63F4\u56E2\u7B7E\u5230]\u5E94\u63F4\u56E2(group_id='+Ie.group_id+',owner_uid='+Ie.owner_uid+')\u5DF2\u7B7E\u5230','caution'),fe.resolve()):fe.reject();else return window.toast('[\u81EA\u52A8\u5E94\u63F4\u56E2\u7B7E\u5230]\''+Te.msg,'caution'),$.Deferred().reject();return $.when(ue.GroupSign.signInList(ce,pe+1),fe)},function(){return window.toast('[\u81EA\u52A8\u5E94\u63F4\u56E2\u7B7E\u5230]\u5E94\u63F4\u56E2(group_id='+Ie.group_id+',owner_uid='+Ie.owner_uid+')\u7B7E\u5230\u5931\u8D25\uFF0C\u8BF7\u68C0\u67E5\u7F51\u7EDC','error'),K(function(){return ue.GroupSign.signInList(ce,pe)})})},run:function run(){try{return ue.CONFIG.AUTO_GROUP_SIGN?le(ue.CACHE.AUTO_GROUP_SIGH_TS)?8>new Date().getHours()&&0!=ue.CACHE.AUTO_GROUP_SIGH_TS?(setTimeout(ue.GroupSign.run,_(8,0)),$.Deferred().resolve()):ue.GroupSign.getGroups().then(function(ce){return ue.GroupSign.signInList(ce).then(function(){return ue.CACHE.AUTO_GROUP_SIGH_TS=Y(),ue.saveCache(),J(ue.GroupSign.run,8,0,'\u5E94\u63F4\u56E2\u7B7E\u5230'),$.Deferred().resolve()},function(){return K(function(){return ue.GroupSign.run()})})},function(){return K(function(){return ue.GroupSign.run()})}):(J(ue.GroupSign.run,8,0,'\u5E94\u63F4\u56E2\u7B7E\u5230'),$.Deferred().resolve()):$.Deferred().resolve()}catch(ce){return window.toast('[\u81EA\u52A8\u5E94\u63F4\u56E2\u7B7E\u5230]\u8FD0\u884C\u65F6\u51FA\u73B0\u5F02\u5E38\uFF0C\u5DF2\u505C\u6B62','error'),console.error('['+N+']',ce),$.Deferred().reject()}}},DailyReward:{coin_exp:0,login:function login(){return D.DailyReward.login().then(function(){Q('DailyReward.login: API.DailyReward.login'),window.toast('[\u81EA\u52A8\u6BCF\u65E5\u5956\u52B1][\u6BCF\u65E5\u767B\u5F55]\u5B8C\u6210','success')},function(){return window.toast('[\u81EA\u52A8\u6BCF\u65E5\u5956\u52B1][\u6BCF\u65E5\u767B\u5F55]\u5B8C\u6210\u5931\u8D25\uFF0C\u8BF7\u68C0\u67E5\u7F51\u7EDC','error'),K(function(){return ue.DailyReward.login()})})},watch:function watch(ce,pe){return ue.CONFIG.WATCH?D.DailyReward.watch(ce,pe,H.uid,X()).then(function(Ie){Q('DailyReward.watch: API.DailyReward.watch',Ie),0===Ie.code?window.toast('[\u81EA\u52A8\u6BCF\u65E5\u5956\u52B1][\u6BCF\u65E5\u89C2\u770B]\u5B8C\u6210(av='+ce+')','success'):window.toast('[\u81EA\u52A8\u6BCF\u65E5\u5956\u52B1][\u6BCF\u65E5\u89C2\u770B]\''+Ie.msg,'caution')},function(){return window.toast('[\u81EA\u52A8\u6BCF\u65E5\u5956\u52B1][\u6BCF\u65E5\u89C2\u770B]\u5B8C\u6210\u5931\u8D25\uFF0C\u8BF7\u68C0\u67E5\u7F51\u7EDC','error'),K(function(){return ue.DailyReward.watch(ce,pe)})}):$.Deferred().resolve()},coin:function coin(ce,pe){var Ie=2<arguments.length&&arguments[2]!==void 0?arguments[2]:0,Te=3<arguments.length&&arguments[3]!==void 0&&arguments[3];if(!ue.CONFIG.COIN)return $.Deferred().resolve();if(ue.DailyReward.coin_exp>=10*ue.CONFIG.COIN_NUMBER)return window.toast('[\u81EA\u52A8\u6BCF\u65E5\u5956\u52B1][\u6BCF\u65E5\u6295\u5E01]\u4ECA\u65E5\u6295\u5E01\u5DF2\u5B8C\u6210','info'),$.Deferred().resolve();if(Ie>=ce.length)return window.toast('[\u81EA\u52A8\u6BCF\u65E5\u5956\u52B1][\u6BCF\u65E5\u6295\u5E01]\u52A8\u6001\u91CC\u53EF\u6295\u5E01\u7684\u89C6\u9891\u4E0D\u8DB3','caution'),$.Deferred().resolve();var fe=JSON.parse(ce[Ie].card),me=_Mathmin(2,pe);Te&&(me=1),D.x.getCoinInfo('','jsonp',fe.aid,Y()).then(function(Ee){return 2===Ee.data.multiply?(Q('API.x.getCoinInfo','\u5DF2\u6295\u5E01\u4E24\u4E2A aid = '+fe.aid),ue.DailyReward.coin(vlist,pe,Ie+1)):D.DailyReward.coin(fe.aid,me).then(function(Oe){return(Q('DailyReward.coin: API.DailyReward.coin',Oe),0===Oe.code)?(ue.DailyReward.coin_exp+=10*me,window.toast('[\u81EA\u52A8\u6BCF\u65E5\u5956\u52B1][\u6BCF\u65E5\u6295\u5E01]\u6295\u5E01\u6210\u529F(av='+fe.aid+',num='+me+')','success'),ue.DailyReward.coin(ce,pe-me,Ie+1)):-110===Oe.code?(window.toast('[\u81EA\u52A8\u6BCF\u65E5\u5956\u52B1][\u6BCF\u65E5\u6295\u5E01]\u672A\u7ED1\u5B9A\u624B\u673A\uFF0C\u5DF2\u505C\u6B62','error'),$.Deferred().reject()):34003===Oe.code?Te?ue.DailyReward.coin(ce,pe,Ie+1):ue.DailyReward.coin(ce,pe,Ie,!0):34005===Oe.code?ue.DailyReward.coin(ce,pe,Ie+1):-104===Oe.code?(window.toast('[\u81EA\u52A8\u6BCF\u65E5\u5956\u52B1][\u6BCF\u65E5\u6295\u5E01]\u5269\u4F59\u786C\u5E01\u4E0D\u8DB3\uFF0C\u5DF2\u505C\u6B62','warning'),$.Deferred().reject()):(window.toast('[\u81EA\u52A8\u6BCF\u65E5\u5956\u52B1][\u6BCF\u65E5\u6295\u5E01]\''+Oe.msg,'caution'),ue.DailyReward.coin(ce,pe,Ie+1))},function(){return K(function(){return ue.DailyReward.coin(ce,pe,Ie)})})})},coin_uid:function coin_uid(ce,pe,Ie,Te){var fe=4<arguments.length&&arguments[4]!==void 0?arguments[4]:0,me=5<arguments.length&&arguments[5]!==void 0&&arguments[5];if(!ue.CONFIG.COIN)return $.Deferred().resolve();if(ue.DailyReward.coin_exp>=10*ue.CONFIG.COIN_NUMBER)return window.toast('[\u81EA\u52A8\u6BCF\u65E5\u5956\u52B1][\u6BCF\u65E5\u6295\u5E01]\u4ECA\u65E5\u6295\u5E01\u5DF2\u5B8C\u6210','info'),$.Deferred().resolve();fe>=ce.length&&ue.DailyReward.UserSpace(ue.CONFIG.COIN_UID,30,0,Ie++,'','pubdate','jsonp');var Ee=ce[fe];if(1===Ee.is_union_video||Ee.mid!=Te)return Q('DailyReward.coin_uid','\u8054\u5408\u6295\u7A3F\u4E14UP\u4E0D\u662F\u6307\u5B9AUID\u7528\u6237 aid = '+Ee.aid),ue.DailyReward.coin_uid(ce,pe,Ie,Te,fe+1);var Oe=_Mathmin(2,pe);me&&(Oe=1),D.x.getCoinInfo('','jsonp',Ee.aid,Y()).then(function(ve){return 2===ve.data.multiply?(Q('API.x.getCoinInfo','\u5DF2\u6295\u5E01\u4E24\u4E2A aid = '+Ee.aid),ue.DailyReward.coin_uid(ce,pe,Ie,Te,fe+1)):D.DailyReward.coin(Ee.aid,Oe).then(function(xe){return(Q('DailyReward.coin_uid: API.DailyReward.coin_uid',xe),0===xe.code)?(ue.DailyReward.coin_exp+=10*Oe,window.toast('[\u81EA\u52A8\u6BCF\u65E5\u5956\u52B1][\u6BCF\u65E5\u6295\u5E01]\u6295\u5E01\u6210\u529F(av='+Ee.aid+',num='+Oe+')','success'),ue.DailyReward.coin_uid(ce,pe-Oe,Ie,Te,fe+1)):-110===xe.code?(window.toast('[\u81EA\u52A8\u6BCF\u65E5\u5956\u52B1][\u6BCF\u65E5\u6295\u5E01]\u672A\u7ED1\u5B9A\u624B\u673A\uFF0C\u5DF2\u505C\u6B62','error'),$.Deferred().reject()):34003===xe.code?me?ue.DailyReward.coin_uid(ce,pe,Ie,Te,fe+1):ue.DailyReward.coin_uid(ce,pe,fe,Ie,Te,!0):34005===xe.code?ue.DailyReward.coin_uid(ce,pe,Ie,Te,fe+1):-104===xe.code?(window.toast('[\u81EA\u52A8\u6BCF\u65E5\u5956\u52B1][\u6BCF\u65E5\u6295\u5E01]\u5269\u4F59\u786C\u5E01\u4E0D\u8DB3\uFF0C\u5DF2\u505C\u6B62','warning'),$.Deferred().reject()):(window.toast('[\u81EA\u52A8\u6BCF\u65E5\u5956\u52B1][\u6BCF\u65E5\u6295\u5E01]\''+xe.msg,'caution'),ue.DailyReward.coin_uid(ce,pe,Ie,Te,fe+1))},function(){return K(function(){return ue.DailyReward.coin_uid(ce,pe,Ie,Te,fe)})})})},share:function share(ce){return ue.CONFIG.SHARE?D.DailyReward.share(ce).then(function(pe){Q('DailyReward.share: API.DailyReward.share',pe),0===pe.code?window.toast('[\u81EA\u52A8\u6BCF\u65E5\u5956\u52B1][\u6BCF\u65E5\u5206\u4EAB]\u5206\u4EAB\u6210\u529F(av='+ce+')','success'):71000===pe.code?window.toast('[\u81EA\u52A8\u6BCF\u65E5\u5956\u52B1][\u6BCF\u65E5\u5206\u4EAB]\u4ECA\u65E5\u5206\u4EAB\u5DF2\u5B8C\u6210','info'):window.toast('[\u81EA\u52A8\u6BCF\u65E5\u5956\u52B1][\u6BCF\u65E5\u5206\u4EAB]\''+pe.msg,'caution')},function(){return window.toast('[\u81EA\u52A8\u6BCF\u65E5\u5956\u52B1][\u6BCF\u65E5\u5206\u4EAB]\u5206\u4EAB\u5931\u8D25\uFF0C\u8BF7\u68C0\u67E5\u7F51\u7EDC','error'),K(function(){return ue.DailyReward.share(ce)})}):$.Deferred().resolve()},dynamic:function(){var ce=_asyncToGenerator(regeneratorRuntime.mark(function pe(){var Ie,Te;return regeneratorRuntime.wrap(function(me){for(;;)switch(me.prev=me.next){case 0:return Ie=void 0,Te=ue.CONFIG.COIN_NUMBER-ue.DailyReward.coin_exp/10,me.next=4,D.getuserinfo().then(function(Ee){return Q('DailyReward.dynamic: API.getuserinfo',Ee),Ee.data.biliCoin<Te?Ee.data.biliCoin:Te});case 4:return Ie=me.sent,Ie<Te&&window.toast('[\u81EA\u52A8\u6BCF\u65E5\u5956\u52B1][\u6BCF\u65E5\u6295\u5E01]\u5269\u4F59\u786C\u5E01\u4E0D\u8DB3\uFF0C\u4EC5\u80FD\u6295'+Ie+'\u4E2A\u5E01','warning'),me.abrupt('return',D.dynamic_svr.dynamic_new(H.uid,8).then(function(Ee){if(Q('DailyReward.dynamic: API.dynamic_svr.dynamic_new',Ee),0===Ee.code){if(!!Ee.data.cards){var xe,Oe=JSON.parse(Ee.data.cards[0].card),ve=ue.DailyReward.watch(Oe.aid,Oe.cid);xe=0==ue.CONFIG.COIN_UID||'COIN_DYN'==ue.CONFIG.COIN_TYPE?ue.DailyReward.coin(Ee.data.cards,_Mathmax(Ie,0)):ue.DailyReward.UserSpace(ue.CONFIG.COIN_UID,30,0,1,'','pubdate','jsonp');var he=ue.DailyReward.share(Oe.aid);return $.when(ve,xe,he)}window.toast('[\u81EA\u52A8\u6BCF\u65E5\u5956\u52B1]"\u52A8\u6001-\u6295\u7A3F\u89C6\u9891"\u4E2D\u6682\u65E0\u52A8\u6001','info')}else window.toast('[\u81EA\u52A8\u6BCF\u65E5\u5956\u52B1]\u83B7\u53D6"\u52A8\u6001-\u6295\u7A3F\u89C6\u9891"\''+Ee.msg,'caution')},function(){return window.toast('[\u81EA\u52A8\u6BCF\u65E5\u5956\u52B1]\u83B7\u53D6"\u52A8\u6001-\u6295\u7A3F\u89C6\u9891"\u5931\u8D25\uFF0C\u8BF7\u68C0\u67E5\u7F51\u7EDC','error'),K(function(){return ue.DailyReward.dynamic()})}));case 7:case'end':return me.stop();}},pe,_e)}));return function dynamic(){return ce.apply(this,arguments)}}(),UserSpace:function UserSpace(ce,pe,Ie,Te,fe,me,Ee){return D.x.getUserSpace(ce,pe,Ie,Te,fe,me,Ee).then(function(Oe){if(Q('DailyReward.UserSpace: API.dynamic_svr.UserSpace',Oe),0===Oe.code){if(!!Oe.data.list.vlist){var ve=ue.CONFIG.COIN_NUMBER-ue.DailyReward.coin_exp/10,xe=ue.DailyReward.coin_uid(Oe.data.list.vlist,_Mathmax(ve,0),Te,ce);return xe}window.toast('[\u81EA\u52A8\u6BCF\u65E5\u5956\u52B1]"\u7A7A\u95F4-\u6295\u7A3F\u89C6\u9891"\u4E2D\u6682\u65E0\u89C6\u9891','info')}else window.toast('[\u81EA\u52A8\u6BCF\u65E5\u5956\u52B1]\u83B7\u53D6"\u7A7A\u95F4-\u6295\u7A3F\u89C6\u9891"\''+Oe.msg,'caution')},function(){return window.toast('[\u81EA\u52A8\u6BCF\u65E5\u5956\u52B1]\u83B7\u53D6"\u7A7A\u95F4-\u6295\u7A3F\u89C6\u9891"\u5931\u8D25\uFF0C\u8BF7\u68C0\u67E5\u7F51\u7EDC','error'),K(function(){return ue.DailyReward.UserSpace(ce,pe,Ie,Te,fe,me,Ee)})})},run:function run(){try{return le(ue.CACHE.DailyReward_TS)?D.DailyReward.exp().then(function(ce){return Q('DailyReward.run: API.DailyReward.exp',ce),0===ce.code?(ue.DailyReward.coin_exp=ce.number,ue.DailyReward.login(),ue.DailyReward.dynamic().then(function(){ue.CACHE.DailyReward_TS=Y(),ue.saveCache(),z(ue.DailyReward.run,'\u6BCF\u65E5\u4EFB\u52A1')})):void window.toast('[\u81EA\u52A8\u6BCF\u65E5\u5956\u52B1]'+ce.message,'caution')},function(){return window.toast('[\u81EA\u52A8\u6BCF\u65E5\u5956\u52B1]\u83B7\u53D6\u6BCF\u65E5\u5956\u52B1\u4FE1\u606F\u5931\u8D25\uFF0C\u8BF7\u68C0\u67E5\u7F51\u7EDC','error'),K(function(){return ue.DailyReward.run()})}):(z(ue.DailyReward.run,'\u6BCF\u65E5\u4EFB\u52A1'),$.Deferred().resolve())}catch(ce){return window.toast('[\u81EA\u52A8\u6BCF\u65E5\u5956\u52B1]\u8FD0\u884C\u65F6\u51FA\u73B0\u5F02\u5E38','error'),console.error('['+N+']',ce),$.Deferred().reject()}}},LiveReward:{dailySignIn:function dailySignIn(){return D.xlive.dosign().then(function(ce){Q('LiveReward.dailySignIn: API.xlive.dosign',ce),0===ce.code?window.toast('[\u81EA\u52A8\u76F4\u64AD\u7B7E\u5230]\u5B8C\u6210','success'):1011040===ce.code?window.toast('[\u81EA\u52A8\u76F4\u64AD\u7B7E\u5230]\u4ECA\u65E5\u76F4\u64AD\u7B7E\u5230\u5DF2\u5B8C\u6210','info'):window.toast('[\u81EA\u52A8\u76F4\u64AD\u7B7E\u5230]'+ce.message,'caution')},function(){return window.toast('[\u81EA\u52A8\u76F4\u64AD\u7B7E\u5230]\u76F4\u64AD\u7B7E\u5230\u5931\u8D25\uFF0C\u8BF7\u68C0\u67E5\u7F51\u7EDC','error'),K(function(){return ue.LiveReward.dailySignIn()})})},run:function run(){try{if(!ue.CONFIG.LIVE_SIGN)return $.Deferred().resolve();if(!le(ue.CACHE.LiveReward_TS))return z(ue.LiveReward.run,'\u76F4\u64AD\u7B7E\u5230'),$.Deferred().resolve();ue.LiveReward.dailySignIn(),ue.CACHE.LiveReward_TS=Y(),ue.saveCache(),z(ue.LiveReward.run,'\u76F4\u64AD\u7B7E\u5230')}catch(ce){return window.toast('[\u81EA\u52A8\u76F4\u64AD\u7B7E\u5230]\u8FD0\u884C\u65F6\u51FA\u73B0\u5F02\u5E38','error'),console.error('['+N+']',ce),$.Deferred().reject()}}},Exchange:{silver2coin:function silver2coin(){return D.Exchange.silver2coin().then(function(ce){Q('Exchange.silver2coin: API.SilverCoinExchange.silver2coin',ce),0===ce.code?window.toast('[\u94F6\u74DC\u5B50\u6362\u786C\u5E01]'+ce.msg,'success'):403===ce.code?window.toast('[\u94F6\u74DC\u5B50\u6362\u786C\u5E01]'+ce.msg,'info'):window.toast('[\u94F6\u74DC\u5B50\u6362\u786C\u5E01]'+ce.msg,'caution')},function(){return window.toast('[\u94F6\u74DC\u5B50\u6362\u786C\u5E01]\u5151\u6362\u5931\u8D25\uFF0C\u8BF7\u68C0\u67E5\u7F51\u7EDC','error'),K(function(){return ue.Exchange.silver2coin()})})},runS2C:function runS2C(){try{return ue.CONFIG.SILVER2COIN?le(ue.CACHE.Silver2Coin_TS)?ue.Exchange.silver2coin().then(function(){ue.CACHE.Silver2Coin_TS=Y(),ue.saveCache(),z(ue.Exchange.runS2C,'\u74DC\u5B50\u6362\u786C\u5E01')},function(){return K(function(){return ue.Exchange.runS2C()})}):(z(ue.Exchange.runS2C,'\u74DC\u5B50\u6362\u786C\u5E01'),$.Deferred().resolve()):$.Deferred().resolve()}catch(ce){return window.toast('[\u94F6\u74DC\u5B50\u6362\u786C\u5E01]\u8FD0\u884C\u65F6\u51FA\u73B0\u5F02\u5E38\uFF0C\u5DF2\u505C\u6B62','error'),console.error('['+N+']',ce),$.Deferred().reject()}}},TreasureBox:{timer:void 0,time_end:void 0,time_start:void 0,promise:{calc:void 0,timer:void 0},DOM:{image:void 0,canvas:void 0,div_tip:void 0,div_timer:void 0},init:function init(){if(!ue.CONFIG.AUTO_TREASUREBOX)return $.Deferred().resolve();var ce=$.Deferred();return V(function(){try{if($('.draw-box.gift-left-part').length)return window.toast('[\u81EA\u52A8\u9886\u53D6\u74DC\u5B50]\u5F53\u524D\u76F4\u64AD\u95F4\u6709\u5B9E\u7269\u62BD\u5956\uFF0C\u6682\u505C\u9886\u74DC\u5B50\u529F\u80FD','caution'),ce.resolve(),!0;var pe=$('#gift-control-vm div.treasure-box.p-relative');if(!pe.length)return!1;pe=pe.first(),pe.attr('id','old_treasure_box'),pe.hide();var Ie=$('<div id="'+N+'_treasure_div" class="treasure-box p-relative" style="min-width: 46px;display: inline-block;float: left;padding: 22px 0 0 15px;"></div>');ue.TreasureBox.DOM.div_tip=$('<div id="'+N+'_treasure_div_tip" class="t-center b-box none-select">\u81EA\u52A8<br>\u9886\u53D6\u4E2D</div>'),ue.TreasureBox.DOM.div_timer=$('<div id="'+N+'_treasure_div_timer" class="t-center b-box none-select">0</div>'),ue.TreasureBox.DOM.image=$('<img id="'+N+'_treasure_image" style="display:none">'),ue.TreasureBox.DOM.canvas=$('<canvas id="'+N+'_treasure_canvas" style="display:none" height="40" width="120"></canvas>');var Te='min-width: 40px;padding: 2px 3px;margin-top: 3px;font-size: 12px;color: #fff;background-color: rgba(0,0,255,.5);border-radius: 10px;';ue.TreasureBox.DOM.div_tip[0].style=Te,ue.TreasureBox.DOM.div_timer[0].style=Te,Ie.append(ue.TreasureBox.DOM.div_tip),Ie.append(ue.TreasureBox.DOM.image),Ie.append(ue.TreasureBox.DOM.canvas),ue.TreasureBox.DOM.div_tip.after(ue.TreasureBox.DOM.div_timer),pe.after(Ie);try{if(OCRAD);}catch(fe){return ue.TreasureBox.setMsg('\u521D\u59CB\u5316<br>\u5931\u8D25'),window.toast('[\u81EA\u52A8\u9886\u53D6\u74DC\u5B50]OCRAD\u521D\u59CB\u5316\u5931\u8D25\uFF0C\u8BF7\u68C0\u67E5\u7F51\u7EDC','error'),console.error('['+N+']',fe),ce.resolve(),!0}return ue.TreasureBox.timer=setInterval(function(){var fe=parseInt(ue.TreasureBox.DOM.div_timer.text(),10);isNaN(fe)&&(fe=0),0<fe?ue.TreasureBox.DOM.div_timer.text(fe-1+'s'):ue.TreasureBox.DOM.div_timer.hide()},1e3),ue.TreasureBox.DOM.image[0].onload=function(){var fe=ue.TreasureBox.DOM.canvas[0].getContext('2d');fe.font='40px agencyfbbold',fe.textBaseline='top',fe.clearRect(0,0,ue.TreasureBox.DOM.canvas[0].width,ue.TreasureBox.DOM.canvas[0].height),fe.drawImage(ue.TreasureBox.DOM.image[0],0,0);var me=ue.TreasureBox.captcha.OCR.getGrayscaleMap(fe),Ee=ue.TreasureBox.captcha.OCR.orderFilter2In3x3(me);fe.clearRect(0,0,120,40);for(var ve,Oe=0;Oe<Ee.length;++Oe)ve=Ee[Oe],fe.fillStyle='rgb('+ve+', '+ve+', '+ve+')',fe.fillRect(Oe%120,_Mathround(Oe/120),1,1);try{var Oe=ue.TreasureBox.captcha.correctQuestion(OCRAD(fe.getImageData(0,0,120,40)));Q('TreasureBox.DOM.image.load','question =',Oe);var ve=ue.TreasureBox.captcha.eval(Oe);Q('TreasureBox.DOM.image.load','answer =',ve),void 0!==ve&&(console.info('['+N+'][\u81EA\u52A8\u9886\u53D6\u74DC\u5B50]\u9A8C\u8BC1\u7801\u8BC6\u522B\u7ED3\u679C: '+Oe+' = '+ve),ue.TreasureBox.promise.calc.resolve(ve))}catch(Oe){ue.TreasureBox.promise.calc.reject()}},ce.resolve(),!0}catch(pe){return window.toast('[\u81EA\u52A8\u9886\u53D6\u74DC\u5B50]\u521D\u59CB\u5316\u65F6\u51FA\u73B0\u5F02\u5E38\uFF0C\u5DF2\u505C\u6B62','error'),console.error('['+N+']',pe),ce.reject(),!0}}),ce},run:function run(){try{if(!ue.CONFIG.AUTO_TREASUREBOX||!ue.TreasureBox.timer)return;if(H.blocked)return ue.TreasureBox.setMsg('\u5C0F\u9ED1\u5C4B'),void window.toast('[\u81EA\u52A8\u9886\u53D6\u74DC\u5B50]\u5E10\u53F7\u88AB\u5173\u5C0F\u9ED1\u5C4B\uFF0C\u505C\u6B62\u9886\u53D6\u74DC\u5B50','caution');if(!le(ue.CACHE.TreasureBox_TS))return ue.TreasureBox.setMsg('\u4ECA\u65E5<br>\u5DF2\u9886\u5B8C'),void z(ue.TreasureBox.run,'\u9886\u94F6\u74DC\u5B50\u5B9D\u7BB1');ue.TreasureBox.getCurrentTask().then(function(ce){if(Q('TreasureBox.run: TreasureBox.getCurrentTask().then',ce),0===ce.code){ue.TreasureBox.promise.timer=$.Deferred(),ue.TreasureBox.promise.timer.then(function(){ue.TreasureBox.captcha.calc().then(function(Ie){ue.TreasureBox.getAward(Ie).then(function(){return ue.TreasureBox.run()},function(){return ue.TreasureBox.run()})},function(){return TreasureBox.run()})}),ue.TreasureBox.time_end=ce.data.time_end,ue.TreasureBox.time_start=ce.data.time_start;var pe=ue.TreasureBox.time_end-X()+1;0>pe&&(pe=0),setTimeout(function(){ue.TreasureBox.promise.timer&&ue.TreasureBox.promise.timer.resolve()},1e3*pe),ue.TreasureBox.DOM.div_timer.text(pe+'s'),ue.TreasureBox.DOM.div_timer.show(),ue.TreasureBox.DOM.div_tip.html('\u8F6E\u6570<br>'+ce.data.times+'/'+ce.data.max_times+'<br>\u94F6\u74DC\u5B50<br>'+ce.data.silver)}else if(-10017===ce.code)ue.TreasureBox.setMsg('\u4ECA\u65E5<br>\u5DF2\u9886\u5B8C'),ue.CACHE.TreasureBox_TS=Y(),ue.saveCache(),z(ue.TreasureBox.run,'\u9886\u94F6\u74DC\u5B50\u5B9D\u7BB1');else if(-500===ce.code)location.reload();else return window.toast('[\u81EA\u52A8\u9886\u53D6\u74DC\u5B50]'+ce.msg,'caution'),ue.TreasureBox.run()})}catch(ce){ue.TreasureBox.setMsg('\u8FD0\u884C<br>\u5F02\u5E38'),window.toast('[\u81EA\u52A8\u9886\u53D6\u74DC\u5B50]\u8FD0\u884C\u65F6\u51FA\u73B0\u5F02\u5E38\uFF0C\u5DF2\u505C\u6B62','error'),console.error('['+N+']',ce)}},setMsg:function setMsg(ce){ue.CONFIG.AUTO_TREASUREBOX&&(ue.TreasureBox.promise.timer&&(ue.TreasureBox.promise.timer.reject(),ue.TreasureBox.promise.timer=void 0),ue.TreasureBox.DOM.div_timer&&ue.TreasureBox.DOM.div_timer.hide(),ue.TreasureBox.DOM.div_tip&&ue.TreasureBox.DOM.div_tip.html(ce))},getAward:function getAward(ce){var pe=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0;return ue.CONFIG.AUTO_TREASUREBOX?3<pe?$.Deferred().resolve():D.TreasureBox.getAward(ue.TreasureBox.time_start,ue.TreasureBox.time_end,ce).then(function(){var Ie=_asyncToGenerator(regeneratorRuntime.mark(function Te(fe){var me;return regeneratorRuntime.wrap(function(Oe){for(;;)switch(Oe.prev=Oe.next){case 0:Q('TreasureBox.getAward: getAward',fe),Oe.t0=fe.code,Oe.next=0===Oe.t0?4:-903===Oe.t0?5:-902===Oe.t0?6:-901===Oe.t0?6:-10017===Oe.t0?6:-800===Oe.t0?9:-500===Oe.t0?12:400===Oe.t0?15:22;break;case 4:window.toast('[\u81EA\u52A8\u9886\u53D6\u74DC\u5B50]\u9886\u53D6\u4E86 '+fe.data.awardSilver+' \u94F6\u74DC\u5B50','success');case 5:return Oe.abrupt('return',$.Deferred().resolve());case 6:return Oe.next=8,E(150);case 8:return Oe.abrupt('return',ue.TreasureBox.captcha.calc().then(function(ve){return ue.TreasureBox.getAward(ve,pe)}));case 9:return ue.TreasureBox.setMsg('\u672A\u7ED1\u5B9A<br>\u624B\u673A'),window.toast('[\u81EA\u52A8\u9886\u53D6\u74DC\u5B50]\u672A\u7ED1\u5B9A\u624B\u673A\uFF0C\u5DF2\u505C\u6B62','caution'),Oe.abrupt('return',$.Deferred().reject());case 12:return me=$.Deferred(),setTimeout(function(){ue.TreasureBox.captcha.calc().then(function(ve){ue.TreasureBox.getAward(ve,pe+1).then(function(){return me.resolve()},function(){return me.reject()})},function(){return me.reject()})},3e3),Oe.abrupt('return',me);case 15:if(!(-1<fe.msg.indexOf('\u62D2\u7EDD'))){Oe.next=20;break}return H.blocked=!0,ue.TreasureBox.setMsg('\u62D2\u7EDD<br>\u8BBF\u95EE'),window.toast('[\u81EA\u52A8\u9886\u53D6\u74DC\u5B50]\u8BBF\u95EE\u88AB\u62D2\u7EDD\uFF0C\u60A8\u7684\u5E10\u53F7\u53EF\u80FD\u5DF2\u7ECF\u88AB\u5173\u5C0F\u9ED1\u5C4B\uFF0C\u5DF2\u505C\u6B62','error'),Oe.abrupt('return',$.Deferred().reject());case 20:return window.toast('[\u81EA\u52A8\u9886\u53D6\u74DC\u5B50]'+fe.msg,'caution'),Oe.abrupt('return',$.Deferred().resolve());case 22:window.toast('[\u81EA\u52A8\u9886\u53D6\u74DC\u5B50]'+fe.msg,'caution');case 23:case'end':return Oe.stop();}},Te,_e)}));return function(){return Ie.apply(this,arguments)}}(),function(){return window.toast('[\u81EA\u52A8\u9886\u53D6\u74DC\u5B50]\u83B7\u53D6\u4EFB\u52A1\u5931\u8D25\uFF0C\u8BF7\u68C0\u67E5\u7F51\u7EDC','error'),K(function(){return ue.TreasureBox.getAward(ce,pe)})}):$.Deferred().reject()},getCurrentTask:function getCurrentTask(){return ue.CONFIG.AUTO_TREASUREBOX?D.TreasureBox.getCurrentTask().then(function(ce){return Q('TreasureBox.getCurrentTask: API.TreasureBox.getCurrentTask',ce),$.Deferred().resolve(ce)},function(){return window.toast('[\u81EA\u52A8\u9886\u53D6\u74DC\u5B50]\u83B7\u53D6\u5F53\u524D\u4EFB\u52A1\u5931\u8D25\uFF0C\u8BF7\u68C0\u67E5\u7F51\u7EDC','error'),K(function(){return ue.TreasureBox.getCurrentTask()})}):$.Deferred().reject()},captcha:{cnt:0,calc:function calc(){return ue.CONFIG.AUTO_TREASUREBOX?20<ue.TreasureBox.captcha.cnt?(ue.TreasureBox.setMsg('\u9A8C\u8BC1\u7801<br>\u8BC6\u522B<br>\u5931\u8D25'),window.toast('[\u81EA\u52A8\u9886\u53D6\u74DC\u5B50]\u9A8C\u8BC1\u7801\u8BC6\u522B\u5931\u8D25\uFF0C\u5DF2\u505C\u6B62','error'),$.Deferred().reject()):D.TreasureBox.getCaptcha(Y()).then(function(ce){if(Q('TreasureBox.captcha.calc: getCaptcha',ce),0===ce.code){ue.TreasureBox.captcha.cnt++;var pe=$.Deferred();return ue.TreasureBox.promise.calc=$.Deferred(),ue.TreasureBox.promise.calc.then(function(Ie){ue.TreasureBox.captcha.cnt=0,pe.resolve(Ie)},function(){ue.TreasureBox.captcha.calc().then(function(Ie){pe.resolve(Ie)},function(){pe.reject()})}),ue.TreasureBox.DOM.image.attr('src',ce.data.img),pe}return window.toast('[\u81EA\u52A8\u9886\u53D6\u74DC\u5B50]'+ce.msg,'caution'),K(function(){return ue.TreasureBox.captcha.calc()})},function(){return window.toast('[\u81EA\u52A8\u9886\u53D6\u74DC\u5B50]\u52A0\u8F7D\u9A8C\u8BC1\u7801\u5931\u8D25\uFF0C\u8BF7\u68C0\u67E5\u7F51\u7EDC','error'),K(function(){return ue.TreasureBox.captcha.calc()})}):(ue.TreasureBox.captcha.cnt=0,$.Deferred().reject())},OCR:{getGrayscaleMap:function getGrayscaleMap(ce){for(var pe=1<arguments.length&&arguments[1]!==void 0?arguments[1]:235,Ie=2<arguments.length&&arguments[2]!==void 0?arguments[2]:120,Te=3<arguments.length&&arguments[3]!==void 0?arguments[3]:40,fe=ce.getImageData(0,0,Ie,Te).data,me=[],Ee=0;Ee<Te;Ee++)for(var Oe=0;Oe<Ie;Oe++){var ve=4*(Ee*Ie+Oe),xe=fe.slice(ve,ve+4),he=xe?77*xe[0]+150*xe[1]+29*xe[2]+128>>8:0;me.push(he>pe?he:0)}return me},orderFilter2In3x3:function orderFilter2In3x3(ce){for(var pe=1<arguments.length&&arguments[1]!==void 0?arguments[1]:9,Ie=2<arguments.length&&arguments[2]!==void 0?arguments[2]:120,Te=function gray(he,Ce){return 0<=he+Ce*Ie?ce[he+Ce*Ie]:255},fe=[],me=ce.length,he=0;he<me;++he){var Oe=[he%Ie,_Mathfloor(he/Ie)],ve=Oe[0],xe=Oe[1],Ce=Array(9);Ce[0]=Te(ve-1,xe-1),Ce[1]=Te(ve+0,xe-1),Ce[2]=Te(ve+1,xe-1),Ce[3]=Te(ve-1,xe+0),Ce[4]=Te(ve+0,xe+0),Ce[5]=Te(ve+1,xe+0),Ce[6]=Te(ve-1,xe+1),Ce[7]=Te(ve+0,xe+1),Ce[8]=Te(ve+1,xe+1),Ce.sort(function(ye,Ge){return ye-Ge}),fe.push(Ce[pe-1])}return fe}},eval:function _eval(ce){var pe=Function;return new pe('return '+ce)()},correctStr:{i:1,I:1,"|":1,l:1,o:0,O:0,D:0,S:6,s:6,b:6,R:8,B:8,z:2,Z:2,".":'-',_:4,g:9,">":3},correctQuestion:function correctQuestion(ce){var pe='';for(var Ie in ce=ce.trim(),ce){var Te=ue.TreasureBox.captcha.correctStr[ce[Ie]];pe+=void 0===Te?ce[Ie]:Te}'4'===pe[2]&&(pe[2]='+');for(var Ie=0;Ie<=parseInt(pe.length-2);Ie++)'\''===pe[Ie]&&'1'===pe[Ie+1]&&(pe[Ie]='7',pe.splice(Ie+1,1));return pe}}},Gift:(ge={run_timer:void 0,ruid:void 0,room_id:void 0,medal_list:void 0,bag_list:void 0,time:void 0,remain_feed:void 0,over:!1},_defineProperty(ge,'run_timer',void 0),_defineProperty(ge,'sendGiftList',[1,6,30607]),_defineProperty(ge,'getMedalList',function(){var ce=_asyncToGenerator(regeneratorRuntime.mark(function pe(){var Ie=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1;return regeneratorRuntime.wrap(function(fe){for(;;)switch(fe.prev=fe.next){case 0:return 1===Ie&&(ue.Gift.medal_list=[]),fe.next=3,D.i.medal(Ie,25).then(function(me){if(Q('Gift.getMedalList: API.i.medal',me),ue.Gift.medal_list=ue.Gift.medal_list.concat(me.data.fansMedalList),me.data.pageinfo.curPage<me.data.pageinfo.totalpages)return ue.Gift.getMedalList(Ie+1)},function(){return window.toast('[\u81EA\u52A8\u9001\u793C]\u83B7\u53D6\u52CB\u7AE0\u5217\u8868\u5931\u8D25\uFF0C\u8BF7\u68C0\u67E5\u7F51\u7EDC','error'),K(function(){return ue.Gift.getMedalList()})});case 3:return fe.abrupt('return',fe.sent);case 4:case'end':return fe.stop();}},pe,_e)}));return function getMedalList(){return ce.apply(this,arguments)}}()),_defineProperty(ge,'getBagList',function(){var ce=_asyncToGenerator(regeneratorRuntime.mark(function pe(){return regeneratorRuntime.wrap(function(Te){for(;;)switch(Te.prev=Te.next){case 0:return Te.next=2,D.gift.bag_list().then(function(fe){Q('Gift.getBagList: API.gift.bag_list',fe),ue.Gift.bag_list=fe.data.list,ue.Gift.time=fe.data.time},function(){return window.toast('[\u81EA\u52A8\u9001\u793C]\u83B7\u53D6\u5305\u88F9\u5217\u8868\u5931\u8D25\uFF0C\u8BF7\u68C0\u67E5\u7F51\u7EDC','error'),K(function(){return ue.Gift.getBagList()})});case 2:return Te.abrupt('return',Te.sent);case 3:case'end':return Te.stop();}},pe,_e)}));return function getBagList(){return ce.apply(this,arguments)}}()),_defineProperty(ge,'getFeedByGiftID',function getFeedByGiftID(ce){if(30607===ce)return 50;for(var pe=H.gift_list.length-1;0<=pe;--pe)if(H.gift_list[pe].id===ce)return _Mathceil(H.gift_list[pe].price/100);return 0}),_defineProperty(ge,'sort_medals',function sort_medals(ce){if('high'==ue.CONFIG.GIFT_SORT?ce.sort(function(Oe,ve){return 0==ve.level-Oe.level?ve.intimacy-Oe.intimacy:ve.level-Oe.level}):ce.sort(function(Oe,ve){return 0==Oe.level-ve.level?Oe.intimacy-ve.intimacy:Oe.level-ve.level}),ue.CONFIG.AUTO_GIFT_ROOMID&&0<ue.CONFIG.AUTO_GIFT_ROOMID.length){var Oe=ue.CONFIG.AUTO_GIFT_ROOMID.split(',');Oe.reverse();var pe=!0,Ie=!1,Te=void 0;try{for(var Ee,fe=function _loop2(){var ve=Ee.value,xe=ce.findIndex(function(he){return he.roomid==ve});if(-1!=xe){var he=ce[xe];ce.splice(xe,1),ce.unshift(he)}},me=Oe[Symbol.iterator]();!(pe=(Ee=me.next()).done);pe=!0)fe()}catch(ve){Ie=!0,Te=ve}finally{try{!pe&&me.return&&me.return()}finally{if(Ie)throw Te}}}return ce}),_defineProperty(ge,'auto_light',function(){var ce=_asyncToGenerator(regeneratorRuntime.mark(function pe(Ie){var Te,fe,me,Ee,Oe,ve,xe,he,Ce,ye,Ge,Ne,Re,Ae,De,Me;return regeneratorRuntime.wrap(function(Se){for(;;)switch(Se.prev=Se.next){case 0:Se.prev=0,Te=ue.Gift.getFeedByGiftID(30607),fe=ue.CONFIG.LIGHT_MEDALS.split(','),me=void 0,me='LIGHT_WHITE'==ue.CONFIG.LIGHT_METHOD?Ie.filter(function(Le){return 0==Le.is_lighted&&Le.day_limit-Le.today_feed>=Te&&0<=fe.findIndex(function(Fe){return Fe==Le.roomid})}):Ie.filter(function(Le){return 0==Le.is_lighted&&Le.day_limit-Le.today_feed>=Te&&-1==fe.findIndex(function(Fe){return Fe==Le.roomid})});;if(Q('[auto_light]\u5373\u5C06\u70B9\u4EAE\u52CB\u7AE0\u623F\u95F4\u5217\u8868',me),!(me&&0<me.length)){Se.next=52;break}return me=ue.Gift.sort_medals(me),Se.next=11,ue.Gift.getBagList();case 11:if(Ee=ue.Gift.bag_list.filter(function(Le){return 30607==Le.gift_id}),!(Ee&&0<Ee.length)){Se.next=52;break}Oe=!0,ve=!1,xe=void 0,Se.prev=16,he=me[Symbol.iterator]();case 18:if(Oe=(Ce=he.next()).done){Se.next=38;break}if(ye=Ce.value,Ge=Ee.find(function(Le){return 30607==Le.gift_id&&0<Le.gift_num}),!Ge){Se.next=34;break}if(Ne=ye.day_limit-ye.today_feed,!(0<=Ne-Te||ue.CONFIG.FORCE_LIGHT)){Se.next=33;break}return Se.next=26,D.room.room_init(parseInt(ye.roomid,10));case 26:return Re=Se.sent,Ae=parseInt(Re.data.room_id,10),De=1,Se.next=31,D.gift.bag_send(H.uid,30607,ye.target_id,De,Ge.bag_id,Ae,H.rnd);case 31:Me=Se.sent,0===Me.code?(Ge.gift_num-=De,ye.today_feed+=De*Te,Ne-=De*Te,window.toast('[\u81EA\u52A8\u9001\u793C]\u52CB\u7AE0['+ye.medalName+']\u70B9\u4EAE\u6210\u529F\uFF0C\u9001\u51FA'+De+'\u4E2A'+Ge.gift_name+'\uFF0C['+ye.today_feed+'/'+ye.day_limit+']\u8DDD\u79BB\u5347\u7EA7\u8FD8\u9700['+Ne+']','success'),Q('Gift.auto_light','\u52CB\u7AE0['+ye.medalName+']\u70B9\u4EAE\u6210\u529F\uFF0C\u9001\u51FA'+De+'\u4E2A'+Ge.gift_name+'\uFF0C['+ye.today_feed+'/'+ye.day_limit+']')):window.toast('[\u81EA\u52A8\u9001\u793C]\u52CB\u7AE0['+ye.medalName+']\u70B9\u4EAE\u5931\u8D25\u3010'+Me.msg+'\u3011','caution');case 33:return Se.abrupt('continue',35);case 34:return Se.abrupt('break',38);case 35:Oe=!0,Se.next=18;break;case 38:Se.next=44;break;case 40:Se.prev=40,Se.t0=Se['catch'](16),ve=!0,xe=Se.t0;case 44:Se.prev=44,Se.prev=45,!Oe&&he.return&&he.return();case 47:if(Se.prev=47,!ve){Se.next=50;break}throw xe;case 50:return Se.finish(47);case 51:return Se.finish(44);case 52:Se.next=58;break;case 54:Se.prev=54,Se.t1=Se['catch'](0),console.error(Se.t1),window.toast('[\u81EA\u52A8\u9001\u793C]\u70B9\u4EAE\u52CB\u7AE0\u51FA\u9519:'+Se.t1,'error');case 58:case'end':return Se.stop();}},pe,_e,[[0,54],[16,40,44,52],[45,,47,51]])}));return function auto_light(){return ce.apply(this,arguments)}}()),_defineProperty(ge,'run',function(){var ce=_asyncToGenerator(regeneratorRuntime.mark(function pe(){var Ie,Te,fe,me,Ee,Oe,ve,xe,he,Ce,ye,Ge,Ne,Re,Ae,De;return regeneratorRuntime.wrap(function(be){for(;;)switch(be.prev=be.next){case 0:if(Ie=function FailFunc(){return window.toast('[\u81EA\u52A8\u9001\u793C]\u9001\u793C\u5931\u8D25\uFF0C\u8BF7\u68C0\u67E5\u7F51\u7EDC','error'),K(function(){return ue.Gift.run()})},Te=function nextTimeDebug(){if('GIFT_SEND_TIME'==ue.CONFIG.GIFT_METHOD){var Se=_(ue.CONFIG.GIFT_SEND_HOUR,ue.CONFIG.GIFT_SEND_MINUTE);ue.Gift.run_timer=setTimeout(ue.Gift.run,Se);var Le=new Date(Y()+Se).toLocaleString();Q('[\u81EA\u52A8\u9001\u793C]','\u5C06\u5728'+Le+'\u8FDB\u884C\u81EA\u52A8\u9001\u793C'),ue.CACHE.Gift_TS=Y(),ue.saveCache()}else Q('[\u81EA\u52A8\u9001\u793C]','\u5C06\u5728'+ue.CONFIG.GIFT_INTERVAL+'\u5206\u949F\u540E\u8FDB\u884C\u81EA\u52A8\u9001\u793C'),ue.CACHE.GiftInterval_TS=Y(),ue.saveCache()},be.prev=2,ue.CONFIG.AUTO_GIFT){be.next=5;break}return be.abrupt('return',$.Deferred().resolve());case 5:if(ue.Gift.run_timer&&clearTimeout(ue.Gift.run_timer),'GIFT_SEND_TIME'!=ue.CONFIG.GIFT_METHOD||T(ue.CONFIG.GIFT_SEND_HOUR,ue.CONFIG.GIFT_SEND_MINUTE)||F||w){be.next=14;break}return fe=_(ue.CONFIG.GIFT_SEND_HOUR,ue.CONFIG.GIFT_SEND_MINUTE),ue.Gift.run_timer=setTimeout(ue.Gift.run,fe),me=new Date(Y()+fe).toLocaleString(),Q('[\u81EA\u52A8\u9001\u793C]','\u5C06\u5728'+me+'\u8FDB\u884C\u81EA\u52A8\u9001\u793C'),be.abrupt('return',$.Deferred().resolve());case 14:if('GIFT_INTERVAL'!=ue.CONFIG.GIFT_METHOD||F||w){be.next=27;break}if(Ee=6e4*ue.CONFIG.GIFT_INTERVAL,!ue.CACHE.GiftInterval_TS){be.next=25;break}if(Oe=Y()-ue.CACHE.GiftInterval_TS,!(Oe<Ee)){be.next=23;break}return ve=Ee-Oe,ue.Gift.run_timer=setTimeout(ue.Gift.run,ve),Q('[\u81EA\u52A8\u9001\u793C]','\u5C06\u5728'+ve+'\u6BEB\u79D2\u540E\u8FDB\u884C\u81EA\u52A8\u9001\u793C'),be.abrupt('return');case 23:be.next=27;break;case 25:ue.CACHE.GiftInterval_TS=Y(),ue.saveCache();case 27:return ue.Gift.over=!1,be.next=30,ue.Gift.getMedalList();case 30:if(xe=ue.Gift.medal_list,Q('Gift.run: Gift.getMedalList().then: Gift.medal_list',xe),!(xe&&0<xe.length)){be.next=84;break}xe=xe.filter(function(Se){return 0<Se.day_limit-Se.today_feed&&20>Se.level}),xe=ue.Gift.sort_medals(xe),ue.CONFIG.EXCLUDE_ROOMID&&0<ue.CONFIG.EXCLUDE_ROOMID.length&&(he=ue.CONFIG.EXCLUDE_ROOMID.split(','),xe=xe.filter(function(Se){return-1==he.findIndex(function(Le){return Le==Se.roomid})}));;return be.next=39,ue.Gift.auto_light(xe);case 39:if(!w){be.next=42;break}return w=!1,be.abrupt('return',$.Deferred().resolve());case 42:Ce=!0,ye=!1,Ge=void 0,be.prev=45,Ne=xe[Symbol.iterator]();case 47:if(Ce=(Re=Ne.next()).done){be.next=70;break}if(Ae=Re.value,!ue.Gift.over){be.next=51;break}return be.abrupt('break',70);case 51:return be.next=53,D.room.room_init(parseInt(Ae.roomid,10));case 53:if(De=be.sent,ue.Gift.room_id=parseInt(De.data.room_id,10),ue.Gift.ruid=Ae.target_id,ue.Gift.remain_feed=Ae.day_limit-Ae.today_feed,!(0<ue.Gift.remain_feed)){be.next=67;break}return be.next=60,ue.Gift.getBagList();case 60:if(!(0<ue.Gift.remain_feed)){be.next=66;break}return window.toast('[\u81EA\u52A8\u9001\u793C]\u52CB\u7AE0['+Ae.medalName+'] \u4ECA\u65E5\u4EB2\u5BC6\u5EA6\u672A\u6EE1['+Ae.today_feed+'/'+Ae.day_limit+']\uFF0C\u9884\u8BA1\u9700\u8981['+ue.Gift.remain_feed+']\u9001\u793C\u5F00\u59CB','info'),be.next=64,ue.Gift.sendGift(Ae);case 64:be.next=67;break;case 66:window.toast('[\u81EA\u52A8\u9001\u793C]\u52CB\u7AE0['+Ae.medalName+'] \u4ECA\u65E5\u4EB2\u5BC6\u5EA6\u5DF2\u6EE1','info');case 67:Ce=!0,be.next=47;break;case 70:be.next=76;break;case 72:be.prev=72,be.t0=be['catch'](45),ye=!0,Ge=be.t0;case 76:be.prev=76,be.prev=77,!Ce&&Ne.return&&Ne.return();case 79:if(be.prev=79,!ye){be.next=82;break}throw Ge;case 82:return be.finish(79);case 83:return be.finish(76);case 84:return be.next=86,ue.Gift.sendRemainGift(ue.CONFIG.SPARE_GIFT_ROOM);case 86:be.next=94;break;case 88:return be.prev=88,be.t1=be['catch'](2),Ie(),window.toast('[\u81EA\u52A8\u9001\u793C]\u8FD0\u884C\u65F6\u51FA\u73B0\u5F02\u5E38\uFF0C\u5DF2\u505C\u6B62','error'),console.error('['+N+']',be.t1),be.abrupt('return',$.Deferred().reject());case 94:return F=!1,Te(),be.abrupt('return',$.Deferred().resolve());case 97:case'end':return be.stop();}},pe,_e,[[2,88],[45,72,76,84],[77,,79,83]])}));return function run(){return ce.apply(this,arguments)}}()),_defineProperty(ge,'sendGift',function(){var ce=_asyncToGenerator(regeneratorRuntime.mark(function pe(Ie){var Te,fe,me,Ee,Oe,ve,xe,he,Ce,ye;return regeneratorRuntime.wrap(function(Ne){for(;;)switch(Ne.prev=Ne.next){case 0:return Ne.next=2,ue.Gift.getBagList();case 2:if(Te=void 0,!(0>=ue.Gift.remain_feed)){Ne.next=6;break}return window.toast('[\u81EA\u52A8\u9001\u793C]\u52CB\u7AE0['+Ie.medalName+'] \u9001\u793C\u7ED3\u675F\uFF0C\u4ECA\u65E5\u4EB2\u5BC6\u5EA6\u5DF2\u6EE1['+Ie.today_feed+'/'+Ie.day_limit+']','info'),Ne.abrupt('return',$.Deferred().resolve());case 6:if(0>=ue.Gift.time&&(ue.Gift.time=X()),ue.CONFIG.SEND_ALL_GIFT){Ne.next=18;break}if(fe=ue.Gift.bag_list.filter(function(Re){return ue.Gift.sendGiftList.includes(Re.gift_id)&&0<Re.gift_num&&Re.corner_mark.substring(0,Re.corner_mark.indexOf('\u5929'))<=ue.CONFIG.GIFT_LIMIT}),Q('pass',fe),0!=fe.length){Ne.next=15;break}return ue.Gift.over=!0,Ne.abrupt('return');case 15:Te=fe;case 16:Ne.next=25;break;case 18:if(me=ue.Gift.bag_list.filter(function(Re){return 0<Re.gift_num&&'\u6C38\u4E45'!=Re.corner_mark}),0!=me.length){Ne.next=24;break}return ue.Gift.over=!0,Ne.abrupt('return');case 24:Te=me;case 25:Q('bag_list',Te),Ee=!0,Oe=!1,ve=void 0,Ne.prev=29,xe=regeneratorRuntime.mark(function(){var Re,Ae,De;return regeneratorRuntime.wrap(function(be){for(;;)switch(be.prev=be.next){case 0:if(Re=Ce.value,!(0>=Ie.day_limit-Ie.today_feed)){be.next=4;break}return window.toast('[\u81EA\u52A8\u9001\u793C]\u52CB\u7AE0['+Ie.medalName+'] \u9001\u793C\u7ED3\u675F\uFF0C\u4ECA\u65E5\u4EB2\u5BC6\u5EA6\u5DF2\u6EE1['+Ie.today_feed+'/'+Ie.day_limit+']','info'),be.abrupt('return',{v:void 0});case 4:if(Ae=ue.Gift.getFeedByGiftID(Re.gift_id),!(0<Ae)){be.next=12;break}if(De=_Mathfloor(ue.Gift.remain_feed/Ae),De>Re.gift_num&&(De=Re.gift_num),!(0<De)){be.next=12;break}return Q('[\u81EA\u52A8\u9001\u793C]\u9001\u51FA\u793C\u7269\u7C7B\u578B',Re.gift_name),be.next=12,D.gift.bag_send(H.uid,Re.gift_id,ue.Gift.ruid,De,Re.bag_id,ue.Gift.room_id,H.rnd).then(function(Se){Q('Gift.sendGift: API.gift.bag_send',Se),0===Se.code?(Re.gift_num-=De,Ie.today_feed+=De*Ae,ue.Gift.remain_feed-=De*Ae,window.toast('[\u81EA\u52A8\u9001\u793C]\u52CB\u7AE0['+Ie.medalName+'] \u9001\u793C\u6210\u529F\uFF0C\u9001\u51FA'+De+'\u4E2A'+Re.gift_name+'\uFF0C['+Ie.today_feed+'/'+Ie.day_limit+']\u8DDD\u79BB\u5347\u7EA7\u8FD8\u9700['+ue.Gift.remain_feed+']','success')):window.toast('[\u81EA\u52A8\u9001\u793C]\u52CB\u7AE0['+Ie.medalName+'] \u9001\u793C\u5F02\u5E38:'+Se.msg,'caution')},function(){return window.toast('[\u81EA\u52A8\u9001\u793C]\u5305\u88F9\u9001\u793C\u5931\u8D25\uFF0C\u8BF7\u68C0\u67E5\u7F51\u7EDC','error'),K(function(){return ue.Gift.sendGift(Ie)})});case 12:case'end':return be.stop();}},xe,_e)}),he=Te[Symbol.iterator]();case 32:if(Ee=(Ce=he.next()).done){Ne.next=40;break}return Ne.delegateYield(xe(),'t0',34);case 34:if(ye=Ne.t0,'object'!==('undefined'==typeof ye?'undefined':_typeof(ye))){Ne.next=37;break}return Ne.abrupt('return',ye.v);case 37:Ee=!0,Ne.next=32;break;case 40:Ne.next=46;break;case 42:Ne.prev=42,Ne.t1=Ne['catch'](29),Oe=!0,ve=Ne.t1;case 46:Ne.prev=46,Ne.prev=47,!Ee&&he.return&&he.return();case 49:if(Ne.prev=49,!Oe){Ne.next=52;break}throw ve;case 52:return Ne.finish(49);case 53:return Ne.finish(46);case 54:case'end':return Ne.stop();}},pe,_e,[[29,42,46,54],[47,,49,53]])}));return function sendGift(){return ce.apply(this,arguments)}}()),_defineProperty(ge,'sendRemainGift',function(){var ce=_asyncToGenerator(regeneratorRuntime.mark(function pe(Ie){var Te,fe,me,Ee,Oe,ve,xe,he,Ce,ye;return regeneratorRuntime.wrap(function(Ne){for(;;)switch(Ne.prev=Ne.next){case 0:if(0!=Ie){Ne.next=2;break}return Ne.abrupt('return',$.Deferred().resolve());case 2:return Te=void 0,Ne.next=5,D.live_user.get_anchor_in_room(Ie).then(function(Re){return Q('API.live_user.get_anchor_in_room',Re),Re.data.info.uid?void(Te=Re.data.info.uid):(window.toast('[\u81EA\u52A8\u9001\u793C]\u3010\u5269\u4F59\u793C\u7269\u3011\u68C0\u67E5\u623F\u95F4\u51FA\u9519'),$.Deferred().reject())});case 5:return Ne.next=7,ue.Gift.getBagList();case 7:if(fe=void 0,0>=ue.Gift.time&&(ue.Gift.time=X()),ue.CONFIG.SEND_ALL_GIFT){Ne.next=19;break}if(me=ue.Gift.bag_list.filter(function(Re){return ue.Gift.sendGiftList.includes(Re.gift_id)&&0<Re.gift_num&&'1\u5929'==Re.corner_mark}),0!=me.length){Ne.next=16;break}return ue.Gift.over=!0,Ne.abrupt('return');case 16:fe=me;case 17:Ne.next=26;break;case 19:if(Ee=ue.Gift.bag_list.filter(function(Re){return 0<Re.gift_num&&'\u6C38\u4E45'!=Re.corner_mark}),0!=Ee.length){Ne.next=25;break}return ue.Gift.over=!0,Ne.abrupt('return');case 25:fe=Ee;case 26:Q('[\u81EA\u52A8\u9001\u793C]\u3010\u5269\u4F59\u793C\u7269\u3011bag_list',fe),Oe=!0,ve=!1,xe=void 0,Ne.prev=30,he=regeneratorRuntime.mark(function(){var Re,Ae,De;return regeneratorRuntime.wrap(function(be){for(;;)switch(be.prev=be.next){case 0:if(Re=ye.value,Ae=ue.Gift.getFeedByGiftID(Re.gift_id),!(0<Ae)){be.next=7;break}if(De=Re.gift_num,!(0<De)){be.next=7;break}return be.next=7,D.gift.bag_send(H.uid,Re.gift_id,Te,De,Re.bag_id,Ie,H.rnd).then(function(Se){Q('Gift.sendGift: API.gift.bag_send',Se),0===Se.code?(Re.gift_num-=De,window.toast('[\u81EA\u52A8\u9001\u793C]\u3010\u5269\u4F59\u793C\u7269\u3011\u623F\u95F4['+Ie+'] \u9001\u793C\u6210\u529F\uFF0C\u9001\u51FA'+De+'\u4E2A'+Re.gift_name,'success')):window.toast('[\u81EA\u52A8\u9001\u793C]\u3010\u5269\u4F59\u793C\u7269\u3011\u623F\u95F4['+Ie+'] \u9001\u793C\u5F02\u5E38:'+Se.msg,'caution')},function(){return window.toast('[\u81EA\u52A8\u9001\u793C]\u3010\u5269\u4F59\u793C\u7269\u3011\u5305\u88F9\u9001\u793C\u5931\u8D25\uFF0C\u8BF7\u68C0\u67E5\u7F51\u7EDC','error'),K(function(){return ue.Gift.sendGift(medal)})});case 7:case'end':return be.stop();}},he,_e)}),Ce=fe[Symbol.iterator]();case 33:if(Oe=(ye=Ce.next()).done){Ne.next=38;break}return Ne.delegateYield(he(),'t0',35);case 35:Oe=!0,Ne.next=33;break;case 38:Ne.next=44;break;case 40:Ne.prev=40,Ne.t1=Ne['catch'](30),ve=!0,xe=Ne.t1;case 44:Ne.prev=44,Ne.prev=45,!Oe&&Ce.return&&Ce.return();case 47:if(Ne.prev=47,!ve){Ne.next=50;break}throw xe;case 50:return Ne.finish(47);case 51:return Ne.finish(44);case 52:case'end':return Ne.stop();}},pe,_e,[[30,40,44,52],[45,,47,51]])}));return function sendRemainGift(){return ce.apply(this,arguments)}}()),ge),stormQueue:[],stormBlack:!1,stormIdSet:{add:function add(ce){var pe=[];try{var Ie=JSON.parse(localStorage.getItem(N+'stormIdSet'));pe=[].concat(Ie.list),pe.push(ce),50<pe.length&&pe.splice(0,10),localStorage.setItem(N+'stormIdSet',JSON.stringify({list:pe})),Q(N+'storm_Id_list_add',pe)}catch(Ie){pe.push(ce),localStorage.setItem(N+'stormIdSet',JSON.stringify({list:pe}))}},isIn:function isIn(ce){var pe=[];try{var Ie=JSON.parse(localStorage.getItem(N+'stormIdSet'));return pe=null===Ie?[]:[].concat(Ie.list),Q(N+'storm_Id_list_read',Ie),-1<pe.indexOf(ce)}catch(Ie){return localStorage.setItem(N+'stormIdSet',JSON.stringify({list:pe})),Q('\u8BFB\u53D6'+(N+'stormIdSet\u7F13\u5B58\u9519\u8BEF\u5DF2\u91CD\u7F6E')),-1<pe.indexOf(ce)}}},Storm:{check:function check(ce){return-1<ue.stormQueue.indexOf(ce)},append:function append(ce){ue.stormQueue.push(ce),ue.stormQueue.length>ue.CONFIG.STORM_QUEUE_SIZE&&ue.stormQueue.shift()},over:function over(ce){var pe=ue.stormQueue.indexOf(ce);-1<pe&&ue.stormQueue.splice(ce,1)},run:function run(ce){try{return ue.CONFIG.STORM?ue.stormBlack?$.Deferred().resolve():f(ue.CONFIG.TIME_AREA_START_H0UR,ue.CONFIG.TIME_AREA_END_H0UR,ue.CONFIG.TIME_AREA_START_MINUTE,ue.CONFIG.TIME_AREA_END_MINUTE)&&ue.CONFIG.TIME_AREA_DISABLE?(Q('\u8282\u594F\u98CE\u66B4','\u81EA\u52A8\u4F11\u7720\uFF0C\u8DF3\u8FC7\u68C0\u6D4Broomid='+ce),$.Deferred().resolve()):D.Storm.check(ce).then(function(pe){if(Q('MY_API.Storm.run: MY_API.API.Storm.check',pe),0===pe.code){var Ie=pe.data;return ue.Storm.join(Ie.id,Ie.roomid,_Mathround(new Date().getTime()/1e3)+Ie.time),$.Deferred().resolve()}window.toast('[\u81EA\u52A8\u62BD\u5956][\u8282\u594F\u98CE\u66B4](roomid='+ce+')'+pe.msg,'caution')},function(){window.toast('[\u81EA\u52A8\u62BD\u5956][\u8282\u594F\u98CE\u66B4]\u68C0\u67E5\u76F4\u64AD\u95F4('+ce+')\u5931\u8D25\uFF0C\u8BF7\u68C0\u67E5\u7F51\u7EDC','error')}):$.Deferred().resolve()}catch(pe){return window.toast('[\u81EA\u52A8\u62BD\u5956][\u8282\u594F\u98CE\u66B4]\u8FD0\u884C\u65F6\u51FA\u73B0\u5F02\u5E38','error'),console.error('['+N+']',pe),$.Deferred().reject()}},join:function join(ce,pe,Ie){var Te=function(){var Oe=_asyncToGenerator(regeneratorRuntime.mark(function ve(){var xe,he;return regeneratorRuntime.wrap(function(ye){for(;;)switch(ye.prev=ye.next){case 0:if(ye.prev=0,ue.Storm.check(ce)){ye.next=4;break}return clearInterval(me),ye.abrupt('return');case 4:if(xe=_Mathround(new Date().getTime()/1e3),!(xe>Ie&&0<Ie)){ye.next=9;break}return ue.Storm.over(ce),clearInterval(me),ye.abrupt('return');case 9:if(Ee++,!(Ee>ue.CONFIG.STORM_MAX_COUNT&&0<ue.CONFIG.STORM_MAX_COUNT)){ye.next=15;break}return ue.Storm.over(ce),clearInterval(me),window.toast('[\u81EA\u52A8\u62BD\u5956][\u8282\u594F\u98CE\u66B4]\u62BD\u5956(roomid='+pe+',id='+ce+')\u5230\u8FBE\u5C1D\u8BD5\u6B21\u6570\u3002\r\n\u5C1D\u8BD5\u6B21\u6570:'+Ee+',\u8DDD\u79BB\u5230\u671F:'+(Ie-xe)+'s','caution'),ye.abrupt('return');case 15:if(he=void 0,ye.prev=16,!(ie&&ee&&ae.access_token)){ye.next=23;break}return ye.next=20,D.Storm.join_ex(ce,pe,ae.access_token,BilibiliToken.appKey,BilibiliToken.headers);case 20:he=ye.sent,ye.next=26;break;case 23:return ye.next=25,D.Storm.join(ce,captcha_token='',captcha_phrase='',pe);case 25:he=ye.sent;case 26:if(Q('MY_API.Storm.join: MY_API.API.Storm.join',he),!he.code){ye.next=51;break}if(-1==he.msg.indexOf('\u9886\u53D6')){ye.next=33;break}return ue.Storm.over(ce),clearInterval(me),window.toast('[\u81EA\u52A8\u62BD\u5956][\u8282\u594F\u98CE\u66B4]\u9886\u53D6(roomid='+pe+',id='+ce+')\u6210\u529F,'+he.msg+'\r\n\u5C1D\u8BD5\u6B21\u6570:'+Ee,'success'),ye.abrupt('return');case 33:if(-1==he.msg.indexOf('\u9A8C\u8BC1\u7801')){ye.next=39;break}return ue.Storm.over(ce),clearInterval(me),ue.stormBlack=!0,window.toast('[\u81EA\u52A8\u62BD\u5956][\u8282\u594F\u98CE\u66B4]\u62BD\u5956(roomid='+pe+',id='+ce+')\u5931\u8D25,\u7591\u4F3C\u8D26\u53F7\u4E0D\u652F\u6301,'+he.msg,'caution'),ye.abrupt('return');case 39:if(!(he.data&&0==he.data.length&&-1!=he.msg.indexOf('\u4E0B\u6B21\u8981\u66F4\u5FEB\u4E00\u70B9'))){ye.next=46;break}return ue.Storm.over(ce),window.toast('[\u81EA\u52A8\u62BD\u5956][\u8282\u594F\u98CE\u66B4]\u62BD\u5956(roomid='+pe+',id='+ce+')\u7591\u4F3C\u98CE\u66B4\u9ED1\u5C4B,\u7EC8\u6B62\uFF01','error'),clearInterval(me),ue.stormBlack=!0,setTimeout(function(){ue.stormBlack=!1},3600000),ye.abrupt('return');case 46:if(-1!=he.msg.indexOf('\u4E0B\u6B21\u8981\u66F4\u5FEB\u4E00\u70B9')){ye.next=49;break}return clearInterval(me),ye.abrupt('return');case 49:ye.next=56;break;case 51:return ue.Storm.over(ce),Statistics.appendGift(he.data.gift_name,he.data.gift_num),window.toast('[\u81EA\u52A8\u62BD\u5956][\u8282\u594F\u98CE\u66B4]\u9886\u53D6(roomid='+pe+',id='+ce+')\u6210\u529F,'+(he.data.gift_name+'x'+he.data.gift_num)+'\r\n'+he.data.mobile_content+'\r\n\u5C1D\u8BD5\u6B21\u6570:'+Ee,'success'),clearInterval(me),ye.abrupt('return');case 56:ye.next=65;break;case 58:return ye.prev=58,ye.t0=ye['catch'](16),ue.Storm.over(ce),window.toast('[\u81EA\u52A8\u62BD\u5956][\u8282\u594F\u98CE\u66B4]\u62BD\u5956(roomid='+pe+',id='+ce+')\u7591\u4F3C\u89E6\u53D1\u98CE\u63A7,\u7EC8\u6B62\uFF01\r\n\u5C1D\u8BD5\u6B21\u6570:'+Ee,'error'),console.error(ye.t0),clearInterval(me),ye.abrupt('return');case 65:ye.next=74;break;case 67:return ye.prev=67,ye.t1=ye['catch'](0),ue.Storm.over(ce),window.toast('[\u81EA\u52A8\u62BD\u5956][\u8282\u594F\u98CE\u66B4]\u62BD\u5956(roomid='+pe+',id='+ce+')\u62BD\u5956\u5F02\u5E38,\u7EC8\u6B62\uFF01','error'),console.error(ye.t1),clearInterval(me),ye.abrupt('return');case 74:case'end':return ye.stop();}},ve,this,[[0,67],[16,58]])}));return function(){return Oe.apply(this,arguments)}}();if(pe=parseInt(pe,10),ce=parseInt(ce,10),isNaN(pe)||isNaN(ce))return $.Deferred().reject();var fe=_Mathround(ce/1e6);if(ue.stormIdSet.isIn(fe))return $.Deferred().resolve();if(ue.stormIdSet.add(fe),!ue.Storm.check(ce)){ue.Storm.append(ce);var me=0;0>=Ie&&(Ie=_Mathround(new Date().getTime()/1e3)+90);var Ee=0;return window.toast('[\u81EA\u52A8\u62BD\u5956][\u8282\u594F\u98CE\u66B4]\u5C1D\u8BD5\u62BD\u5956(roomid='+pe+',id='+ce+')','success'),me=setInterval(function(){return Te()},ue.CONFIG.STORM_ONE_LIMIT),$.Deferred().resolve()}}},LITTLE_HEART:{getInfo:function getInfo(){return C({GM:!0,anonymous:!0,method:'GET',url:'https://passport.bilibili.com/x/passport-login/oauth2/info?'+ee.signLoginQuery('access_key='+ae.access_token),responseType:'json',headers:ee.headers})},mobileOnline:function mobileOnline(){return C({GM:!0,anonymous:!0,method:'POST',url:'https://api.live.bilibili.com/heartbeat/v1/OnLine/mobileOnline?'+BilibiliToken.signQuery('access_key='+ae.access_token+'&'+te),data:'room_id='+H.room_id+'&scale=xxhdpi',responseType:'json',headers:ee.headers})},RandomHex:function RandomHex(ce){var pe='0123456789abcdef',Ie='';Ie+=pe[_Mathfloor(15*Math.random())+1];for(var Te=0;Te<ce-1;Te++)Ie+=pe[_Mathfloor(16*Math.random())];return Ie},uuid:function uuid(){return ue.LITTLE_HEART.RandomHex(32).replace(/(\w{8})(\w{4})\w(\w{3})\w(\w{3})(\w{12})/,'$1-$2-4$3-'+'89ab'[_Mathfloor(4*Math.random())]+'$4-$5')},getFansMedal:function(){var ce=_asyncToGenerator(regeneratorRuntime.mark(function pe(){var Ie;return regeneratorRuntime.wrap(function(fe){for(;;)switch(fe.prev=fe.next){case 0:return fe.next=2,C({GM:!0,anonymous:!0,method:'GET',url:'https://api.live.bilibili.com/fans_medal/v1/FansMedal/get_list_in_room?'+BilibiliToken.signQuery('access_key='+ae.access_token+'&target_id='+H.tid+'&uid='+H.uid+'&'+te),responseType:'json',headers:ee.headers});case 2:if(Ie=fe.sent,void 0===Ie||200!==Ie.response.status){fe.next=7;break}if(0!==Ie.body.code){fe.next=7;break}if(!(0<Ie.body.data.length)){fe.next=7;break}return fe.abrupt('return',Ie.body.data);case 7:case'end':return fe.stop();}},pe,_e)}));return function getFansMedal(){return ce.apply(this,arguments)}}(),getGiftNum:function(){var ce=_asyncToGenerator(regeneratorRuntime.mark(function pe(){var Ie,Te,fe,me,Ee,Oe,ve,xe,he;return regeneratorRuntime.wrap(function(ye){for(;;)switch(ye.prev=ye.next){case 0:return Ie=0,ye.next=3,C({GM:!0,anonymous:!0,method:'GET',url:'https://api.live.bilibili.com/xlive/app-room/v1/gift/bag_list?'+BilibiliToken.signQuery('access_key='+ae.access_token+'&room_id='+H.room_id+'&'+te),responseType:'json',headers:ee.headers});case 3:if(Te=ye.sent,void 0===Te||200!==Te.response.status){ye.next=26;break}if(0!==Te.body.code){ye.next=26;break}if(!(0<Te.body.data.list.length)){ye.next=26;break}for(fe=!0,me=!1,Ee=void 0,ye.prev=10,Oe=Te.body.data.list[Symbol.iterator]();!(fe=(ve=Oe.next()).done);fe=!0)xe=ve.value,30607===xe.gift_id&&(he=(xe.expire_at-Date.now()/1e3)/60/60/24,6<he&&7>=he&&(Ie+=xe.gift_num));ye.next=18;break;case 14:ye.prev=14,ye.t0=ye['catch'](10),me=!0,Ee=ye.t0;case 18:ye.prev=18,ye.prev=19,!fe&&Oe.return&&Oe.return();case 21:if(ye.prev=21,!me){ye.next=24;break}throw Ee;case 24:return ye.finish(21);case 25:return ye.finish(18);case 26:return ye.abrupt('return',Ie);case 27:case'end':return ye.stop();}},pe,_e,[[10,14,18,26],[19,,21,25]])}));return function getGiftNum(){return ce.apply(this,arguments)}}(),mobileHeartBeat:function(){var ce=_asyncToGenerator(regeneratorRuntime.mark(function pe(Ie){var Te,fe,me,Ee,Oe,ve;return regeneratorRuntime.wrap(function(he){for(;;)switch(he.prev=he.next){case 0:return Te=new WasmHash,he.next=3,Te.init();case 3:for(Oe in fe=function clientSign(Ce){return Te.hash('BLAKE2b512',Te.hash('SHA3-384',Te.hash('SHA384',Te.hash('SHA3-512',Te.hash('SHA512',JSON.stringify(Ce))))))},me=fe(Ie),Ee='',Ie)Ee+=Oe+'='+encodeURIComponent(Ie[Oe])+'&';return Ee+='client_sign='+me,he.next=10,C({GM:!0,anonymous:!0,method:'POST',url:'https://live-trace.bilibili.com/xlive/data-interface/v1/heartbeat/mobileHeartBeat',data:BilibiliToken.signQuery('access_key='+ae.access_token+'&'+Ee+'&'+te),responseType:'json',headers:ee.headers});case 10:if(ve=he.sent,void 0===ve||200!==ve.response.status){he.next=14;break}if(0!==ve.body.code){he.next=14;break}return he.abrupt('return',!0);case 14:return he.abrupt('return',!1);case 15:case'end':return he.stop();}},pe,_e)}));return function mobileHeartBeat(){return ce.apply(this,arguments)}}(),run:function(){var ce=_asyncToGenerator(regeneratorRuntime.mark(function pe(){var Ie,Te,fe,me,Ee,Oe,ve,xe,he,Ce,ye,Ge,Ne,Re,Ae,De,Me;return regeneratorRuntime.wrap(function(Se){for(;;)switch(Se.prev=Se.next){case 0:if(ue.CONFIG.LITTLE_HEART){Se.next=2;break}return Se.abrupt('return',$.Deferred().resolve());case 2:if(le(ue.CACHE.LittleHeart_TS)){Se.next=5;break}return z(ue.LITTLE_HEART.run,'\u83B7\u53D6\u5C0F\u5FC3\u5FC3'),Se.abrupt('return',$.Deferred().resolve());case 5:if(Ie={platform:'android',uuid:ue.LITTLE_HEART.uuid(),buvid:ee.buvid,seq_id:'1',room_id:'{room_id}',parent_id:'6',area_id:'283',timestamp:'{timestamp}',secret_key:'axoaadsffcazxksectbbb',watch_time:'300',up_id:'{target_id}',up_level:'40',jump_from:'30000',gu_id:ue.LITTLE_HEART.RandomHex(43),play_type:'0',play_url:'',s_time:'0',data_behavior_id:'',data_source_id:'',up_session:'l:one:live:record:{room_id}:{last_wear_time}',visit_id:ue.LITTLE_HEART.RandomHex(32),watch_status:'%7B%22pk_id%22%3A0%2C%22screen_status%22%3A1%7D',click_id:ue.LITTLE_HEART.uuid(),session_id:'',player_type:'0',client_ts:'{client_ts}'},Te=function endFunc(){window.toast('[\u5C0F\u5FC3\u5FC3]\u4ECA\u65E5\u5C0F\u5FC3\u5FC3\u5DF2\u5168\u90E8\u83B7\u53D6','success'),clearInterval(me),ue.CACHE.LittleHeart_TS=Y(),ue.saveCache(),z(ue.LITTLE_HEART.run,'\u83B7\u53D6\u5C0F\u5FC3\u5FC3')},Se.t0=void 0===ae.access_token,!Se.t0){Se.next=14;break}return Se.next=11,oe();case 11:Se.t1=Se.sent,Se.t2=void 0,Se.t0=Se.t1===Se.t2;case 14:if(!Se.t0){Se.next=18;break}return Se.abrupt('return');case 18:if(ae.access_token||ae.mid||ae.refresh_token){Se.next=45;break}return Se.next=21,ue.LITTLE_HEART.getInfo();case 21:if(fe=Se.sent,Q('[\u5C0F\u5FC3\u5FC3]userInfo',fe),void 0!==fe){Se.next=25;break}return Se.abrupt('return',console.error(GM_info.script.name,'\u83B7\u53D6\u7528\u6237\u4FE1\u606F\u9519\u8BEF'));case 25:if(Se.t3=0!==fe.body.code,!Se.t3){Se.next=32;break}return Se.next=29,oe();case 29:Se.t4=Se.sent,Se.t5=void 0,Se.t3=Se.t4===Se.t5;case 32:if(!Se.t3){Se.next=36;break}return Se.abrupt('return');case 36:if(Se.t6=fe.body.data.mid!==H.uid,!Se.t6){Se.next=43;break}return Se.next=40,oe();case 40:Se.t7=Se.sent,Se.t8=void 0,Se.t6=Se.t7===Se.t8;case 43:if(!Se.t6){Se.next=45;break}return Se.abrupt('return');case 45:return Q('[\u5C0F\u5FC3\u5FC3]','\u5F00\u59CB\u5BA2\u6237\u7AEF\u5FC3\u8DF3'),ue.LITTLE_HEART.mobileOnline(),me=setInterval(function(){return ue.LITTLE_HEART.mobileOnline()},300000),Se.next=50,ue.LITTLE_HEART.getGiftNum();case 50:if(Ee=Se.sent,!(24>Ee)){Se.next=103;break}return Se.next=54,ue.LITTLE_HEART.getFansMedal();case 54:if(Oe=Se.sent,void 0===Oe){Se.next=101;break}ve=24-Ee,xe=_Mathceil(ve/Oe.length),he=0,Ce=0;case 60:if(!(Ce<xe)){Se.next=101;break}ye=!0,Ge=!1,Ne=void 0,Se.prev=64,Re=Oe[Symbol.iterator]();case 66:if(ye=(Ae=Re.next()).done){Se.next=77;break}if(De=Ae.value,!(he>=ve)){Se.next=70;break}return Se.abrupt('break',77);case 70:return Me=Object.assign({},Ie,{room_id:De.room_id.toString(),timestamp:(BilibiliToken.TS-300).toString(),up_id:De.target_id.toString(),up_session:'l:one:live:record:'+De.room_id+':'+De.last_wear_time,client_ts:BilibiliToken.TS.toString()}),Se.next=73,ue.LITTLE_HEART.mobileHeartBeat(Me);case 73:he++;case 74:ye=!0,Se.next=66;break;case 77:Se.next=83;break;case 79:Se.prev=79,Se.t9=Se['catch'](64),Ge=!0,Ne=Se.t9;case 83:Se.prev=83,Se.prev=84,!ye&&Re.return&&Re.return();case 86:if(Se.prev=86,!Ge){Se.next=89;break}throw Ne;case 89:return Se.finish(86);case 90:return Se.finish(83);case 91:if(!(he>=ve)){Se.next=96;break}return Te(),Se.abrupt('break',101);case 96:return Se.next=98,E(300000);case 98:Ce++,Se.next=60;break;case 101:Se.next=104;break;case 103:Te();case 104:return Se.abrupt('return',$.Deferred().resolve());case 105:case'end':return Se.stop();}},pe,_e,[[64,79,83,91],[84,,86,90]])}));return function run(){return ce.apply(this,arguments)}}()}};ue.init().then(function(){try{var ce=$.Deferred();(function uniqueCheck(){var Ie=Y();return 0<=Ie-ue.CACHE.UNIQUE_CHECK&&15e3>=Ie-ue.CACHE.UNIQUE_CHECK?($('.link-toast').remove(),$('.igiftMsg').remove(),ue.CONFIG.AUTO_TREASUREBOX=!1,window.toast('\u6709\u5176\u4ED6\u76F4\u64AD\u95F4\u9875\u9762\u7684\u811A\u672C\u6B63\u5728\u8FD0\u884C\uFF0C\u672C\u9875\u9762\u811A\u672C\u505C\u6B62\u8FD0\u884C','caution'),ce.reject()):ce.resolve()})().then(function(){var Ie,Te=function uniqueMark(){Ie=setTimeout(Te,1e4),ue.CACHE.UNIQUE_CHECK=Date.now(),ue.saveCache(!1)};return(window.addEventListener('unload',function(){Ie&&(clearTimeout(Ie),ue.CACHE.UNIQUE_CHECK=0,ue.saveCache()),I(U)}),Te(),0===parseInt(H.uid)||isNaN(parseInt(H.uid)))?void ue.chatLog('\u672A\u767B\u5F55\uFF0C\u8BF7\u5148\u767B\u5F55\u518D\u4F7F\u7528\u811A\u672C','warning'):void(ue.newMessage(GM_info.script.version),Q('MY_API.CONFIG',ue.CONFIG),l(ue))})}catch(ce){console.error('\u91CD\u590D\u8FD0\u884C\u68C0\u6D4B\u9519\u8BEF',ce)}})}function l(_e){'use strict';var ge=function clearStat(){_e.GIFT_COUNT.COUNT=0,_e.GIFT_COUNT.CLEAR_TS=de(),_e.saveGiftCount(),Q('\u5DF2\u6E05\u7A7A\u8FA3\u6761\u6570\u91CF')};if(le(_e.GIFT_COUNT.CLEAR_TS)&&ge(),Z(ge,'\u91CD\u7F6E\u7EDF\u8BA1'),_e.creatSetBox(),_e.removeUnnecessary(),setTimeout(function(){_e.LITTLE_HEART.run(),_e.GroupSign.run(),_e.DailyReward.run(),_e.LiveReward.run(),_e.Exchange.runS2C(),_e.TreasureBox.run(),_e.Gift.run()},6e3),_e.CONFIG.LOTTERY&&(D.room.getList().then(function(ce){Q('\u76F4\u64AD\u95F4\u5217\u8868',ce);var pe=!0,Ie=!1,Te=void 0;try{for(var Ee,fe=function _loop5(){var Oe=Ee.value;D.room.getRoomList(Oe.id,0,0,1,1).then(function(ve){Q('\u76F4\u64AD\u95F4\u53F7\u5217\u8868',ve);for(var xe=0;xe<ve.data.length;++xe)_e.listen(ve.data[xe].roomid,H.uid,Oe.name+'\u533A')})},me=ce.data[Symbol.iterator]();!(pe=(Ee=me.next()).done);pe=!0)fe()}catch(Oe){Ie=!0,Te=Oe}finally{try{!pe&&me.return&&me.return()}finally{if(Ie)throw Te}}}),_e.CONFIG.CHECK_HOUR_ROOM)){var ce=function check_top_room(){if(_e.GIFT_COUNT.COUNT>=_e.CONFIG.MAX_GIFT&&(Q('\u8D85\u8FC7\u4ECA\u65E5\u8FA3\u6761\u9650\u5236\uFF0C\u4E0D\u53C2\u4E0E\u62BD\u5956'),_e.max_blocked=!0),_e.blocked||_e.max_blocked)return _e.blocked?(_e.chatLog('\u8FDB\u5165\u5C0F\u9ED1\u5C4B\u68C0\u67E5\u5C0F\u65F6\u699C\u5DF2\u505C\u6B62\u8FD0\u884C'),void clearInterval(pe)):void _e.chatLog('\u8FA3\u6761\u5DF2\u8FBE\u5230\u6700\u5927\u503C\u68C0\u67E5\u5C0F\u65F6\u699C\u5DF2\u505C\u6B62\u8FD0\u884C');if(f(_e.CONFIG.TIME_AREA_START_H0UR,_e.CONFIG.TIME_AREA_END_H0UR,_e.CONFIG.TIME_AREA_START_MINUTE,_e.CONFIG.TIME_AREA_END_MINUTE)&&_e.CONFIG.TIME_AREA_DISABLE)return void _e.chatLog('\u5F53\u524D\u65F6\u95F4\u6BB5\u4E0D\u68C0\u67E5\u5C0F\u65F6\u699C\u793C\u7269','warning');var Ie=['\u5C0F\u65F6\u603B\u699C','\u5A31\u4E50\u5C0F\u65F6\u699C','\u7F51\u6E38\u5C0F\u65F6\u699C','\u624B\u6E38\u5C0F\u65F6\u699C','\u7ED8\u753B\u5C0F\u65F6\u699C','\u7535\u53F0\u5C0F\u65F6\u699C','\u5355\u673A\u5C0F\u65F6\u699C'],Te=1,fe=function checkHourRank(Ee){D.rankdb.getTopRealTimeHour(Ee).then(function(Oe){var ve=Oe.data.list;_e.chatLog('\u68C0\u67E5'+Ie[Ee]+'\u623F\u95F4\u7684\u793C\u7269','warning'),Q(Ie[Ee]+'\u623F\u95F4\u5217\u8868',ve);var xe=!0,he=!1,Ce=void 0;try{for(var Ge,Ne,ye=ve[Symbol.iterator]();!(xe=(Ge=ye.next()).done);xe=!0)Ne=Ge.value,_e.checkRoom(Ne.roomid,'\u5C0F\u65F6\u699C-'+Ne.area_v2_parent_name+'\u533A')}catch(Ne){he=!0,Ce=Ne}finally{try{!xe&&ye.return&&ye.return()}finally{if(he)throw Ce}}})},me=setInterval(function(){Te<=Ie.length-1?(fe(Te),Te++):clearInterval(me)},1e3)};setTimeout(ce,6e3);var pe=setInterval(ce,parseInt(1e3*_e.CONFIG.CHECK_HOUR_ROOM_INTERVAL))}var ue=function reset(ce){var pe=setTimeout(function(){if(0<_e.raffleId_list.length||0<_e.guardId_list.length||0<_e.pkId_list.length)return Q('[\u5237\u65B0\u76F4\u64AD\u95F4]','\u8FD8\u6709\u793C\u7269\u6CA1\u62BD\uFF0C\u5EF6\u8FDF15s\u540E\u5237\u65B0\u76F4\u64AD\u95F4'),void ue(15000);if(le(_e.CACHE.LittleHeart_TS))return Q('[\u5237\u65B0\u76F4\u64AD\u95F4]','\u6B63\u5728\u83B7\u53D6\u5C0F\u5FC3\u5FC3\uFF0C10\u5206\u949F\u540E\u518D\u6B21\u68C0\u67E5'),clearTimeout(pe),void ue(6e5);if(f(_e.CONFIG.TIME_AREA_START_H0UR,_e.CONFIG.TIME_AREA_END_H0UR,_e.CONFIG.TIME_AREA_START_MINUTE,_e.CONFIG.TIME_AREA_END_MINUTE)&&_e.CONFIG.IN_TIME_RELOAD_DISABLE){var Ie=_(_e.CONFIG.TIME_AREA_START_MINUTE,_e.CONFIG.TIME_AREA_END_MINUTE)+6e4;return ue(Ie),void Q('[\u5237\u65B0\u76F4\u64AD\u95F4]','\u5904\u4E8E\u4F11\u7720\u65F6\u95F4\u6BB5\uFF0C\u5C06\u5728'+Ie+'\u6BEB\u79D2\u540E\u5237\u65B0\u76F4\u64AD\u95F4')}window.location.reload()},ce)};ue(6e4*_e.CONFIG.TIME_RELOAD)}function _(_e,ge){var ue=new Date,ce=ue.getHours(),pe=ue.getMinutes(),Ie=ue.getSeconds(),me=1e3*(3600*_e)+1e3*(60*ge)-(1e3*(3600*ce)+1e3*(60*pe)+1e3*Ie),Ee=new Date(me);return Q('[getIntervalTime]\u83B7\u53D6\u95F4\u9694\u65F6\u95F4',Ee.getHours()+'\u65F6'+Ee.getMinutes()+'\u5206'),0>me?86400000+me:me}function I(_e){if(_e!=void 0){var ge=!0,ue=!1,ce=void 0;try{for(var Ie,Te,pe=_e[Symbol.iterator]();!(ge=(Ie=pe.next()).done);ge=!0)Te=Ie.value,layer.close(Te)}catch(Te){ue=!0,ce=Te}finally{try{!ge&&pe.return&&pe.return()}finally{if(ue)throw ce}}}}function T(_e,ge){var ue=new Date,ce=ue.getHours(),pe=ue.getMinutes();return ce==_e&&pe==ge||(Q('isTime \u9519\u8BEF\u65F6\u95F4','\u76EE\u6807\u65F6\u95F4'+_e+'\u65F6'+ge+'\u5206\uFF0C\u5F53\u524D\u65F6\u95F4'+ce+'\u65F6'+pe+'\u5206'),!1)}function f(_e,ge,ue,ce){if(23<_e||24<ge||0>_e||1>ge||59<ue||0>ue||59<ce||0>ce)return!1;var pe=new Date,Ie=pe.getHours(),Te=pe.getMinutes();if(_e<ge)return Ie>=_e&&Ie<ge||Ie==ge&&Te>=ue&&Te<ce;return _e>ge?Ie>=_e||Ie<ge||Ie==ge&&Te>=ue&&Te<ce:_e==ge?Ie==_e&&ue<=ce&&Te>=ue&&Te<ce||Ie==_e&&ue>ce&&Te<=ce&&Te>ue:void 0}function E(_e){return new Promise(function(ge){setTimeout(function(){ge()},_e)})}function O(_e){if(0>=_e)return!1;var ge=Math.random();return _e/100>=ge}function C(_e){return new Promise(function(ge){var ue=function onerror(ce){console.error(GM_info.script.name,ce),ge(void 0)};if(_e.GM)'POST'===_e.method&&(void 0===_e.headers&&(_e.headers={}),void 0===_e.headers['Content-Type']&&(_e.headers['Content-Type']='application/x-www-form-urlencoded; charset=utf-8')),_e.timeout=30000,_e.onload=function(ce){return ge({response:ce,body:ce.response})},_e.onerror=ue,_e.ontimeout=ue,GM_xmlhttpRequest(_e);else{var ce=new XMLHttpRequest;ce.open(_e.method,_e.url),'POST'===_e.method&&null===ce.getResponseHeader('Content-Type')&&ce.setRequestHeader('Content-Type','application/x-www-form-urlencoded; charset=utf-8'),_e.cookie&&(ce.withCredentials=!0),_e.responseType!==void 0&&(ce.responseType=_e.responseType),ce.timeout=30000,ce.onload=function(pe){var Ie=pe.target;ge({response:Ie,body:Ie.response})},ce.onerror=ue,ce.ontimeout=ue,ce.send(_e.data)}})}ne.init(),$(function(){var _e=function loadInfo(ge){setTimeout(_asyncToGenerator(regeneratorRuntime.mark(function ue(){var ce;return regeneratorRuntime.wrap(function(Ie){for(;;)switch(Ie.prev=Ie.next){case 0:if(ce='undefined'==typeof unsafeWindow?window:unsafeWindow,!(void 0===ce.BilibiliLive||0===parseInt(ce.BilibiliLive.UID)||isNaN(parseInt(ce.BilibiliLive.UID)))){Ie.next=7;break}_e(1e3),window.toast('['+GM_info.script.name+']\u65E0\u914D\u7F6E\u4FE1\u606F','warning'),Q('\u65E0\u914D\u7F6E\u4FE1\u606F'),Ie.next=20;break;case 7:return H.room_id=ce.BilibiliLive.ROOMID,H.uid=ce.BilibiliLive.UID,H.tid=ce.BilibiliLive.ANCHOR_UID,Ie.next=12,D.live_user.get_info_in_room(H.room_id).then(function(Te){Q('InitData: API.live_user.get_info_in_room',Te),H.mobile_verify=Te.data.info.mobile_verify,H.identification=Te.data.info.identification});case 12:return Ie.next=14,D.gift.gift_config().then(function(Te){Q('InitData: API.gift.gift_config',Te),!!Te.data&&$.isArray(Te.data)?H.gift_list=Te.data:!!Te.data.list&&$.isArray(Te.data.list)?H.gift_list=Te.data.list:(H.gift_list=[{id:6,price:1000},{id:1,price:100},{id:30607,price:5000}],window.toast('\u76F4\u64AD\u95F4\u793C\u7269\u6570\u636E\u83B7\u53D6\u5931\u8D25\uFF0C\u4F7F\u7528\u5907\u7528\u6570\u636E','error'))});case 14:H.bili_jct=D.getCookie('bili_jct'),H.ruid=ce.BilibiliLive.ANCHOR_UID,H.rnd=ce.BilibiliLive.RND,H.visit_id=ce.__statisObserver?ce.__statisObserver.__visitId:'',Q('Live_info',H),o();case 20:case'end':return Ie.stop();}},ue,G)})),ge)};_e(1e3),se()}),Array.prototype.remove=function(_e){var ge=this.indexOf(_e);-1<ge&&this.splice(ge,1)};var se=function addStyle(){$('head').append('\n        <style>\n            .igiftMsg_input{\n                outline: none;\n                border: 1px solid #e9eaec;\n                background-color: #fff;\n                border-radius: 4px;\n                padding: 1px 0 0;\n                overflow: hidden;\n                font-size: 12px;\n                line-height: 19px;\n                width: 30px;\n                z-index: \'10001\';\n            }\n            .igiftMsg_btn{\n                background-color: #23ade5;\n                color: #fff;\n                border-radius: 4px;\n                border: none;\n                padding: 5px;\n                cursor: pointer;\n                box-shadow: 0 0 2px #00000075;\n                line-height: 10px;\n                z-index: 10001;\n            }\n            .igiftMsg_fs{\n                border: 2px solid #d4d4d4;\n                z-index: 10001;\n            }\n        </style>\n        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/sentsin/layer@v3.1.1/dist/theme/default/layer.css" id="layuicss-layer">\n            ')};var de=function dateNow(){return Date.now()},le=function checkNewDay(_e){if(0===_e)return!0;var ge=new Date(_e),ue=new Date,ce=ge.getDate(),pe=ue.getDate();return pe!==ce}})();