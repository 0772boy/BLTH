// ==UserScript==
// @namespace     https://github.com/andywang425
// @name          B站直播自动抢辣条
// @name:en       B站直播自动抢辣条
// @author        andywang425
// @description   自动参与Bilibili直播区广播礼物，小时榜房间礼物，广播节奏风暴抽奖;完成每日任务
// @description:en 自动参与Bilibili直播区广播礼物，小时榜房间礼物，广播节奏风暴抽奖;完成每日任务
// @updateURL     https://github.com.cnpmjs.org/andywang425/Bilibili-SGTH/raw/master/B%E7%AB%99%E7%9B%B4%E6%92%AD%E8%87%AA%E5%8A%A8%E6%8A%A2%E8%BE%A3%E6%9D%A1.user.js
// @downloadURL    https://github.com.cnpmjs.org/andywang425/Bilibili-SGTH/raw/master/B%E7%AB%99%E7%9B%B4%E6%92%AD%E8%87%AA%E5%8A%A8%E6%8A%A2%E8%BE%A3%E6%9D%A1.user.js
// @homepageURL   https://github.com/andywang425/Bilibili-SGTH/
// @supportURL    https://github.com/andywang425/Bilibili-SGTH/issues
// @icon          https://s1.hdslb.com/bfs/live/d57afb7c5596359970eb430655c6aef501a268ab.png
// @copyright     2020, andywang425 (https://github.com/andywang425)
// @license       MIT
// @version       3.5
// @include      /https?:\/\/live\.bilibili\.com\/[blanc\/]?[^?]*?\d+\??.*/
// @run-at       document-end
// @connect     passport.bilibili.com
// @connect     api.live.bilibili.com
// @require      https://cdn.jsdelivr.net/gh/jquery/jquery@3.2.1/dist/jquery.min.js
// @require      https://cdn.jsdelivr.net/gh/andywang425/Bilibili-SGTH@v1.3.2/BilibiliAPI_Mod.min.js
// @require      https://cdn.jsdelivr.net/gh/andywang425/Bilibili-SGTH@v1.3.2/OCRAD.min.js
// @require      https://cdn.jsdelivr.net/gh/andywang425/Bilibili-SGTH@v1.3.2/libBilibiliToken.user.js
// @grant       GM_getValue
// @grant       GM_setValue
// @grant       GM_xmlhttpRequest
// ==/UserScript==
/*
B站直播自动抢辣条.user.js的几个其它源(若想给库换源请按格式修改):
[jsdelivr]（大约要一天时间才能同步）
https://cdn.jsdelivr.net/gh/andywang425/Bilibili-SGTH/B%E7%AB%99%E7%9B%B4%E6%92%AD%E8%87%AA%E5%8A%A8%E6%8A%A2%E8%BE%A3%E6%9D%A1.user.js
[gitcdn]
https://gitcdn.xyz/repo/andywang425/Bilibili-SGTH/master/B%E7%AB%99%E7%9B%B4%E6%92%AD%E8%87%AA%E5%8A%A8%E6%8A%A2%E8%BE%A3%E6%9D%A1.user.js
[cnpmjs]
https://github.com.cnpmjs.org/andywang425/Bilibili-SGTH/raw/master/B%E7%AB%99%E7%9B%B4%E6%92%AD%E8%87%AA%E5%8A%A8%E6%8A%A2%E8%BE%A3%E6%9D%A1.user.js
[fastgit]
https://hub.fastgit.org/andywang425/Bilibili-SGTH/raw/master/B%E7%AB%99%E7%9B%B4%E6%92%AD%E8%87%AA%E5%8A%A8%E6%8A%A2%E8%BE%A3%E6%9D%A1.user.js
*/
"use strict";function _asyncToGenerator(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function n(i,a){try{var o=t[i](a),s=o.value}catch(e){return void r(e)}if(!o.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}return n("next")})}}!function(){function t(){$("head").append("\n        <style>\n            .igiftMsg_input{\n                outline: none;\n                border: 1px solid #e9eaec;\n                background-color: #fff;\n                border-radius: 4px;\n                padding: 1px 0 0;\n                overflow: hidden;\n                font-size: 12px;\n                line-height: 19px;\n                width: 30px;\n                'z-index': '10001';\n            }\n            .igiftMsg_btn{\n                background-color: #23ade5;\n                color: #fff;\n                border-radius: 4px;\n                border: none;\n                padding: 5px;\n                cursor: pointer;\n                box-shadow: 0 0 2px #00000075;\n                line-height: 10px;\n                'z-index': '10001';\n            }\n            .igiftMsg_fs{\n                border: 2px solid #d4d4d4;\n                'z-index': '10001';\n            }\n        </style>\n            ")}function r(){var t=this,r={CONFIG_DEFAULT:{TIME_RELOAD:60,RANDOM_DELAY:!0,RND_DELAY_START:2,RND_DELAY_END:5,TIME_AREA_DISABLE:!0,TIME_AREA_START_H0UR:2,TIME_AREA_END_H0UR:8,TIME_AREA_START_MINUTE:0,TIME_AREA_END_MINUTE:0,RANDOM_SKIP:0,MAX_GIFT:99999,IN_TIME_RELOAD_DISABLE:!1,RANDOM_SEND_DANMU:0,CHECK_HOUR_ROOM_INTERVAL:120,AUTO_GROUP_SIGN:!0,LIVE_SIGN:!0,FORCE_LOTTERY:!1,LOGIN:!0,WATCH:!0,COIN:!1,COIN_NUMBER:0,SHARE:!0,AUTO_TREASUREBOX:!0,SILVER2COIN:!1,AUTO_GIFT:!1,GIFT_SEND_HOUR:23,GIFT_SEND_MINUTE:59,GIFT_SORT:!1,AUTO_GIFT_ROOMID:"0",GIFT_LIMIT:86400,SEND_ALL_GIFT:!1,SPARE_GIFT_ROOM:"0",SPARE_GIFT_UID:"0",MOBILE_HEARTBEAT:!0,STORM:!1,STORM_QUEUE_SIZE:3,STORM_MAX_COUNT:100,STORM_ONE_LIMIT:200},CACHE_DEFAULT:{UNIQUE_CHECK:0,AUTO_GROUP_SIGH_TS:0,DailyReward_TS:0,LiveReward_TS:0,TreasureBox_TS:0,Silver2Coin_TS:0,Gift_TS:0,MobileHeartBeat_TS:0},CONFIG:{},CACHE:{},GIFT_COUNT:{COUNT:0,SILVER_COUNT:0,CLEAR_TS:0},init:function(){try{_.setCommonArgs(_.getCookie("bili_jct"))}catch(e){return void console.error("["+f+"]",e)}var t=$.Deferred();try{r.loadConfig().then(function(){r.chatLog("脚本载入配置成功","success"),t.resolve()})}catch(e){console.error("API初始化出错",e),r.chatLog("API初始化出错","error"),t.reject()}try{r.loadCache().then(function(){window.toast("CACHE载入成功","success"),t.resolve()})}catch(e){console.error("CACHE初始化出错",e),window.toast("CACHE初始化出错","error"),t.reject()}return M().then(function(r){"OK"==r?(window.toast("APPtoken载入成功","success"),t.resolve()):(console.error("APPtoken初始化出错",e),window.toast("APPtoken初始化出错","error"),t.reject())}),setTimeout(function(){r.TreasureBox.init()},5750),t},loadConfig:function(){var e=$.Deferred();try{var t=JSON.parse(localStorage.getItem(f+"_CONFIG"));$.extend(!0,r.CONFIG,r.CONFIG_DEFAULT);for(var n in r.CONFIG)r.CONFIG.hasOwnProperty(n)&&void 0!==t[n]&&null!==t[n]&&(r.CONFIG[n]=t[n]);r.loadGiftCount(),e.resolve()}catch(t){A("API载入配置失败，加载默认配置",t),r.setDefaults(),e.reject()}return e},loadCache:function(){var e=$.Deferred();try{var t=JSON.parse(localStorage.getItem(f+"_CACHE"));$.extend(!0,r.CACHE,r.CACHE_DEFAULT);for(var n in r.CACHE)r.CACHE.hasOwnProperty(n)&&void 0!==t[n]&&null!==t[n]&&(r.CACHE[n]=t[n]);e.resolve()}catch(t){A("CACHE载入配置失败，加载默认配置",t),r.setDefaults(),e.reject()}return e},saveConfig:function(){try{return localStorage.setItem(f+"_CONFIG",JSON.stringify(r.CONFIG)),r.chatLog("配置已保存"),A("MY_API.CONFIG",r.CONFIG),!0}catch(e){return A("API保存出错",e),!1}},saveCache:function(e){try{return localStorage.setItem(f+"_CACHE",JSON.stringify(r.CACHE)),0!=e&&A("CACHE已保存",r.CACHE),!0}catch(e){return A("CACHE保存出错",e),!1}},setDefaults:function(){r.CONFIG=r.CONFIG_DEFAULT,r.CACHE=r.CACHE_DEFAULT,r.saveConfig(),r.saveCache(),r.chatLog("配置和CACHE已重置为默认。3秒后刷新页面"),setTimeout(function(){window.location.reload()},3e3)},ReDoDailyTasks:function(){window.toast("3秒后再次执行每日任务","info"),setTimeout(function(){r.CACHE=r.CACHE_DEFAULT,r.GroupSign.run(),r.DailyReward.run(),r.LiveReward.run(),r.Exchange.runS2C(),r.TreasureBox.run(),r.Gift.run(),r.MobileHeartBeat.run()},3e3)},loadGiftCount:function(){try{var e=JSON.parse(localStorage.getItem(f+"_GIFT_COUNT"));for(var t in r.GIFT_COUNT)r.GIFT_COUNT.hasOwnProperty(t)&&void 0!==e[t]&&null!==e[t]&&(r.GIFT_COUNT[t]=e[t]);A("MY_API.GIFT_COUNT",r.GIFT_COUNT)}catch(e){A("读取统计失败",e)}},saveGiftCount:function(){try{return localStorage.setItem(f+"_GIFT_COUNT",JSON.stringify(r.GIFT_COUNT)),A("统计保存成功",r.GIFT_COUNT),!0}catch(e){return A("统计保存出错",e),!1}},addGift:function(e){r.GIFT_COUNT.COUNT+=e,$("#giftCount span:eq(0)").text(r.GIFT_COUNT.COUNT),r.saveGiftCount()},addSilver:function(e){r.GIFT_COUNT.SILVER_COUNT+=10*e,$("#giftCount span:eq(2)").text(r.GIFT_COUNT.SILVER_COUNT),r.saveGiftCount()},checkUpdate:function(){window.open("https://github.com/andywang425/Bilibili-SGTH/raw/master/B%E7%AB%99%E7%9B%B4%E6%92%AD%E8%87%AA%E5%8A%A8%E6%8A%A2%E8%BE%A3%E6%9D%A1.user.js","_blank").location},removeUnnecessary:function(){var e=["#my-dear-haruna-vm",".june-activity-entry"],t=!0,r=!1,n=void 0;try{for(var i,a=e[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value;$(o).remove()}}catch(e){r=!0,n=e}finally{try{!t&&a.return&&a.return()}finally{if(r)throw n}}},creatSetBox:function(){var e=$('<button style="display: inline-block; float: left; margin-right: 7px;background-color: #23ade5;color: #fff;border-radius: 4px;border: none; padding:4px; cursor: pointer;box-shadow: 1px 1px 2px #00000075;" id="hiderbtn">隐藏窗口和抽奖信息<br></button>');e.click(function(){if(0==u){u=!0,$(".igiftMsg").hide(),t.hide();var e=$(".chat-history-list");e.animate({scrollTop:0},0),setTimeout(function(){e.animate({scrollTop:e.prop("scrollHeight")},10)},100),document.getElementById("hiderbtn").innerHTML="显示窗口和抽奖信息"}else{u=!1,$(".igiftMsg").show(),t.show();var r=$(".chat-history-list");r.animate({scrollTop:r.prop("scrollHeight")},0),document.getElementById("hiderbtn").innerHTML="隐藏窗口和抽奖信息"}}),$(".attention-btn-ctnr").append(e);var t=$("<div>"),n=$(".live-player-mounter").height();t.css({width:"auto",height:n,position:"absolute",top:"-2px",right:"0px",background:"#F0F0F0",padding:"10px","z-index":"10001","border-radius":"4px",overflow:"scroll","line-height":"15px"}),t.append('\n                <div id=\'allsettings\'>\n                <fieldset class="igiftMsg_fs">\n                    <legend style="color: black">今日统计</legend>\n                    <div id="giftCount" style="font-size: large; text-shadow: 1px 1px #00000066; color: blueviolet;">\n                        辣条&nbsp;<span>'+r.GIFT_COUNT.COUNT+"</span>\n                        银瓜子&nbsp;<span>"+r.GIFT_COUNT.SILVER_COUNT+'万</span>\n                        <button style="font-size: small" class="igiftMsg_btn" data-action="save">保存所有设置</button>\n                    </div>\n                </fieldset>\n                <div id="left_fieldset" style="float:left;">\n                    <fieldset class="igiftMsg_fs">\n                        <legend style="color: black">低调设置</legend>\n                        <div data-toggle="RANDOM_DELAY">\n                            <label style="cursor: pointer; margin: 5px auto; color: darkgreen">\n                                <input style="vertical-align: text-top;" type="checkbox">抽奖附加随机延迟\n                                <input class="RND_DELAY_START igiftMsg_input" style="width: 30px;vertical-align: top;" type="text">~\n                                <input class="RND_DELAY_END igiftMsg_input" style="width: 30px;vertical-align: top;" type="text">s\n                            </label>\n                        </div>\n                        <div data-toggle="TIME_AREA_DISABLE">\n                            <label style="cursor: pointer; margin: 5px auto; color: darkgreen">\n                                <input style="vertical-align: text-top;" type="checkbox">启用\n                                <input class="startHour igiftMsg_input" style="width: 20px;" type="text">点\n                                <input class="startMinute igiftMsg_input" style="width: 20px;" type="text">分至\n                                <input class="endHour igiftMsg_input" style="width: 20px;" type="text">点\n                                <input class="endMinute igiftMsg_input" style="width: 20px;" type="text">分不抽奖(24小时制)\n                            </label>\n                        </div>\n                        <div data-toggle="RANDOM_SKIP">\n                            <label style="cursor: pointer; margin: 5px auto; color: darkgreen">\n                                随机跳过礼物(0到100,为0则不跳过)<input class="per igiftMsg_input" style="width: 30px;" type="text">%\n                            </label>\n                        </div>\n                        <div data-toggle="MAX_GIFT">\n                            <label style="cursor: pointer; margin: 5px auto; color: darkgreen">\n                                当天最多抢辣条数量<input class="num igiftMsg_input" style="width: 100px;" type="text">\n                            </label>\n                        </div>\n                        <div data-toggle="RANDOM_SEND_DANMU">\n                            <label style="cursor: pointer; margin: 5px auto; color: darkgreen">\n                                抽奖时活跃弹幕发送概率(0到5,为0则不发送)<input class="per igiftMsg_input" style="width: 30px;" type="text">%\n                            </label>\n                        </div>\n                        <div data-toggle="CHECK_HOUR_ROOM_INTERVAL">\n                            <label style="cursor: pointer; margin: 5px auto; color: darkgreen">\n                                检查小时榜间隔时间<input class="num igiftMsg_input" style="width: 25px;" type="text">秒\n                            </label>\n                        </div>\n            \n                    </fieldset>\n            \n                    <fieldset class="igiftMsg_fs">\n                        <legend style="color: black">每日任务设置</legend>\n                        <div data-toggle="LOGIN" style=" color: black">\n                            <input style="vertical-align: text-top;" type="checkbox">\n                            登陆\n                        </div>\n                        <div data-toggle="WATCH" style=" color: black">\n                            <input style="vertical-align: text-top;" type="checkbox">\n                            观看视频\n                        </div>\n                        <div data-toggle="COIN" style=" color: black">\n                            <label style="cursor: pointer">\n                                <input style="cursor: pointer; vertical-align: text-top;" type="checkbox">\n                                自动投币<input class="coin_number igiftMsg_input" style="width: 40px;" type="text">个\n                            </label>\n                        </div>\n                        <div data-toggle="SHARE" style=" color: black">\n                            <input style="vertical-align: text-top;" type="checkbox">\n                            分享视频\n                        </div>\n                        <div data-toggle="SILVER2COIN" style=" color: black">\n                            <input style="vertical-align: text-top;" type="checkbox">\n                            银瓜子换硬币\n                        </div>\n                        <div data-toggle="LIVE_SIGN" style=" color: black">\n                            <input style="vertical-align: text-top;" type="checkbox">\n                            直播区签到\n                        </div>\n                        <div data-toggle="AUTO_GROUP_SIGN" style=" color: darkgreen">\n                            <input style="vertical-align: text-top;" type="checkbox">\n                            应援团签到\n                        </div>\n                        <div data-toggle="MOBILE_HEARTBEAT" style=" color: purple">\n                            <input style="vertical-align: text-top;" type="checkbox">\n                            模拟移动端心跳 + 领双端观看直播奖励\n                        </div>\n                        <div data-toggle="AUTO_TREASUREBOX" style=" color: purple">\n                            <input style="vertical-align: text-top;" type="checkbox">\n                            自动领银瓜子宝箱\n                        </div>\n                    </fieldset>\n                    <fieldset class="igiftMsg_fs">\n                        <legend style="color: black">自动送礼设置</legend>\n                        <div data-toggle="AUTO_GIFT" style=" color: purple">\n                            <input style="vertical-align: text-top;" type="checkbox">\n                            自动送礼\n                        </div>\n            \n                        <div data-toggle="AUTO_GIFT_ROOMID" style=" color: purple">\n                            优先送礼房间\n                            <input class="num igiftMsg_input" style="width: 150px;" type="text">\n                        </div>\n            \n                        <div data-toggle="GIFT_SEND_TIME" style=" color: purple">\n                            送礼时间\n                            <input class="Hour igiftMsg_input" style="width: 20px;" type="text">点\n                            <input class="Minute igiftMsg_input" style="width: 20px;" type="text">分\n                            <button style="font-size: small" class="igiftMsg_btn" data-action="sendGiftNow">立刻开始送礼</button>\n                        </div>\n                        <div data-toggle="GIFT_LIMIT" style=" color: purple">\n                            礼物到期时间\n                            <input class="num igiftMsg_input" style="width: 100px;" type="text">\n                            秒\n                        </div>\n                        <div data-toggle="GIFT_SORT" style=" color: purple">\n                            <input style="vertical-align: text-top;" type="checkbox">\n                            送礼优先高等级粉丝牌\n                        </div>\n                        <div data-toggle="SEND_ALL_GIFT" style=" color: purple">\n                            <input style="vertical-align: text-top;" type="checkbox">\n                            送满全部勋章\n                        </div>\n                        <div data-toggle="SPARE_GIFT_ROOM" style=" color: black">\n                            剩余礼物送礼直播间：\n                            <input class="num igiftMsg_input" type="text" style="width: 100px;">\n                        </div>\n                        <div data-toggle="SPARE_GIFT_UID" style=" color: black">\n                            剩余礼物送礼直播间拥有者UID：\n                            <input class="num igiftMsg_input" type="text" style="width: 100px;">\n                        </div>\n                    </fieldset>\n                    <fieldset class="igiftMsg_fs">\n                        <legend style="color: black">节奏风暴设置</legend>\n                        <div data-toggle="STORM" style="line-height: 15px">\n                            <label style="margin: 5px auto; color: #ff5200">\n                                <input style="vertical-align: text-top;" type="checkbox">参与节奏风暴\n                            </label>\n                        </div>\n                        <div data-toggle="STORM_QUEUE_SIZE" style="color: black">\n                            允许同时参与的节奏风暴次数：\n                            <input class="num igiftMsg_input" type="text" style="width: 30px;">\n                        </div>\n                        <div data-toggle="STORM_MAX_COUNT" style="color: black">\n                            单个风暴最大尝试次数：\n                            <input class="num igiftMsg_input" type="text" style="width: 30px;">\n                        </div>\n                        <div data-toggle="STORM_ONE_LIMIT" style="color: black">\n                            单个风暴参与次数间隔：\n                            <input class="num igiftMsg_input" type="text" style="width: 30px;">\n                            毫秒\n                        </div>\n                    </fieldset>\n                </div>\n            \n            \n            \n                <div id="right_fieldset" style="float:left;">\n                    <fieldset class="igiftMsg_fs">\n                        <legend style="color: black">说明</legend>\n                        自动送礼目前只会送出辣条和亿圆。<br>\n                        礼物到期时间: 将要在这个时间段里过期的礼物会被送出<br>\n                        勾选送满全部勋章时无论是否将要过期都会被送出<br>\n                        如果要填写多个优先送礼房间，<br>\n                        每个房间号之间需用半角逗号,隔开。<br>\n                        如 666,777,888。为0则不送。<br>\n                        如果没有这些房间的粉丝牌也不送。<br>\n                        无论【优先高等级粉丝牌】如何设置，会根据【送满全部勋章】<br>\n                        （勾选则补满，否则只送到期的）条件去按优先送礼房间先后顺序送礼。<br>\n                        之后根据【优先高等级粉丝牌】决定先送高级还是低级（勾选先高级，不勾选先低级）。<br>\n                        剩余礼物:指送完了所有粉丝牌，但仍有剩余的将在1天内过期的礼物。<br>\n                        剩余礼物也会在指定送礼时间被送出。<br>\n                        参与节奏风暴风险较大，如果没有实名可能无法参加。<br>\n                        脚本仅能参加广播中的节奏风暴。\n            \n                    </fieldset>\n                    <fieldset class="igiftMsg_fs" style="line-height: 15px">\n                        <legend style="color: black">其他设置</legend>\n                        <div data-toggle="TIME_RELOAD" style="color: black">\n                            本直播间刷新时间：\n                            <input class="delay-seconds igiftMsg_input" type="text" style="width: 30px;">分\n                        </div>\n                        <div data-toggle="IN_TIME_RELOAD_DISABLE" style="line-height: 15px">\n                            <label style="margin: 5px auto; color: darkgreen">\n                                <input style="vertical-align: text-top;" type="checkbox">不抽奖时段不重载直播间\n                            </label>\n                        </div>\n                        <div data-toggle="FORCE_LOTTERY" style="line-height: 20px">\n                            <label style="margin: 5px auto; color: red;">\n                                <input style="vertical-align: text-top;" type="checkbox">访问被拒绝后强制重复抽奖(最多5次)\n                            </label>\n                        </div>\n                        <div id="resetArea">\n                            <button data-action="reset" style="color: red;" class="igiftMsg_btn">重置所有为默认</button>\n                            <button data-action="redo_dailyTasks" style="color: red;" class="igiftMsg_btn">再次执行每日任务</button>\n                            <button style="font-size: small" class="igiftMsg_btn" data-action="countReset">重置统计</button>\n                            <button style="font-size: small; color: green;" class="igiftMsg_btn"\n                                data-action="checkUpdate">检查更新</button>\n                        </div>\n            \n                    </fieldset>\n                    <label style="color: darkblue; font-size:large;">\n                        v3.5 <a href="https://github.com/andywang425/Bilibili-SGTH/" target="_blank">更多说明和更新日志见github上的项目说明(点我)</a>\n                    </label>\n                </div>\n            </div>\n    '),$(".live-player-mounter").append(t),t.find('div[data-toggle="STORM_MAX_COUNT"] .num').val(parseInt(r.CONFIG.STORM_MAX_COUNT).toString()),t.find('div[data-toggle="STORM_ONE_LIMIT"] .num').val(parseInt(r.CONFIG.STORM_ONE_LIMIT).toString()),t.find('div[data-toggle="STORM_QUEUE_SIZE"] .num').val(parseInt(r.CONFIG.STORM_QUEUE_SIZE).toString()),t.find('div[data-toggle="SPARE_GIFT_UID"] .num').val(r.CONFIG.SPARE_GIFT_UID.toString()),t.find('div[data-toggle="SPARE_GIFT_ROOM"] .num').val(r.CONFIG.SPARE_GIFT_ROOM.toString()),t.find('div[data-toggle="TIME_RELOAD"] .delay-seconds').val(parseInt(r.CONFIG.TIME_RELOAD).toString()),t.find('div[data-toggle="RANDOM_SKIP"] .per').val(parseFloat(r.CONFIG.RANDOM_SKIP).toString()),t.find('div[data-toggle="RANDOM_SEND_DANMU"] .per').val(parseFloat(r.CONFIG.RANDOM_SEND_DANMU).toString()),t.find('div[data-toggle="MAX_GIFT"] .num').val(parseInt(r.CONFIG.MAX_GIFT).toString()),t.find('div[data-toggle="COIN"] .coin_number').val(parseInt(r.CONFIG.COIN_NUMBER).toString()),t.find('div[data-toggle="RANDOM_DELAY"] .RND_DELAY_START').val(parseFloat(r.CONFIG.RND_DELAY_START).toString()),t.find('div[data-toggle="RANDOM_DELAY"] .RND_DELAY_END').val(parseFloat(r.CONFIG.RND_DELAY_END).toString()),t.find('div[data-toggle="TIME_AREA_DISABLE"] .startHour').val(parseInt(r.CONFIG.TIME_AREA_START_H0UR).toString()),t.find('div[data-toggle="TIME_AREA_DISABLE"] .endHour').val(parseInt(r.CONFIG.TIME_AREA_END_H0UR).toString()),t.find('div[data-toggle="TIME_AREA_DISABLE"] .startMinute').val(parseInt(r.CONFIG.TIME_AREA_START_MINUTE).toString()),t.find('div[data-toggle="TIME_AREA_DISABLE"] .endMinute').val(parseInt(r.CONFIG.TIME_AREA_END_MINUTE).toString()),t.find('div[data-toggle="CHECK_HOUR_ROOM_INTERVAL"] .num').val(parseInt(r.CONFIG.CHECK_HOUR_ROOM_INTERVAL).toString()),t.find('div[data-toggle="AUTO_GIFT_ROOMID"] .num').val(r.CONFIG.AUTO_GIFT_ROOMID.toString()),t.find('div[data-toggle="GIFT_SEND_TIME"] .Hour').val(r.CONFIG.GIFT_SEND_HOUR.toString()),t.find('div[data-toggle="GIFT_SEND_TIME"] .Minute').val(r.CONFIG.GIFT_SEND_MINUTE.toString()),t.find('div[data-toggle="GIFT_LIMIT"] .num').val(parseInt(r.CONFIG.GIFT_LIMIT).toString()),t.find('div[id="giftCount"] [data-action="save"]').click(function(){var e=void 0,n=void 0,i=r.CONFIG.TIME_AREA_START_H0UR=parseInt(t.find('div[data-toggle="TIME_AREA_DISABLE"] .startHour').val()),a=r.CONFIG.TIME_AREA_END_H0UR=parseInt(t.find('div[data-toggle="TIME_AREA_DISABLE"] .endHour').val()),o=r.CONFIG.TIME_AREA_START_MINUTE=parseInt(t.find('div[data-toggle="TIME_AREA_DISABLE"] .startMinute').val()),s=r.CONFIG.TIME_AREA_END_MINUTE=parseInt(t.find('div[data-toggle="TIME_AREA_DISABLE"] .endMinute').val());if(i<0||a<0||o<0||s<0)return void r.chatLog("[定时休眠]数据小于0","warning");if(i>=24||a>=24||o>=60||s>=60)return void r.chatLog("[定时休眠]时间错误","warning");if(r.CONFIG.TIME_AREA_START_H0UR=i,r.CONFIG.TIME_AREA_END_H0UR=a,r.CONFIG.TIME_AREA_START_MINUTE=o,r.CONFIG.TIME_AREA_END_MINUTE=s,(e=parseFloat(t.find('div[data-toggle="RANDOM_SKIP"] .per').val()))<0||e>100)return void r.chatLog("[随机跳过礼物]数据小于0或大于100","warning");if(r.CONFIG.RANDOM_SKIP=e,(e=parseFloat(t.find('div[data-toggle="RANDOM_SEND_DANMU"] .per').val()))>5)return void r.chatLog("[活跃弹幕]为维护直播间弹幕氛围,弹幕发送概率不得大于5%","warning");if(e<0)return void r.chatLog("[活跃弹幕]数据小于0","warning");if(r.CONFIG.RANDOM_SEND_DANMU=e,e=parseInt(t.find('div[data-toggle="MAX_GIFT"] .num').val()),r.CONFIG.MAX_GIFT=e,(e=parseInt(t.find('div[data-toggle="TIME_RELOAD"] .delay-seconds').val()))<=0||e>1e4)return void r.chatLog("[直播间重载时间]数据小于等于0或大于10000","warning");if(r.CONFIG.TIME_RELOAD=e,e=parseFloat(t.find('div[data-toggle="RANDOM_DELAY"] .RND_DELAY_START').val()),a=parseFloat(t.find('div[data-toggle="RANDOM_DELAY"] .RND_DELAY_END').val()),e<0||a>100)return void r.chatLog("[抽奖延时]数据小于0或大于100","warning");if(a<=e)return void r.chatLog("[抽奖延时]数据大小关系不正确","warning");if(r.CONFIG.RND_DELAY_START=e,r.CONFIG.RND_DELAY_END=a,(e=parseInt(t.find('div[data-toggle="COIN"] .coin_number').val()))<0)return void r.chatLog("[自动投币]数据小于0","warning");if(r.CONFIG.COIN_NUMBER=e,(e=parseInt(t.find('div[data-toggle="CHECK_HOUR_ROOM_INTERVAL"] .num').val()))<=0)return void r.chatLog("[检查小时榜间隔]数据小于等于0","warning");r.CONFIG.CHECK_HOUR_ROOM_INTERVAL=e,e=t.find('div[data-toggle="AUTO_GIFT_ROOMID"] .num').val(),n=e.split(",");for(var d=0;d<n.length;d++)""===n[d]&&(n[d]=0);return e=n.join(","),r.CONFIG.AUTO_GIFT_ROOMID=e,(e=parseInt(t.find('div[data-toggle="GIFT_INTERVAL"] .num').val()))<=0?void r.chatLog("[检查送礼间隔]数据小于等于0","warning"):(r.CONFIG.GIFT_INTERVAL=e,e=parseInt(t.find('div[data-toggle="GIFT_LIMIT"] .num').val()),r.CONFIG.GIFT_LIMIT=e,i=parseInt(t.find('div[data-toggle="GIFT_SEND_TIME"] .Hour').val()),a=parseInt(t.find('div[data-toggle="GIFT_SEND_TIME"] .Minute').val()),i<0||a<0?void r.chatLog("[送礼时间]数据小于0","warning"):i>=24||a>=60?void r.chatLog("[送礼时间]时间错误","warning"):(r.CONFIG.GIFT_SEND_HOUR=i,r.CONFIG.GIFT_SEND_MINUTE=a,e=t.find('div[data-toggle="SPARE_GIFT_ROOM"] .num').val(),r.CONFIG.SPARE_GIFT_ROOM=e,e=t.find('div[data-toggle="SPARE_GIFT_UID"] .num').val(),r.CONFIG.SPARE_GIFT_UID=e,e=parseInt(t.find('div[data-toggle="STORM_QUEUE_SIZE"] .num').val()),r.CONFIG.STORM_QUEUE_SIZE=e,e=parseInt(t.find('div[data-toggle="STORM_MAX_COUNT"] .num').val()),r.CONFIG.STORM_MAX_COUNT=e,e=parseInt(t.find('div[data-toggle="STORM_ONE_LIMIT"] .num').val()),r.CONFIG.STORM_ONE_LIMIT=e,void r.saveConfig()))}),t.find('button[data-action="reset"]').click(function(){r.setDefaults()}),t.find('button[data-action="checkUpdate"]').click(function(){r.checkUpdate()}),t.find('button[data-action="redo_dailyTasks"]').click(function(){r.ReDoDailyTasks()}),t.find('#resetArea [data-action="countReset"]').click(function(){r.GIFT_COUNT={COUNT:0,SILVER_COUNT:0,CLEAR_TS:0},r.saveGiftCount(),$("#giftCount span:eq(0)").text(r.GIFT_COUNT.COUNT),$("#giftCount span:eq(2)").text(r.GIFT_COUNT.SILVER_COUNT),r.chatLog("已重置统计数据")}),t.find('button[data-action="sendGiftNow"]').click(function(){T=!0,r.Gift.run()});var i=["RANDOM_DELAY","TIME_AREA_DISABLE","AUTO_GROUP_SIGN","FORCE_LOTTERY","LOGIN","WATCH","COIN","SHARE","SILVER2COIN","LIVE_SIGN","IN_TIME_RELOAD_DISABLE","AUTO_TREASUREBOX","IN_TIME_RELOAD_DISABLE","AUTO_GIFT","GIFT_SORT","SEND_ALL_GIFT","MOBILE_HEARTBEAT","STORM"],a=!0,o=!1,s=void 0;try{for(var d,c=i[Symbol.iterator]();!(a=(d=c.next()).done);a=!0)!function(){var e=d.value,n=t.find('div[data-toggle="'+e+'"] input:checkbox');r.CONFIG[e]&&n.attr("checked",""),n.change(function(){r.CONFIG[e]=$(this).prop("checked"),r.saveConfig()})}()}catch(e){o=!0,s=e}finally{try{!a&&c.return&&c.return()}finally{if(o)throw s}}},chatLog:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",r=$("<div class='igiftMsg'>"),n=$("<div>"),i=$("#chat-history-list"),a=new Date;switch(n.text(e),r.text(a.toLocaleString()),r.append(n),r.css({"text-align":"center","border-radius":"4px","min-height":"30px",width:"256px",color:"#9585FF","line-height":"30px",padding:"0 10px",margin:"10px auto"}),n.css({"word-wrap":"break-word",width:"100%","line-height":"1em","margin-bottom":"10px"}),t){case"warning":r.css({border:"1px solid rgb(236, 221, 192)",color:"rgb(218, 142, 36)",background:"rgb(245, 235, 221) none repeat scroll 0% 0%"});break;case"success":r.css({border:"1px solid rgba(22, 140, 0, 0.28)",color:"rgb(69, 171, 69)",background:"none 0% 0% repeat scroll rgba(16, 255, 0, 0.18)"});break;case"error":r.css({border:"1px solid rgb(255, 46, 0)",color:"white",background:"none 0% 0% repeat scroll #ff4c4c"});break;default:r.css({border:"1px solid rgb(203, 195, 255)",background:"rgb(233, 230, 255) none repeat scroll 0% 0%"})}0==u&&(i.find("#chat-items").append(r),i.scrollTop(i.prop("scrollHeight")))},blocked:!1,max_blocked:!1,listen:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"本直播间";_.room.getConf(e).then(function(i){g=i.data.host,A("服务器地址",i);var a=new _.DanmuWebSocket(t,e,i.data.host_server_list,i.data.token);a.bind(function(e){a=e,r.chatLog(n+"弹幕服务器连接断开，尝试重连","warning")},function(){r.chatLog("——————连接弹幕服务器成功——————\n房间号: "+e+" 分区: "+n,"success")},function(){(r.blocked||r.stormBlack)&&(a.close(),r.chatLog("进了小黑屋主动与弹幕服务器断开连接-"+n,"warning")),r.max_blocked&&!r.CONFIG.STORM&&(a.close(),r.chatLog("辣条最大值主动与弹幕服务器断开连接-"+n,"warning"))},function(e){if(!s(r.CONFIG.TIME_AREA_START_H0UR,r.CONFIG.TIME_AREA_END_H0UR,r.CONFIG.TIME_AREA_START_MINUTE,r.CONFIG.TIME_AREA_END_MINUTE)||!r.CONFIG.TIME_AREA_DISABLE)switch(A("弹幕公告"+n,e),e.cmd){case"GUARD_MSG":e.roomid===e.real_roomid?r.checkRoom(e.roomid,n):(r.checkRoom(e.roomid,n),r.checkRoom(e.real_roomid,n));break;case"PK_BATTLE_SETTLE_USER":e.data.winner?r.checkRoom(e.data.winner.room_id,n):r.checkRoom(e.data.my_info.room_id,n),r.checkRoom(e.data.winner.room_id,n);break;case"NOTICE_MSG":switch(e.msg_type){case 1:break;case 2:case 3:case 4:case 8:e.roomid===e.real_roomid?r.checkRoom(e.roomid,n):(r.checkRoom(e.roomid,n),r.checkRoom(e.real_roomid,n));break;case 5:break;case 6:window.toast("监控到房间 "+e.roomid+" 的节奏风暴","info"),r.Storm.run(e.roomid)}break;case"SPECIAL_GIFT":if(e.data[39])switch(e.data[39].action){case"start":window.toast("监控到房间 "+e.roomid+" 的节奏风暴","info"),r.Storm.run(e.roomid)}break;default:return}})},function(){r.chatLog("获取弹幕服务器地址错误","error")})},RoomId_list:[],err_roomId:[],auto_danmu_list:["(=・ω・=)","（￣▽￣）","nice","666","kksk","(⌒▽⌒)","(｀・ω・´)","╮(￣▽￣)╭","(￣3￣)","Σ( ￣□￣||)","(^・ω・^ )","_(:3」∠)_"],checkRoom:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"本直播间";r.blocked||r.max_blocked||r.RoomId_list.indexOf(e)>=0||(r.RoomId_list.push(e),_.room.room_entry_action(e),d(r.CONFIG.RANDOM_SEND_DANMU)&&_.sendLiveDanmu(r.auto_danmu_list[Math.floor(12*Math.random())],e).then(function(e){A("弹幕发送返回信息",e)}),_.xlive.lottery.check(e).then(function(n){r.RoomId_list.remove(e),A("检查房间返回信息",n);var i=n.data;if(0===n.code){var a=void 0;if(i.gift){a=i.gift;for(var o in a)a.hasOwnProperty(o)&&r.creat_join(e,a[o],"gift",t)}if(i.guard){a=i.guard;for(var s in a)a.hasOwnProperty(s)&&r.creat_join(e,a[s],"guard",t)}if(i.pk){a=i.pk;for(var d in a)a.hasOwnProperty(d)&&r.creat_join(e,a[d],"pk",t)}}else r.chatLog("[检查房间出错]"+response.msg,"error"),r.err_roomId.indexOf(e)>-1?A("[检查此房间出错多次]"+e+n.message):(r.err_roomId.push(e),r.checkRoom(e,t),A("[检查房间出错_重试一次]"+e+n.message))}))},Id_list_history:{add:function(e,t){var r=[];try{var n=JSON.parse(localStorage.getItem(f+"_"+t+"Id_list"));r=[].concat(n.list),r.push(e),r.length>150&&r.splice(0,50),localStorage.setItem(f+"_"+t+"Id_list",JSON.stringify({list:r})),A(f+"_"+t+"Id_list_add",r)}catch(n){r.push(e),localStorage.setItem(f+"_"+t+"Id_list",JSON.stringify({list:r}))}},isIn:function(e,t){var r=[];try{var n=JSON.parse(localStorage.getItem(f+"_"+t+"Id_list"));return r=null===n?[]:[].concat(n.list),A(f+"_"+t+"Id_list_read",n),r.indexOf(e)>-1}catch(n){return localStorage.setItem(f+"_"+t+"Id_list",JSON.stringify({list:r})),A("读取"+f+"_"+t+"Id_list缓存错误已重置"),r.indexOf(e)>-1}}},raffleId_list:[],guardId_list:[],pkId_list:[],creat_join:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"本直播间";if(A("礼物信息",t),r.GIFT_COUNT.COUNT>=r.CONFIG.MAX_GIFT)return A("超过今日辣条限制，不参与抽奖"),void(r.max_blocked=!0);switch(n){case"gift":if(r.Id_list_history.isIn(t.raffleId,"raffle"))return void A("礼物重复","raffleId "+t.raffleId);r.raffleId_list.push(t.raffleId),r.Id_list_history.add(t.raffleId,"raffle");break;case"guard":if(r.Id_list_history.isIn(t.id,"guard"))return void A("舰长重复","id "+t.id);r.guardId_list.push(t.id),r.Id_list_history.add(t.id,"guard");break;case"pk":if(r.Id_list_history.isIn(t.id,"pk"))return void A("pk重复","id "+t.id);r.pkId_list.push(t.id),r.Id_list_history.add(t.id,"pk")}var a=t.time_wait||0;r.CONFIG.RANDOM_DELAY&&(a+=Math.floor(Math.random()*(r.CONFIG.RND_DELAY_END-r.CONFIG.RND_DELAY_START+1))+r.CONFIG.RND_DELAY_START);var o=$("<div class='igiftMsg'>"),s=$("<div>"),c=$("<div>"),l=$("#chat-history-list"),f=new Date;s.text("["+i+"]"+t.thank_text.split("<%")[1].split("%>")[0]+t.thank_text.split("%>")[1]),o.text(f.toLocaleString()),o.append(s),c.css("color","red"),c.text("等待抽奖"),s.append(c),o.css({"text-align":"center","border-radius":"4px","min-height":"30px",width:"256px",color:"#9585FF","line-height":"30px",padding:"0 10px",margin:"10px auto"}),s.css({"word-wrap":"break-word",width:"100%","line-height":"1em","margin-bottom":"10px"}),o.css({border:"1px solid rgb(203, 195, 255)",background:"rgb(233, 230, 255) none repeat scroll 0% 0%"}),0==u&&(l.find("#chat-items").append(o),l.scrollTop(l.prop("scrollHeight")));var _=setInterval(function(){if(c.text("等待抽奖倒计时"+a+"秒"),a<=0){if(d(r.CONFIG.RANDOM_SKIP))c.text("跳过此礼物抽奖");else switch(c.text("进行抽奖..."),n){case"gift":r.gift_join(e,t.raffleId,t.type).then(function(e,n){c.text(e),
n&&(e.indexOf("辣条")>-1?r.addGift(n):e.indexOf("银瓜子")>-1&&r.addSilver(n)),r.raffleId_list.remove(t.raffleId)});break;case"guard":r.guard_join(e,t.id).then(function(e,n){c.text(e),n&&(e.indexOf("辣条")>-1?r.addGift(n):e.indexOf("银瓜子")>-1&&r.addSilver(n)),r.guardId_list.remove(t.id)});break;case"pk":r.pk_join(e,t.id).then(function(e,n){c.text(e),n&&(e.indexOf("辣条")>-1?r.addGift(n):e.indexOf("银瓜子")>-1&&r.addSilver(n)),r.pkId_list.remove(t.id)})}c.css("color","green"),clearInterval(_)}a--},1e3)},gift_join:function(e,t,n){var i=$.Deferred();return _.Lottery.Gift.join(e,t,n).then(function(a){switch(A("抽奖返回信息",a),a.code){case 0:a.data.award_text?i.resolve(a.data.award_text,a.data.award_num):i.resolve(a.data.award_name+"X"+a.data.award_num.toString(),a.data.award_num);break;default:a.msg.indexOf("拒绝")>-1?0==r.CONFIG.FORCE_LOTTERY?(r.blocked=!0,i.resolve("访问被拒绝，您的帐号可能已经被关小黑屋，已停止")):++v<=5?r.gift_join(e,t,n):(v=0,i.resolve("[礼物抽奖](roomid="+e+",id="+t+",type="+n+")"+a.msg)):i.resolve("[礼物抽奖](roomid="+e+",id="+t+",type="+n+")"+a.msg)}}),i},guard_join:function(e,t){var n=$.Deferred();return _.Lottery.Guard.join(e,t).then(function(i){switch(A("上船抽奖返回信息",i),i.code){case 0:i.data.award_text?n.resolve(i.data.award_text,i.data.award_num):n.resolve(i.data.award_name+"X"+i.data.award_num.toString(),i.data.award_num);break;default:i.msg.indexOf("拒绝")>-1?0==r.CONFIG.FORCE_LOTTERY?(r.blocked=!0,n.resolve("访问被拒绝，您的帐号可能已经被关小黑屋，已停止")):++I<=5?r.guard_join(e,id):(I=0,n.resolve("[礼物抽奖](roomid="+e+",id="+raffleId+",type="+type+")"+i.msg)):n.resolve("[上船](roomid="+e+",id="+t+")"+i.msg)}}),n},pk_join:function(e,t){var n=$.Deferred();return _.Lottery.Pk.join(e,t).then(function(i){switch(A("PK抽奖返回信息",i),i.code){case 0:i.data.award_text?n.resolve(i.data.award_text,i.data.award_num):n.resolve(i.data.award_name+"X"+i.data.award_num.toString(),i.data.award_num);break;default:i.msg.indexOf("拒绝")>-1?0==r.CONFIG.FORCE_LOTTERY?(r.blocked=!0,n.resolve("访问被拒绝，您的帐号可能已经被关小黑屋，已停止")):++p<=5?r.pk_join(e,id):(p=0,n.resolve("[礼物抽奖](roomid="+e+",id="+raffleId+",type="+type+")"+i.msg)):n.resolve("[PK](roomid="+e+",id="+t+")"+i.msg)}}),n},GroupSign:{getGroups:function(){return _.Group.my_groups().then(function(e){return A("GroupSign.getGroups: API.Group.my_groups",e),0===e.code?$.Deferred().resolve(e.data.list):(window.toast("[自动应援团签到]'"+e.msg,"caution"),$.Deferred().reject())},function(){return window.toast("[自动应援团签到]获取应援团列表失败，请检查网络","error"),x(function(){return r.GroupSign.getGroups()})})},signInList:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(t>=e.length)return $.Deferred().resolve();var n=e[t];return n.owner_uid==E.uid?GroupSign.signInList(e,t+1):_.Group.sign_in(n.group_id,n.owner_uid).then(function(i){A("GroupSign.signInList: API.Group.sign_in",i);var a=$.Deferred();return 0!==i.code?(window.toast("[自动应援团签到]'"+i.msg,"caution"),r.GroupSign.signInList(e,t)):(i.data.add_num>0?(window.toast("[自动应援团签到]应援团(group_id="+n.group_id+",owner_uid="+n.owner_uid+")签到成功，当前勋章亲密度+"+i.data.add_num,"success"),a.resolve()):0==i.data.add_num?(window.toast("[自动应援团签到]应援团(group_id="+n.group_id+",owner_uid="+n.owner_uid+")已签到","caution"),a.resolve()):a.reject(),$.when(r.GroupSign.signInList(e,t+1),a))},function(){return window.toast("[自动应援团签到]应援团(group_id="+n.group_id+",owner_uid="+n.owner_uid+")签到失败，请检查网络","error"),x(function(){return r.GroupSign.signInList(e,t)})})},run:function(){try{if(!r.CONFIG.AUTO_GROUP_SIGN)return $.Deferred().resolve();var e=a(r.CACHE.AUTO_GROUP_SIGH_TS);if(e<864e5){setTimeout(r.GroupSign.run,e);var t=new Date(O()+e).toLocaleString();return A("[自动应援团签到]","将在"+t+"进行应援团签到"),$.Deferred().resolve()}return r.GroupSign.getGroups().then(function(t){return r.GroupSign.signInList(t).then(function(){r.CACHE.AUTO_GROUP_SIGH_TS=O(),r.saveCache(),e=a(r.CACHE.AUTO_GROUP_SIGH_TS),setTimeout(r.GroupSign.run,e);var t=new Date(O()+e).toLocaleString();A("[自动应援团签到]","将在"+t+"进行应援团签到")},function(){return x(function(){return r.GroupSign.run()})})},function(){return x(function(){return r.GroupSign.run()})})}catch(e){return window.toast("[自动应援团签到]运行时出现异常，已停止","error"),console.error("["+f+"]",e),$.Deferred().reject()}}},DailyReward:{coin_exp:0,login:function(){return _.DailyReward.login().then(function(){A("DailyReward.login: API.DailyReward.login"),window.toast("[自动每日奖励][每日登录]完成","success")},function(){return window.toast("[自动每日奖励][每日登录]完成失败，请检查网络","error"),x(function(){return r.DailyReward.login()})})},watch:function(e,t){return r.CONFIG.WATCH?_.DailyReward.watch(e,t,E.uid,h()).then(function(t){A("DailyReward.watch: API.DailyReward.watch",t),0===t.code?window.toast("[自动每日奖励][每日观看]完成(av="+e+")","success"):window.toast("[自动每日奖励][每日观看]'"+t.msg,"caution")},function(){return window.toast("[自动每日奖励][每日观看]完成失败，请检查网络","error"),x(function(){return r.DailyReward.watch(e,t)})}):$.Deferred().resolve()},coin:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!r.CONFIG.COIN)return $.Deferred().resolve();if(r.DailyReward.coin_exp>=10*r.CONFIG.COIN_NUMBER)return window.toast("[自动每日奖励][每日投币]今日投币已完成","info"),$.Deferred().resolve();if(n>=e.length)return window.toast("[自动每日奖励][每日投币]动态里可投币的视频不足","caution"),$.Deferred().resolve();var a=JSON.parse(e[n].card),o=Math.min(2,t);return i&&(o=1),_.DailyReward.coin(a.aid,o).then(function(s){return A("DailyReward.coin: API.DailyReward.coin",s),0===s.code?(r.DailyReward.coin_exp+=10*o,window.toast("[自动每日奖励][每日投币]投币成功(av="+a.aid+",num="+o+")","success"),r.DailyReward.coin(e,t-o,n+1)):-110===s.code?(window.toast("[自动每日奖励][每日投币]未绑定手机，已停止","error"),$.Deferred().reject()):34003===s.code?i?r.DailyReward.coin(e,t,n+1):r.DailyReward.coin(e,t,n,!0):34005===s.code?r.DailyReward.coin(e,t,n+1):(window.toast("[自动每日奖励][每日投币]'"+s.msg,"caution"),r.DailyReward.coin(e,t,n+1))},function(){return x(function(){return r.DailyReward.coin(e,t,n)})})},share:function(e){return r.CONFIG.SHARE?_.DailyReward.share(e).then(function(t){A("DailyReward.share: API.DailyReward.share",t),0===t.code?window.toast("[自动每日奖励][每日分享]分享成功(av="+e+")","success"):71e3===t.code?window.toast("[自动每日奖励][每日分享]今日分享已完成","info"):window.toast("[自动每日奖励][每日分享]'"+t.msg,"caution")},function(){return window.toast("[自动每日奖励][每日分享]分享失败，请检查网络","error"),x(function(){return r.DailyReward.share(e)})}):$.Deferred().resolve()},dynamic:function(){return _.dynamic_svr.dynamic_new(E.uid,8).then(function(e){if(A("DailyReward.dynamic: API.dynamic_svr.dynamic_new",e),0===e.code){if(e.data.cards){var t=JSON.parse(e.data.cards[0].card),n=r.DailyReward.watch(t.aid,t.cid),i=r.DailyReward.coin(e.data.cards,Math.max(r.CONFIG.COIN_NUMBER-r.DailyReward.coin_exp/10,0)),a=r.DailyReward.share(t.aid);return $.when(n,i,a)}window.toast('[自动每日奖励]"动态-投稿视频"中暂无动态',"info")}else window.toast('[自动每日奖励]获取"动态-投稿视频"\''+e.msg,"caution")},function(){return window.toast('[自动每日奖励]获取"动态-投稿视频"失败，请检查网络',"error"),x(function(){return r.DailyReward.dynamic()})})},run:function(){try{return F(r.CACHE.DailyReward_TS)?_.DailyReward.exp().then(function(e){if(A("DailyReward.run: API.DailyReward.exp",e),0===e.code)return r.DailyReward.coin_exp=e.number,r.DailyReward.login(),r.DailyReward.dynamic().then(function(){r.CACHE.DailyReward_TS=O(),r.saveCache(),G(r.DailyReward.run,"每日任务")});window.toast("[自动每日奖励]"+e.message,"caution")},function(){return window.toast("[自动每日奖励]获取每日奖励信息失败，请检查网络","error"),x(function(){return r.DailyReward.run()})}):(G(r.DailyReward.run,"每日任务"),$.Deferred().resolve())}catch(e){return window.toast("[自动每日奖励]运行时出现异常","error"),console.error("["+f+"]",e),$.Deferred().reject()}}},LiveReward:{dailySignIn:function(){return _.xlive.dosign().then(function(e){A("LiveReward.dailySignIn: API.xlive.dosign",e),0===e.code?window.toast("[自动直播签到]完成","success"):1011040===e.code?window.toast("[自动直播签到]今日直播签到已完成","info"):window.toast("[自动直播签到]"+e.message,"caution")},function(){return window.toast("[自动直播签到]直播签到失败，请检查网络","error"),x(function(){return r.LiveReward.dailySignIn()})})},run:function(){try{if(!r.CONFIG.LIVE_SIGN)return $.Deferred().resolve();if(!F(r.CACHE.LiveReward_TS))return G(r.LiveReward.run,"直播签到"),$.Deferred().resolve();r.LiveReward.dailySignIn(),r.CACHE.LiveReward_TS=O(),r.saveCache(),G(r.LiveReward.run,"直播签到")}catch(e){return window.toast("[自动直播签到]运行时出现异常","error"),console.error("["+f+"]",e),$.Deferred().reject()}}},Exchange:{silver2coin:function(){return _.Exchange.silver2coin().then(function(e){A("Exchange.silver2coin: API.SilverCoinExchange.silver2coin",e),0===e.code?window.toast("[银瓜子换硬币]"+e.msg,"success"):403===e.code?window.toast("[银瓜子换硬币]"+e.msg,"info"):window.toast("[银瓜子换硬币]"+e.msg,"caution")},function(){return window.toast("[银瓜子换硬币]兑换失败，请检查网络","error"),x(function(){return r.Exchange.silver2coin()})})},runS2C:function(){try{return r.CONFIG.SILVER2COIN?F(r.CACHE.Silver2Coin_TS)?r.Exchange.silver2coin().then(function(){r.CACHE.Silver2Coin_TS=O(),r.saveCache(),G(r.Exchange.runS2C,"瓜子换硬币")},function(){return x(function(){return r.Exchange.runS2C()})}):(G(r.Exchange.runS2C,"瓜子换硬币"),$.Deferred().resolve()):$.Deferred().resolve()}catch(e){return window.toast("[银瓜子换硬币]运行时出现异常，已停止","error"),console.error("["+f+"]",e),$.Deferred().reject()}}},TreasureBox:{timer:void 0,time_end:void 0,time_start:void 0,promise:{calc:void 0,timer:void 0},DOM:{image:void 0,canvas:void 0,div_tip:void 0,div_timer:void 0},init:function(){if(!r.CONFIG.AUTO_TREASUREBOX)return $.Deferred().resolve();var e=$.Deferred();return w(function(){try{if($(".draw-box.gift-left-part").length)return window.toast("[自动领取瓜子]当前直播间有实物抽奖，暂停领瓜子功能","caution"),e.resolve(),!0;var t=$("#gift-control-vm div.treasure-box.p-relative");if(!t.length)return!1;t=t.first(),t.attr("id","old_treasure_box"),t.hide();var n=$('<div id="'+f+'_treasure_div" class="treasure-box p-relative" style="min-width: 46px;display: inline-block;float: left;padding: 22px 0 0 15px;"></div>');r.TreasureBox.DOM.div_tip=$('<div id="'+f+'_treasure_div_tip" class="t-center b-box none-select">自动<br>领取中</div>'),r.TreasureBox.DOM.div_timer=$('<div id="'+f+'_treasure_div_timer" class="t-center b-box none-select">0</div>'),r.TreasureBox.DOM.image=$('<img id="'+f+'_treasure_image" style="display:none">'),r.TreasureBox.DOM.canvas=$('<canvas id="'+f+'_treasure_canvas" style="display:none" height="40" width="120"></canvas>');var i="min-width: 40px;padding: 2px 3px;margin-top: 3px;font-size: 12px;color: #fff;background-color: rgba(0,0,255,.5);border-radius: 10px;";if(r.TreasureBox.DOM.div_tip[0].style=i,r.TreasureBox.DOM.div_timer[0].style=i,n.append(r.TreasureBox.DOM.div_tip),n.append(r.TreasureBox.DOM.image),n.append(r.TreasureBox.DOM.canvas),r.TreasureBox.DOM.div_tip.after(r.TreasureBox.DOM.div_timer),t.after(n),!E.mobile_verify)return r.TreasureBox.setMsg("未绑定<br>手机"),window.toast("[自动领取瓜子]未绑定手机，已停止","caution"),e.resolve(),!0;try{OCRAD}catch(t){return r.TreasureBox.setMsg("初始化<br>失败"),window.toast("[自动领取瓜子]OCRAD初始化失败，请检查网络","error"),console.error("["+f+"]",t),e.resolve(),!0}return r.TreasureBox.timer=setInterval(function(){var e=parseInt(r.TreasureBox.DOM.div_timer.text(),10);isNaN(e)&&(e=0),e>0?r.TreasureBox.DOM.div_timer.text(e-1+"s"):r.TreasureBox.DOM.div_timer.hide()},1e3),r.TreasureBox.DOM.image[0].onload=function(){var e=r.TreasureBox.DOM.canvas[0].getContext("2d");e.font="40px agencyfbbold",e.textBaseline="top",e.clearRect(0,0,r.TreasureBox.DOM.canvas[0].width,r.TreasureBox.DOM.canvas[0].height),e.drawImage(r.TreasureBox.DOM.image[0],0,0);var t=r.TreasureBox.captcha.OCR.getGrayscaleMap(e),n=r.TreasureBox.captcha.OCR.orderFilter2In3x3(t);e.clearRect(0,0,120,40);for(var i=0;i<n.length;++i){var a=n[i];e.fillStyle="rgb("+a+", "+a+", "+a+")",e.fillRect(i%120,Math.round(i/120),1,1)}try{var o=r.TreasureBox.captcha.correctQuestion(OCRAD(e.getImageData(0,0,120,40)));A("TreasureBox.DOM.image.load","question =",o);var s=r.TreasureBox.captcha.eval(o);A("TreasureBox.DOM.image.load","answer =",s),void 0!==s&&(console.info("["+f+"][自动领取瓜子]验证码识别结果: "+o+" = "+s),r.TreasureBox.promise.calc.resolve(s))}catch(e){r.TreasureBox.promise.calc.reject()}},e.resolve(),!0}catch(t){return window.toast("[自动领取瓜子]初始化时出现异常，已停止","error"),console.error("["+f+"]",t),e.reject(),!0}}),e},run:function(){try{if(!r.CONFIG.AUTO_TREASUREBOX||!r.TreasureBox.timer)return;if(E.blocked)return r.TreasureBox.setMsg("小黑屋"),void window.toast("[自动领取瓜子]帐号被关小黑屋，停止领取瓜子","caution");if(!F(r.CACHE.TreasureBox_TS))return r.TreasureBox.setMsg("今日<br>已领完"),void G(r.TreasureBox.run,"领银瓜子宝箱");r.TreasureBox.getCurrentTask().then(function(e){if(A("TreasureBox.run: TreasureBox.getCurrentTask().then",e),0===e.code){r.TreasureBox.promise.timer=$.Deferred(),r.TreasureBox.promise.timer.then(function(){r.TreasureBox.captcha.calc().then(function(e){r.TreasureBox.getAward(e).then(function(){return r.TreasureBox.run()},function(){return r.TreasureBox.run()})},function(){return TreasureBox.run()})}),r.TreasureBox.time_end=e.data.time_end,r.TreasureBox.time_start=e.data.time_start;var t=r.TreasureBox.time_end-h()+1;t<0&&(t=0),setTimeout(function(){r.TreasureBox.promise.timer&&r.TreasureBox.promise.timer.resolve()},1e3*t),r.TreasureBox.DOM.div_timer.text(t+"s"),r.TreasureBox.DOM.div_timer.show(),r.TreasureBox.DOM.div_tip.html("轮数<br>"+e.data.times+"/"+e.data.max_times+"<br>银瓜子<br>"+e.data.silver)}else if(-10017===e.code)r.TreasureBox.setMsg("今日<br>已领完"),r.CACHE.TreasureBox_TS=O(),r.saveCache(),G(r.TreasureBox.run,"领银瓜子宝箱");else{if(-500!==e.code)return window.toast("[自动领取瓜子]"+e.msg,"caution"),r.TreasureBox.run();location.reload()}})}catch(e){r.TreasureBox.setMsg("运行<br>异常"),window.toast("[自动领取瓜子]运行时出现异常，已停止","error"),console.error("["+f+"]",e)}},setMsg:function(e){r.CONFIG.AUTO_TREASUREBOX&&(r.TreasureBox.promise.timer&&(r.TreasureBox.promise.timer.reject(),r.TreasureBox.promise.timer=void 0),r.TreasureBox.DOM.div_timer&&r.TreasureBox.DOM.div_timer.hide(),r.TreasureBox.DOM.div_tip&&r.TreasureBox.DOM.div_tip.html(e))},getAward:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return r.CONFIG.AUTO_TREASUREBOX?t>3?$.Deferred().resolve():_.TreasureBox.getAward(r.TreasureBox.time_start,r.TreasureBox.time_end,e).then(function(e){switch(A("TreasureBox.getAward: getAward",e),e.code){case 0:window.toast("[自动领取瓜子]领取了 "+e.data.awardSilver+" 银瓜子","success");case-903:return $.Deferred().resolve();case-902:case-901:case-10017:return r.TreasureBox.captcha.calc().then(function(e){return r.TreasureBox.getAward(e,t)});case-800:return r.TreasureBox.setMsg("未绑定<br>手机"),window.toast("[自动领取瓜子]未绑定手机，已停止","caution"),$.Deferred().reject();case-500:var n=$.Deferred();return setTimeout(function(){r.TreasureBox.captcha.calc().then(function(e){r.TreasureBox.getAward(e,t+1).then(function(){return n.resolve()},function(){return n.reject()})},function(){return n.reject()})},3e3),n;case 400:return e.msg.indexOf("拒绝")>-1?(E.blocked=!0,r.TreasureBox.setMsg("拒绝<br>访问"),window.toast("[自动领取瓜子]访问被拒绝，您的帐号可能已经被关小黑屋，已停止","error"),$.Deferred().reject()):(window.toast("[自动领取瓜子]"+e.msg,"caution"),$.Deferred().resolve());default:window.toast("[自动领取瓜子]"+e.msg,"caution")}},function(){return window.toast("[自动领取瓜子]获取任务失败，请检查网络","error"),x(function(){return r.TreasureBox.getAward(e,t)})}):$.Deferred().reject()},getCurrentTask:function(){return r.CONFIG.AUTO_TREASUREBOX?_.TreasureBox.getCurrentTask().then(function(e){return A("TreasureBox.getCurrentTask: API.TreasureBox.getCurrentTask",e),$.Deferred().resolve(e)},function(){return window.toast("[自动领取瓜子]获取当前任务失败，请检查网络","error"),x(function(){return r.TreasureBox.getCurrentTask()})}):$.Deferred().reject()},captcha:{cnt:0,calc:function(){return r.CONFIG.AUTO_TREASUREBOX?r.TreasureBox.captcha.cnt>20?(r.TreasureBox.setMsg("验证码<br>识别<br>失败"),window.toast("[自动领取瓜子]验证码识别失败，已停止","error"),$.Deferred().reject()):_.TreasureBox.getCaptcha(O()).then(function(e){if(A("TreasureBox.captcha.calc: getCaptcha",e),0===e.code){r.TreasureBox.captcha.cnt++;var t=$.Deferred();return r.TreasureBox.promise.calc=$.Deferred(),r.TreasureBox.promise.calc.then(function(e){r.TreasureBox.captcha.cnt=0,t.resolve(e)},function(){r.TreasureBox.captcha.calc().then(function(e){t.resolve(e)},function(){t.reject()})}),r.TreasureBox.DOM.image.attr("src",e.data.img),t}return window.toast("[自动领取瓜子]"+e.msg,"caution"),x(function(){return r.TreasureBox.captcha.calc()})},function(){return window.toast("[自动领取瓜子]加载验证码失败，请检查网络","error"),x(function(){return r.TreasureBox.captcha.calc()})}):(r.TreasureBox.captcha.cnt=0,$.Deferred().reject())},OCR:{getGrayscaleMap:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:235,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:120,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:40,i=e.getImageData(0,0,r,n).data,a=[],o=0;o<n;o++)for(var s=0;s<r;s++){var d=4*(o*r+s),c=i.slice(d,d+4),l=c?77*c[0]+150*c[1]+29*c[2]+128>>8:0;a.push(l>t?l:0)}return a},orderFilter2In3x3:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:9,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:120,n=function(t,n){return t+n*r>=0?e[t+n*r]:255},i=[],a=e.length,o=t-1,s=0;s<a;++s){var d=[s%r,Math.floor(s/r)],c=d[0],l=d[1],u=new Array(9);u[0]=n(c-1,l-1),u[1]=n(c+0,l-1),u[2]=n(c+1,l-1),u[3]=n(c-1,l+0),u[4]=n(c+0,l+0),u[5]=n(c+1,l+0),u[6]=n(c-1,l+1),u[7]=n(c+0,l+1),u[8]=n(c+1,l+1),u.sort(function(e,t){return e-t}),i.push(u[o])}return i}},eval:function(e){return new Function("return "+e)()},correctStr:{i:1,I:1,"|":1,l:1,o:0,O:0,D:0,S:6,s:6,b:6,R:8,B:8,z:2,Z:2,".":"-",_:4,g:9,">":3},correctQuestion:function(e){var t="";e=e.trim();for(var n in e){var i=r.TreasureBox.captcha.correctStr[e[n]];t+=void 0!==i?i:e[n]}"4"===t[2]&&(t[2]="+");for(var a=0;a<=parseInt(t.length-2);a++)"'"===t[a]&&"1"===t[a+1]&&(t[a]="7",t.splice(a+1,1));return t}}},Gift:{run_timer:void 0,ruid:void 0,room_id:void 0,medal_list:void 0,bag_list:void 0,time:void 0,remain_feed:void 0,notSendGiftList:[3,4,9,10,39,30588,30587,30586,30585],getMedalList:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return 1===e&&(r.Gift.medal_list=[]),_.i.medal(e,25).then(function(t){if(A("Gift.getMedalList: API.i.medal",t),r.Gift.medal_list=r.Gift.medal_list.concat(t.data.fansMedalList),t.data.pageinfo.curPage<t.data.pageinfo.totalpages)return r.Gift.getMedalList(e+1)},function(){return window.toast("[自动送礼]获取勋章列表失败，请检查网络","error"),x(function(){return r.Gift.getMedalList(e)})})},getBagList:function(){return _.gift.bag_list().then(function(e){A("Gift.getBagList: API.gift.bag_list",e),r.Gift.bag_list=e.data.list,r.Gift.time=e.data.time},function(){return window.toast("[自动送礼]获取包裹列表失败，请检查网络","error"),x(function(){return r.Gift.getBagList()})})},getFeedByGiftID:function(e){for(var t=E.gift_list.length-1;t>=0;--t)if(E.gift_list[t].id===e)return Math.ceil(E.gift_list[t].price/100);return 0},run:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var n,a,s,d,c,l,u,g,v,I;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=function(){return window.toast("[自动送礼]送礼失败，请检查网络","error"),x(function(){return r.Gift.run()})},a=function(){var e=i(r.CONFIG.GIFT_SEND_HOUR,r.CONFIG.GIFT_SEND_MINUTE);setTimeout(r.Gift.run,e);var t=new Date(O()+e).toLocaleString();A("[自动送礼]","将在"+t+"进行自动送礼")},e.prev=2,r.CONFIG.AUTO_GIFT){e.next=5;break}return e.abrupt("return",$.Deferred().resolve());case 5:if(o(r.CONFIG.GIFT_SEND_HOUR,r.CONFIG.GIFT_SEND_MINUTE)||0!=T){e.next=11;break}return s=i(r.CONFIG.GIFT_SEND_HOUR,r.CONFIG.GIFT_SEND_MINUTE),setTimeout(r.Gift.run,s),d=new Date(O()+s).toLocaleString(),A("[自动送礼]","将在"+d+"进行自动送礼"),e.abrupt("return",$.Deferred().resolve());case 11:return e.next=14,r.Gift.getMedalList();case 14:if(A("Gift.run: Gift.getMedalList().then: Gift.medal_list",r.Gift.medal_list),!(r.Gift.medal_list&&r.Gift.medal_list.length>0)){e.next=17;break}return e.delegateYield(regeneratorRuntime.mark(function e(){var n,i,a,o,s,d,c,l,u,f,g,v,I,p,T,m;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r.Gift.medal_list=r.Gift.medal_list.filter(function(e){return e.dayLimit-e.today_feed>0&&e.level<20}),r.CONFIG.GIFT_SORT?r.Gift.medal_list.sort(function(e,t){return t.level-e.level==0?t.intimacy-e.intimacy:t.level-e.level}):r.Gift.medal_list.sort(function(e,t){return e.level-t.level==0?e.intimacy-t.intimacy:e.level-t.level}),!(r.CONFIG.AUTO_GIFT_ROOMID&&r.CONFIG.AUTO_GIFT_ROOMID.length>0)){e.next=25;break}for(n=r.CONFIG.AUTO_GIFT_ROOMID.split(","),n.reverse(),i=!0,a=!1,o=void 0,e.prev=8,s=function(){var e=c.value,t=r.Gift.medal_list.findIndex(function(t){return t.roomid==e});if(-1!=t){var n=r.Gift.medal_list[t];r.Gift.medal_list.splice(t,1),r.Gift.medal_list.unshift(n)}},d=n[Symbol.iterator]();!(i=(c=d.next()).done);i=!0)s();e.next=17;break;case 13:e.prev=13,e.t0=e.catch(8),a=!0,o=e.t0;case 17:e.prev=17,e.prev=18,!i&&d.return&&d.return();case 20:if(e.prev=20,!a){e.next=23;break}throw o;case 23:return e.finish(20);case 24:return e.finish(17);case 25:l=r.CONFIG.GIFT_LIMIT,u=!0,f=!1,g=void 0,e.prev=29,v=r.Gift.medal_list[Symbol.iterator]();case 31:if(u=(I=v.next()).done){e.next=47;break}return p=I.value,e.next=35,_.room.room_init(parseInt(p.roomid,10));case 35:if(T=e.sent,r.Gift.room_id=parseInt(T.data.room_id,10),r.Gift.ruid=p.target_id,r.Gift.remain_feed=p.day_limit-p.today_feed,!(r.Gift.remain_feed>0)){e.next=44;break}return e.delegateYield(regeneratorRuntime.mark(function e(){var n,i,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.Gift.getBagList();case 2:if(n=h(),r.CONFIG.SEND_ALL_GIFT){e.next=7;break}if(i=r.Gift.bag_list.filter(function(e){return!r.Gift.notSendGiftList.includes(e.gift_id)&&e.gift_num>0&&e.expire_at>n&&e.expire_at-n<l}),0!=i.length){e.next=7;break}return e.abrupt("return","break");case 7:if(r.CACHE.Gift_TS=O(),r.saveCache(),!(r.Gift.remain_feed>0)){e.next=20;break}return window.toast("[自动送礼]勋章["+p.medalName+"] 今日亲密度未满["+p.today_feed+"/"+p.day_limit+"]，预计需要["+r.Gift.remain_feed+"]送礼开始","info"),e.next=14,r.Gift.sendGift(p);case 14:if(r.CONFIG.SEND_ALL_GIFT){e.next=18;break}if(a=r.Gift.bag_list.filter(function(e){return!r.Gift.notSendGiftList.includes(e.gift_id)&&e.gift_num>0&&e.expire_at>n&&e.expire_at-n<l}),0!=a.length){e.next=18;break}return e.abrupt("return","break");case 18:e.next=21;break;case 20:window.toast("[自动送礼]勋章["+p.medalName+"] 今日亲密度已满","info");case 21:case"end":return e.stop()}},e,t)})(),"t1",41);case 41:if("break"!==(m=e.t1)){e.next=44;break}return e.abrupt("break",47);case 44:u=!0,e.next=31;break;case 47:e.next=53;break;case 49:e.prev=49,e.t2=e.catch(29),f=!0,g=e.t2;case 53:e.prev=53,e.prev=54,!u&&v.return&&v.return();case 56:if(e.prev=56,!f){e.next=59;break}throw g;case 59:return e.finish(56);case 60:return e.finish(53);case 61:case"end":return e.stop()}},e,t,[[8,13,17,25],[18,,20,24],[29,49,53,61],[54,,56,60]])})(),"t0",17);case 17:return e.next=19,r.Gift.getBagList();case 19:c=0,c=0;case 21:if(!(c<=r.Gift.bag_list.length-1)){e.next=27;break}if(1!=r.Gift.bag_list[c].gift_id){e.next=24;break}return e.abrupt("break",27);case 24:c++,e.next=21;break;case 27:if(void 0!=(l=r.Gift.bag_list[c])){e.next=32;break}return T=!1,a(),e.abrupt("return",$.Deferred().resolve());case 32:if(u=r.Gift.getFeedByGiftID(l.gift_id),g=86400,v=h(),!(0!=r.Gift.bag_list.filter(function(e){return!r.Gift.notSendGiftList.includes(e.gift_id)&&e.gift_num>0&&e.expire_at>v&&e.expire_at-v<g}).length&&l.expire_at>r.Gift.time&&l.expire_at-r.Gift.time<86400&&"0"!=r.CONFIG.SPARE_GIFT_ROOM&&"0"!=r.CONFIG.SPARE_GIFT_UID&&u>0)){e.next=38;break}return I=l.gift_num,e.abrupt("return",_.gift.bag_send(E.uid,l.gift_id,r.CONFIG.SPARE_GIFT_UID,I,l.bag_id,r.CONFIG.SPARE_GIFT_ROOM,E.rnd).then(function(e){A("Gift.sendGift(剩余礼物): API.gift.bag_send",e),0===e.code?window.toast("[自动送礼](剩余礼物)房间["+r.CONFIG.SPARE_GIFT_ROOM+"] 送礼成功，送出"+I+"个"+l.gift_name,"success"):window.toast("[自动送礼](剩余礼物)房间["+r.CONFIG.SPARE_GIFT_ROOM+"] 送礼异常:"+e.msg,"caution")},function(){return window.toast("[自动送礼](剩余礼物)包裹送礼失败，请检查网络","error"),x(function(){return r.Gift.sendGift(medal,c)})}));case 38:e.next=46;break;case 40:return e.prev=40,e.t1=e.catch(2),n(),window.toast("[自动送礼]运行时出现异常，已停止","error"),console.error("["+f+"]",e.t1),e.abrupt("return",$.Deferred().reject());case 46:T=!1,a();case 48:case"end":return e.stop()}},e,t,[[2,40]])}));return function(){return e.apply(this,arguments)}}(),sendGift:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(t>=r.Gift.bag_list.length)return $.Deferred().resolve();if(r.Gift.remain_feed<=0)return window.toast("[自动送礼]勋章["+e.medalName+"] 送礼结束，今日亲密度已满["+e.today_feed+"/"+e.day_limit+"]","info"),$.Deferred().resolve();r.Gift.time<=0&&(r.Gift.time=h());var n=r.Gift.bag_list[t];if(!r.Gift.notSendGiftList.includes(n.gift_id)&&n.expire_at>r.Gift.time&&n.expire_at-r.Gift.time<r.CONFIG.GIFT_LIMIT||r.CONFIG.SEND_ALL_GIFT){if(void 0==n.gift_id)return $.Deferred().resolve();if(void 0==n)return $.Deferred().resolve();var i=r.Gift.getFeedByGiftID(n.gift_id);if(i>0){var a=Math.floor(r.Gift.remain_feed/i);if(a>n.gift_num&&(a=n.gift_num),a>0)return _.gift.bag_send(E.uid,n.gift_id,r.Gift.ruid,a,n.bag_id,r.Gift.room_id,E.rnd).then(function(o){return A("Gift.sendGift: API.gift.bag_send",o),0===o.code?(n.gift_num-=a,e.today_feed+=a*i,r.Gift.remain_feed-=a*i,window.toast("[自动送礼]勋章["+e.medalName+"] 送礼成功，送出"+a+"个"+n.gift_name+"，["+e.today_feed+"/"+e.day_limit+"]距离升级还需["+r.Gift.remain_feed+"]","success")):window.toast("[自动送礼]勋章["+e.medalName+"] 送礼异常:"+o.msg,"caution"),r.Gift.sendGift(e,t+1)},function(){return window.toast("[自动送礼]包裹送礼失败，请检查网络","error"),x(function(){return r.Gift.sendGift(e,t)})})}}return r.Gift.sendGift(e,t+1)}},MobileHeartBeat:{run:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var n,i,a,o,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0!=r.CONFIG.MOBILE_HEARTBEAT){e.next=2;break}return e.abrupt("return",$.Deferred().resolve());case 2:if(F(r.CACHE.MobileHeartBeat_TS)){e.next=5;break}return G(r.MobileHeartBeat.run,"移动端心跳"),e.abrupt("return",$.Deferred().resolve());case 5:if(n=function(){return c({GM:!0,anonymous:!0,method:"GET",url:"https://passport.bilibili.com/x/passport-login/oauth2/info?"+N.signLoginQuery("access_key="+b.access_token),responseType:"json",headers:N.headers})},i=function(){c({GM:!0,anonymous:!0,method:"POST",url:"https://api.live.bilibili.com/heartbeat/v1/OnLine/mobileOnline?"+BilibiliToken.signQuery("access_key="+b.access_token+"&"+C),data:"room_id="+E.room_id+"&scale=xxhdpi",responseType:"json",headers:N.headers})},a=function(){if(!F(r.CACHE.MobileHeartBeat_TS))return A("[双端观看直播]","同一天不领取"),clearInterval(s),G(r.MobileHeartBeat.run,"移动端心跳"),$.Deferred().resolve();r.CACHE.MobileHeartBeat_TS=O(),r.saveCache(),_.activity.receive_award("double_watch_task").then(function(e){return 0===e.code?(window.toast("[双端观看直播]奖励领取成功","success"),A("MobileHeartBeat GetAward",e),clearInterval(s),G(r.MobileHeartBeat.run,"移动端心跳"),$.Deferred().resolve()):-400===e.code?(window.toast("[双端观看直播]奖励已领取","info"),A("MobileHeartBeat GetAward",e),clearInterval(s),G(r.MobileHeartBeat.run,"移动端心跳"),$.Deferred().resolve()):(window.toast("[双端观看直播]其它错误","warning"),A("MobileHeartBeat GetAward",e),clearInterval(s),G(r.MobileHeartBeat.run,"移动端心跳"),$.Deferred().resolve())},function(e){return window.toast("[双端观看直播]奖励领取失败，请检查网络","error"),console.error("MobileHeartBeat GetAward",e),clearInterval(s),x(function(){return r.MobileHeartBeat.run()})})},e.t0=void 0===b.access_token,!e.t0){e.next=15;break}return e.next=12,M();case 12:e.t1=e.sent,e.t2=void 0,e.t0=e.t1===e.t2;case 15:if(!e.t0){e.next=19;break}return e.abrupt("return");case 19:return e.next=21,n();case 21:if(void 0!==(o=e.sent)){e.next=24;break}return e.abrupt("return",console.error(GM_info.script.name,"获取用户信息错误"));case 24:if(e.t3=0!==o.body.code,!e.t3){e.next=31;break}return e.next=28,M();case 28:e.t4=e.sent,e.t5=void 0,e.t3=e.t4===e.t5;case 31:if(!e.t3){e.next=35;break}return e.abrupt("return");case 35:if(e.t6=o.body.data.mid!==E.uid,!e.t6){e.next=42;break}return e.next=39,M();case 39:e.t7=e.sent,e.t8=void 0,e.t6=e.t7===e.t8;case 42:if(!e.t6){e.next=44;break}return e.abrupt("return");case 44:A("MobileHeartBeat","开始客户端心跳"),i(),s=void 0,s=setInterval(function(){return i()},3e5),setTimeout(function(){return a()},36e4);case 49:case"end":return e.stop()}},e,t)}));return function(){return e.apply(this,arguments)}}()},stormQueue:[],stormBlack:!1,stormIdSet:{add:function(e){var t=[];try{var r=JSON.parse(localStorage.getItem(f+"stormIdSet"));t=[].concat(r.list),t.push(e),t.length>50&&t.splice(0,10),localStorage.setItem(f+"stormIdSet",JSON.stringify({list:t})),A(f+"storm_Id_list_add",t)}catch(r){t.push(e),localStorage.setItem(f+"stormIdSet",JSON.stringify({list:t}))}},isIn:function(e){var t=[];try{var r=JSON.parse(localStorage.getItem(f+"stormIdSet"));return t=null===r?[]:[].concat(r.list),A(f+"storm_Id_list_read",r),t.indexOf(e)>-1}catch(r){return localStorage.setItem(f+"stormIdSet",JSON.stringify({list:t})),A("读取"+f+"stormIdSet缓存错误已重置"),t.indexOf(e)>-1}}},Storm:{check:function(e){return r.stormQueue.indexOf(e)>-1},append:function(e){r.stormQueue.push(e),r.stormQueue.length>r.CONFIG.STORM_QUEUE_SIZE&&r.stormQueue.shift()},over:function(e){r.stormQueue.indexOf(e)>-1&&r.stormQueue.splice(e,1)},run:function(e){try{return r.CONFIG.STORM?r.stormBlack?$.Deferred().resolve():s(r.CONFIG.TIME_AREA_START_H0UR,r.CONFIG.TIME_AREA_END_H0UR,r.CONFIG.TIME_AREA_START_MINUTE,r.CONFIG.TIME_AREA_END_MINUTE)&&r.CONFIG.TIME_AREA_DISABLE?(A("节奏风暴","自动休眠，跳过检测roomid="+e),$.Deferred().resolve()):_.Storm.check(e).then(function(t){if(DEBUG("MY_API.Storm.run: MY_API.API.Storm.check",t),0===t.code){var n=t.data;return r.Storm.join(n.id,n.roomid,Math.round((new Date).getTime()/1e3)+n.time),$.Deferred().resolve()}window.toast("[自动抽奖][节奏风暴](roomid="+e+")"+t.msg,"caution")},function(){window.toast("[自动抽奖][节奏风暴]检查直播间("+e+")失败，请检查网络","error")}):$.Deferred().resolve()}catch(e){return window.toast("[自动抽奖][节奏风暴]运行时出现异常","error"),console.error("["+f+"]",e),$.Deferred().reject()}},join:function(e,t,n){var i=function(){var i=_asyncToGenerator(regeneratorRuntime.mark(function i(){var a,d;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(i.prev=0,r.Storm.check(e)){i.next=4;break}return clearInterval(o),i.abrupt("return");case 4:if(!((a=Math.round((new Date).getTime()/1e3))>n&&n>0)){i.next=9;break}return r.Storm.over(e),clearInterval(o),i.abrupt("return");case 9:if(!(++s>r.CONFIG.STORM_MAX_COUNT&&r.CONFIG.STORM_MAX_COUNT>0)){i.next=15;break}return r.Storm.over(e),clearInterval(o),window.toast("[自动抽奖][节奏风暴]抽奖(roomid="+t+",id="+e+")到达尝试次数。\r\n尝试次数:"+s+",距离到期:"+(n-a)+"s","caution"),i.abrupt("return");case 15:if(d=void 0,i.prev=16,!(D&&N&&b.access_token)){i.next=23;break}return i.next=20,r.API.Storm.join_ex(e,t,b.access_token,BilibiliToken.appKey,BilibiliToken.headers);case 20:d=i.sent,i.next=26;break;case 23:return i.next=25,r.API.Storm.join(e,captcha_token="",captcha_phrase="",t);case 25:d=i.sent;case 26:if(DEBUG("MY_API.Storm.join: MY_API.API.Storm.join",d),!d.code){i.next=51;break}if(-1==d.msg.indexOf("领取")){i.next=33;break}return r.Storm.over(e),clearInterval(o),window.toast("[自动抽奖][节奏风暴]领取(roomid="+t+",id="+e+")成功,"+d.msg+"\r\n尝试次数:"+s,"success"),i.abrupt("return");case 33:if(-1==d.msg.indexOf("验证码")){i.next=39;break}return r.Storm.over(e),clearInterval(o),r.stormBlack=!0,window.toast("[自动抽奖][节奏风暴]抽奖(roomid="+t+",id="+e+")失败,疑似账号不支持,"+d.msg,"caution"),i.abrupt("return");case 39:if(!d.data||0!=d.data.length||-1==d.msg.indexOf("下次要更快一点")){i.next=46;break}return r.Storm.over(e),window.toast("[自动抽奖][节奏风暴]抽奖(roomid="+t+",id="+e+")疑似风暴黑屋,终止！","error"),clearInterval(o),r.stormBlack=!0,setTimeout(function(){r.stormBlack=!1},36e5),i.abrupt("return");case 46:if(-1!=d.msg.indexOf("下次要更快一点")){i.next=49;break}return clearInterval(o),i.abrupt("return");case 49:i.next=56;break;case 51:return r.Storm.over(e),Statistics.appendGift(d.data.gift_name,d.data.gift_num),
window.toast("[自动抽奖][节奏风暴]领取(roomid="+t+",id="+e+")成功,"+d.data.gift_name+"x"+d.data.gift_num+"\r\n"+d.data.mobile_content+"\r\n尝试次数:"+s,"success"),clearInterval(o),i.abrupt("return");case 56:i.next=65;break;case 58:return i.prev=58,i.t0=i.catch(16),r.Storm.over(e),window.toast("[自动抽奖][节奏风暴]抽奖(roomid="+t+",id="+e+")疑似触发风控,终止！\r\n尝试次数:"+s,"error"),console.error(i.t0),clearInterval(o),i.abrupt("return");case 65:i.next=74;break;case 67:return i.prev=67,i.t1=i.catch(0),r.Storm.over(e),window.toast("[自动抽奖][节奏风暴]抽奖(roomid="+t+",id="+e+")抽奖异常,终止！","error"),console.error(i.t1),clearInterval(o),i.abrupt("return");case 74:case"end":return i.stop()}},i,this,[[0,67],[16,58]])}));return function(){return i.apply(this,arguments)}}();if(t=parseInt(t,10),e=parseInt(e,10),isNaN(t)||isNaN(e))return $.Deferred().reject();var a=Math.round(e/1e6);if(r.stormIdSet.isIn(a))return $.Deferred().resolve();if(r.stormIdSet.add(a),!r.Storm.check(e)){r.Storm.append(e);var o=0;n<=0&&(n=Math.round((new Date).getTime()/1e3)+90);var s=0;return window.toast("[自动抽奖][节奏风暴]尝试抽奖(roomid="+t+",id="+e+")","success"),o=setInterval(function(){return i()},r.CONFIG.STORM_ONE_LIMIT),$.Deferred().resolve()}}}};r.init().then(function(){try{var e=$.Deferred();(function(){var t=Date.now();return t-r.CACHE.UNIQUE_CHECK>=0&&t-r.CACHE.UNIQUE_CHECK<=15e3?($(".link-toast").hide(),$(".igiftMsg").hide(),r.CONFIG.AUTO_TREASUREBOX=!1,window.toast("有其他直播间页面的脚本正在运行，本页面脚本停止运行","caution"),e.reject()):e.resolve()})().then(function(){var e=void 0;if(window.addEventListener("unload",function(){e&&(clearTimeout(e),r.CACHE.UNIQUE_CHECK=0,r.saveCache())}),function t(){e=setTimeout(t,1e4),r.CACHE.UNIQUE_CHECK=Date.now(),r.saveCache(!1)}(),0===parseInt(E.uid)||isNaN(parseInt(E.uid)))return void r.chatLog("未登录，请先登录再使用脚本","warning");A("MY_API.CONFIG",r.CONFIG),n(r)})}catch(e){console.error("重复运行检测错误",e)}})}function n(e){F(e.GIFT_COUNT.CLEAR_TS)&&t();var t=function(){e.GIFT_COUNT.COUNT=0,e.GIFT_COUNT.CLEAR_TS=S(),e.saveGiftCount(),A("已清空辣条数量")};R(t,"重置统计"),setTimeout(function(){e.removeUnnecessary(),e.GroupSign.run(),e.DailyReward.run(),e.LiveReward.run(),e.Exchange.runS2C(),e.TreasureBox.run(),e.Gift.run(),e.MobileHeartBeat.run()},6e3),e.creatSetBox(),_.room.getList().then(function(t){A("直播间列表",t);var r=!0,n=!1,i=void 0;try{for(var a,o=t.data[Symbol.iterator]();!(r=(a=o.next()).done);r=!0)!function(){var t=a.value;_.room.getRoomList(t.id,0,0,1,1).then(function(r){A("直播间号列表",r);for(var n=0;n<r.data.length;++n)e.listen(r.data[n].roomid,E.uid,t.name+"区")})}()}catch(e){n=!0,i=e}finally{try{!r&&o.return&&o.return()}finally{if(n)throw i}}});var r=function(){return e.GIFT_COUNT.COUNT>=e.CONFIG.MAX_GIFT&&(A("超过今日辣条限制，不参与抽奖"),e.max_blocked=!0),e.blocked||e.max_blocked?e.blocked?(e.chatLog("进入小黑屋检查小时榜已停止运行"),void clearInterval(n)):void e.chatLog("辣条已达到最大值检查小时榜已停止运行"):s(e.CONFIG.TIME_AREA_START_H0UR,e.CONFIG.TIME_AREA_END_H0UR,e.CONFIG.TIME_AREA_START_MINUTE,e.CONFIG.TIME_AREA_END_MINUTE)&&e.CONFIG.TIME_AREA_DISABLE?void e.chatLog("当前时间段不检查小时榜礼物","warning"):void _.rankdb.getTopRealTimeHour().then(function(t){var r=t.data.list;e.chatLog("检查小时榜房间的礼物","warning"),A("小时榜房间列表",r);var n=!0,i=!1,a=void 0;try{for(var o,s=r[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var d=o.value;e.checkRoom(d.roomid,"小时榜-"+d.area_v2_parent_name+"区")}}catch(e){i=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw a}}})};setTimeout(r,6e3);var n=setInterval(r,parseInt(1e3*e.CONFIG.CHECK_HOUR_ROOM_INTERVAL));!function t(r){setTimeout(function(){if(e.raffleId_list.length>0||e.guardId_list.length>0||e.pkId_list.length>0)return A("还有礼物没抽，延迟30s后刷新直播间"),void t(3e4);s(e.CONFIG.TIME_AREA_START_H0UR,e.CONFIG.TIME_AREA_END_H0UR,e.CONFIG.TIME_AREA_START_MINUTE,e.CONFIG.TIME_AREA_END_MINUTE)&&e.CONFIG.IN_TIME_RELOAD_DISABLE||window.location.reload()},r)}(6e4*e.CONFIG.TIME_RELOAD)}function i(e,t){var r=new Date,n=r.getHours(),i=r.getMinutes(),a=r.getSeconds(),o=3600*e*1e3+60*t*1e3,s=3600*n*1e3+60*i*1e3+1e3*a,d=o-s;return A("[getIntervalTime]获取间隔时间",d+"毫秒"),d<0?864e5+d:d}function a(e){var t=O()-e;return A("[GetTomorrowIntervalTime]获取间隔时间",t+"毫秒"),t>864e5?t:864e5-t}function o(e,t){var r=new Date,n=r.getHours(),i=r.getMinutes();return n==e&&i==t||(A("错误时间"),!1)}function s(e,t,r,n){if(e>23||t>24||e<0||t<1||r>59||r<0||n>59||n<0)return A("错误时间段"),!1;var i=new Date,a=i.getHours(),o=i.getMinutes();return e<t?a>=e&&a<t||a==t&&o>=r&&o<n:e>t?a>=e||a<t||a==t&&o>=r&&o<n:e==t?o>=r&&o<n:void 0}function d(e){return!(e<=0)&&e/100>=Math.random()}function c(e){return new Promise(function(t){var r=function(e){console.error(GM_info.script.name,e),t(void 0)};if(e.GM)"POST"===e.method&&(void 0===e.headers&&(e.headers={}),void 0===e.headers["Content-Type"]&&(e.headers["Content-Type"]="application/x-www-form-urlencoded; charset=utf-8")),e.timeout=3e4,e.onload=function(e){return t({response:e,body:e.response})},e.onerror=r,e.ontimeout=r,GM_xmlhttpRequest(e);else{var n=new XMLHttpRequest;n.open(e.method,e.url),"POST"===e.method&&null===n.getResponseHeader("Content-Type")&&n.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=utf-8"),e.cookie&&(n.withCredentials=!0),void 0!==e.responseType&&(n.responseType=e.responseType),n.timeout=3e4,n.onload=function(e){var r=e.target;t({response:r,body:r.response})},n.onerror=r,n.ontimeout=r,n.send(e.data)}})}var l=this,u=!1,f="IGIFTMSG",_=BilibiliAPI,g=void 0,v=0,I=0,p=0,T=!1,m=(new Date).getTimezoneOffset()+480,O=function(){return Date.now()},h=function(){return Math.round(O()/1e3)},E={room_id:void 0,uid:void 0,ruid:void 0,mobile_verify:void 0,gift_list:void 0,rnd:void 0,visit_id:void 0},w=function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100;setTimeout(function(){t()||e(t,n,n)},r)},x=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e4,r=$.Deferred();return setTimeout(function(){var t=e();t&&t.then?t.then(function(e,t,n,i,a,o){return r.resolve(e,t,n,i,a,o)}):r.resolve()},t),r},A=function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];var i=new Date;if(i="["+f+"]["+i.getHours()+":"+i.getMinutes()+":"+i.getSeconds()+":"+i.getMilliseconds()+"]",1===r.length)return void console.log(i,e+":",r[0]);console.log(i,e+":",r)},G=function(e,t){var r=new Date,n=t||" ";r.setMinutes(r.getMinutes()+m),r.setDate(r.getDate()+1),r.setHours(0,1,0,0),r.setMinutes(r.getMinutes()-m),setTimeout(e,r-O()),A("runMidnight",n+" "+r.toString())},R=function(e,t){var r=new Date,n=t||" ";r.setMinutes(r.getMinutes()+m),r.setDate(r.getDate()+1),r.setHours(0,0,0,0),r.setMinutes(r.getMinutes()-m),setTimeout(e,r-O()),A("runExactMidnight",n+" "+r.toString())},N=new BilibiliToken,C="actionKey=appkey&appkey="+BilibiliToken.appKey+"&build=5561000&channel=bili&device=android&mobi_app=android&platform=android&statistics=%7B%22appId%22%3A1%2C%22platform%22%3A3%2C%22version%22%3A%225.57.0%22%2C%22abtest%22%3A%22%22%7D",b=JSON.parse(GM_getValue("userToken","{}")),D=void 0,M=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N.getToken();case 2:if(void 0!==(D=e.sent)){e.next=5;break}return e.abrupt("return",console.error(GM_info.script.name,"未获取到token"));case 5:return b=D,GM_setValue("userToken",JSON.stringify(b)),e.abrupt("return","OK");case 8:case"end":return e.stop()}},e,l)}));return function(){return e.apply(this,arguments)}}(),y={init:function(){return y.Toast.init().then(function(){})},Toast:{init:function(){try{var e=[];return window.toast=function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5e3;switch(r){case"success":case"info":case"caution":case"error":break;default:r="info"}var i=$('<div class="link-toast '+r+' fixed"><span class="toast-text">'+t+"</span></div>")[0];document.body.appendChild(i),i.style.top=document.body.scrollTop+40*e.length+10+"px",i.style.left=document.body.offsetWidth+document.body.scrollLeft-i.offsetWidth-5+"px",e.push(i),setTimeout(function(){i.className+=" out",setTimeout(function(){e.shift(),e.forEach(function(e){e.style.top=parseInt(e.style.top,10)-40+"px"}),$(i).remove()},200)},n)},$.Deferred().resolve()}catch(e){return console.error("初始化浮动提示时出现异常",e),$.Deferred().reject()}}}};y.init(),$(function(){!function e(t){setTimeout(function(){var t="undefined"==typeof unsafeWindow?window:unsafeWindow;void 0===t.BilibiliLive||0===parseInt(t.BilibiliLive.UID)||isNaN(parseInt(t.BilibiliLive.UID))?(e(1e3),A("无配置信息")):(E.room_id=t.BilibiliLive.ROOMID,E.uid=t.BilibiliLive.UID,_.live_user.get_info_in_room(E.room_id).then(function(e){A("InitData: API.live_user.get_info_in_room",e),E.mobile_verify=e.data.info.mobile_verify}),_.gift.gift_config().then(function(e){A("InitData: API.gift.gift_config",e),E.gift_list=e.data,E.gift_list.forEach(function(e,t){t%3==0&&(E.gift_list_str+="<br>"),E.gift_list_str+=e.id+"："+e.name,t<E.gift_list.length-1&&(E.gift_list_str+="，")})}),E.ruid=t.BilibiliLive.ANCHOR_UID,E.rnd=t.BilibiliLive.RND,E.visit_id=t.__statisObserver?t.__statisObserver.__visitId:"",A("Live_info",E),r())},t)}(1e3),t()}),Array.prototype.remove=function(e){var t=this.indexOf(e);t>-1&&this.splice(t,1)};var S=function(){return Date.now()},F=function(e){if(0===e)return!0;var t=new Date(e),r=new Date,n=t.getDate();return r.getDate()!==n}}();